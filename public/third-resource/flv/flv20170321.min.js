(function (v) { "object" === typeof exports && "undefined" !== typeof module ? module.exports = v() : "function" === typeof define && define.amd ? define([], v) : ("undefined" !== typeof window ? window : "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : this).flvjs = v() })(function () { return function g(h, m, l) { function f(a, d) { if (!m[a]) { if (!h[a]) { var e = "function" == typeof require && require; if (!d && e) return e(a, !0); if (b) return b(a, !0); d = Error("Cannot find module '" + a + "'"); throw d.code = "MODULE_NOT_FOUND", d; } d = m[a] = { exports: {} }; h[a][0].call(d.exports, function (e) { var d = h[a][1][e]; return f(d ? d : e) }, d, d.exports, g, h, m, l) } return m[a].exports } for (var b = "function" == typeof require && require, a = 0; a < l.length; a++) f(l[a]); return f }({ 1: [function (g, h, m) { (function (l, f) { (function (b, a) { "object" === typeof m && "undefined" !== typeof h ? h.exports = a() : b.ES6Promise = a() })(this, function () { function b() { return function () { return l.nextTick(r) } } function a() { return "undefined" !== typeof S ? function () { S(r) } : p() } function e() { var a = 0, c = new X(r), k = document.createTextNode(""); c.observe(k, { characterData: !0 }); return function () { k.data = a = ++a % 2 } } function d() { var a = new MessageChannel; a.port1.onmessage = r; return function () { return a.port2.postMessage(0) } } function p() { var a = setTimeout; return function () { return a(r, 1) } } function r() { for (var a = 0; a < H; a += 2) (0, I[a])(I[a + 1]), I[a] = void 0, I[a + 1] = void 0; H = 0 } function t() { try { var c = g("vertx"); S = c.runOnLoop || c.runOnContext; return a() } catch (Y) { return p() } } function n(a, c) { var q = arguments, e = this, d = new this.constructor(k); void 0 === d[P] && M(d); var n = e._state; n ? function () { var a = q[n - 1]; F(function () { return G(n, d, a, e._result) }) }() : y(e, d, a, c); return d } function c(a) { if (a && "object" === typeof a && a.constructor === this) return a; var c = new this(k); m(c, a); return c } function k() { } function q(a) { try { return a.then } catch (Y) { return Q.error = Y, Q } } function w(a, c, k, q) { try { a.call(c, k, q) } catch (ea) { return ea } } function C(a, c, k) { F(function (a) { var q = !1, e = w(k, c, function (k) { q || (q = !0, c !== k ? m(a, k) : D(a, k)) }, function (c) { q || (q = !0, A(a, c)) }, "Settle: " + (a._label || " unknown promise")); !q && e && (q = !0, A(a, e)) }, a) } function u(a, c) { c._state === N ? D(a, c._result) : c._state === J ? A(a, c._result) : y(c, void 0, function (c) { return m(a, c) }, function (c) { return A(a, c) }) } function h(a, k, q) { k.constructor === a.constructor && q === n && k.constructor.resolve === c ? u(a, k) : q === Q ? A(a, Q.error) : void 0 === q ? D(a, k) : "function" === typeof q ? C(a, k, q) : D(a, k) } function m(a, c) { a === c ? A(a, new TypeError("You cannot resolve a promise with itself")) : "function" === typeof c || "object" === typeof c && null !== c ? h(a, c, q(c)) : D(a, c) } function K(a) { a._onerror && a._onerror(a._result); x(a) } function D(a, c) { a._state === L && (a._result = c, a._state = N, 0 !== a._subscribers.length && F(x, a)) } function A(a, c) { a._state === L && (a._state = J, a._result = c, F(K, a)) } function y(a, c, k, q) { var e = a._subscribers, d = e.length; a._onerror = null; e[d] = c; e[d + N] = k; e[d + J] = q; 0 === d && a._state && F(x, a) } function x(a) { var c = a._subscribers, k = a._state; if (0 !== c.length) { for (var q, e, d = a._result, n = 0; n < c.length; n += 3) q = c[n], e = c[n + k], q ? G(k, q, e, d) : e(d); a._subscribers.length = 0 } } function z() { this.error = null } function G(a, c, k, q) { var e = "function" === typeof k, d = void 0, n = void 0, b = void 0, w = void 0; if (e) { try { d = k(q) } catch (ga) { U.error = ga, d = U } d === U ? (w = !0, n = d.error, d = null) : b = !0; if (c === d) { A(c, new TypeError("A promises callback cannot return that same promise.")); return } } else d = q, b = !0; c._state === L && (e && b ? m(c, d) : w ? A(c, n) : a === N ? D(c, d) : a === J && A(c, d)) } function E(a, c) { try { c(function (c) { m(a, c) }, function (c) { A(a, c) }) } catch (ca) { A(a, ca) } } function M(a) { a[P] = Z++; a._state = void 0; a._result = void 0; a._subscribers = [] } function O(a, c) { this._instanceConstructor = a; this.promise = new a(k); this.promise[P] || M(this.promise); aa(c) ? (this._input = c, this._remaining = this.length = c.length, this._result = Array(this.length), 0 === this.length ? D(this.promise, this._result) : (this.length = this.length || 0, this._enumerate(), 0 === this._remaining && D(this.promise, this._result))) : A(this.promise, Error("Array Methods must be provided an Array")) } function B(a) { this[P] = Z++; this._result = this._state = void 0; this._subscribers = []; if (k !== a) { if ("function" !== typeof a) throw new TypeError("You must pass a resolver function as the first argument to the promise constructor"); if (this instanceof B) E(this, a); else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function."); } } var V = void 0, aa = V = Array.isArray ? Array.isArray : function (a) { return "[object Array]" === Object.prototype.toString.call(a) }, H = 0, S = void 0, W = void 0, F = function (a, c) { I[H] = a; I[H + 1] = c; H += 2; 2 === H && (W ? W(r) : ba()) }, R = (V = "undefined" !== typeof window ? window : void 0) || {}, X = R.MutationObserver || R.WebKitMutationObserver, R = "undefined" === typeof self && "undefined" !== typeof l && "[object process]" === {}.toString.call(l), ha = "undefined" !== typeof Uint8ClampedArray && "undefined" !== typeof importScripts && "undefined" !== typeof MessageChannel, I = Array(1E3), ba = void 0, ba = R ? b() : X ? e() : ha ? d() : void 0 === V && "function" === typeof g ? t() : p(), P = Math.random().toString(36).substring(16), L = void 0, N = 1, J = 2, Q = new z, U = new z, Z = 0; O.prototype._enumerate = function () { for (var a = this.length, c = this._input, k = 0; this._state === L && k < a; k++) this._eachEntry(c[k], k) }; O.prototype._eachEntry = function (a, e) { var d = this._instanceConstructor, b = d.resolve; b === c ? (b = q(a), b === n && a._state !== L ? this._settledAt(a._state, e, a._result) : "function" !== typeof b ? (this._remaining--, this._result[e] = a) : d === B ? (d = new d(k), h(d, a, b), this._willSettleAt(d, e)) : this._willSettleAt(new d(function (c) { return c(a) }), e)) : this._willSettleAt(b(a), e) }; O.prototype._settledAt = function (a, c, k) { var q = this.promise; q._state === L && (this._remaining--, a === J ? A(q, k) : this._result[c] = k); 0 === this._remaining && D(q, this._result) }; O.prototype._willSettleAt = function (a, c) { var k = this; y(a, void 0, function (a) { return k._settledAt(N, c, a) }, function (a) { return k._settledAt(J, c, a) }) }; B.all = function (a) { return (new O(this, a)).promise }; B.race = function (a) { var c = this; return aa(a) ? new c(function (k, q) { for (var e = a.length, d = 0; d < e; d++) c.resolve(a[d]).then(k, q) }) : new c(function (a, c) { return c(new TypeError("You must pass an array to race.")) }) }; B.resolve = c; B.reject = function (a) { var c = new this(k); A(c, a); return c }; B._setScheduler = function (a) { W = a }; B._setAsap = function (a) { F = a }; B._asap = F; B.prototype = { constructor: B, then: n, "catch": function (a) { return this.then(null, a) } }; B.polyfill = function () { var a = void 0; if ("undefined" !== typeof f) a = f; else if ("undefined" !== typeof self) a = self; else try { a = Function("return this")() } catch (da) { throw Error("polyfill failed because global object is unavailable in this environment"); } var c = a.Promise; if (c) { var k = null; try { k = Object.prototype.toString.call(c.resolve()) } catch (da) { } if ("[object Promise]" === k && !c.cast) return } a.Promise = B }; return B.Promise = B }) }).call(this, g("_process"), "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : "undefined" !== typeof window ? window : {}) }, { _process: 3 }], 2: [function (g, h, m) { function l() { this._events = this._events || {}; this._maxListeners = this._maxListeners || void 0 } function f(a) { return "function" === typeof a } function b(a) { return "object" === typeof a && null !== a } h.exports = l; l.EventEmitter = l; l.prototype._events = void 0; l.prototype._maxListeners = void 0; l.defaultMaxListeners = 10; l.prototype.setMaxListeners = function (a) { if ("number" !== typeof a || 0 > a || isNaN(a)) throw TypeError("n must be a positive number"); this._maxListeners = a; return this }; l.prototype.emit = function (a) { var e, d, p, r; this._events || (this._events = {}); if ("error" === a && (!this._events.error || b(this._events.error) && !this._events.error.length)) { e = arguments[1]; if (e instanceof Error) throw e; d = Error('Uncaught, unspecified "error" event. (' + e + ")"); d.context = e; throw d; } d = this._events[a]; if (void 0 === d) return !1; if (f(d)) switch (arguments.length) { case 1: d.call(this); break; case 2: d.call(this, arguments[1]); break; case 3: d.call(this, arguments[1], arguments[2]); break; default: e = Array.prototype.slice.call(arguments, 1), d.apply(this, e) } else if (b(d)) for (e = Array.prototype.slice.call(arguments, 1), r = d.slice(), d = r.length, p = 0; p < d; p++) r[p].apply(this, e); return !0 }; l.prototype.addListener = function (a, e) { if (!f(e)) throw TypeError("listener must be a function"); this._events || (this._events = {}); this._events.newListener && this.emit("newListener", a, f(e.listener) ? e.listener : e); this._events[a] ? b(this._events[a]) ? this._events[a].push(e) : this._events[a] = [this._events[a], e] : this._events[a] = e; b(this._events[a]) && !this._events[a].warned && (e = void 0 !== this._maxListeners ? this._maxListeners : l.defaultMaxListeners) && 0 < e && this._events[a].length > e && (this._events[a].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[a].length), "function" === typeof console.trace && console.trace()); return this }; l.prototype.on = l.prototype.addListener; l.prototype.once = function (a, e) { function d() { this.removeListener(a, d); b || (b = !0, e.apply(this, arguments)) } if (!f(e)) throw TypeError("listener must be a function"); var b = !1; d.listener = e; this.on(a, d); return this }; l.prototype.removeListener = function (a, e) { var d, p, r; if (!f(e)) throw TypeError("listener must be a function"); if (!this._events || !this._events[a]) return this; d = this._events[a]; r = d.length; p = -1; if (d === e || f(d.listener) && d.listener === e) delete this._events[a], this._events.removeListener && this.emit("removeListener", a, e); else if (b(d)) { for (; 0 < r--;) if (d[r] === e || d[r].listener && d[r].listener === e) { p = r; break } if (0 > p) return this; 1 === d.length ? (d.length = 0, delete this._events[a]) : d.splice(p, 1); this._events.removeListener && this.emit("removeListener", a, e) } return this }; l.prototype.removeAllListeners = function (a) { var e; if (!this._events) return this; if (!this._events.removeListener) return 0 === arguments.length ? this._events = {} : this._events[a] && delete this._events[a], this; if (0 === arguments.length) { for (e in this._events) "removeListener" !== e && this.removeAllListeners(e); this.removeAllListeners("removeListener"); this._events = {}; return this } e = this._events[a]; if (f(e)) this.removeListener(a, e); else if (e) for (; e.length;) this.removeListener(a, e[e.length - 1]); delete this._events[a]; return this }; l.prototype.listeners = function (a) { return this._events && this._events[a] ? f(this._events[a]) ? [this._events[a]] : this._events[a].slice() : [] }; l.prototype.listenerCount = function (a) { if (this._events) { a = this._events[a]; if (f(a)) return 1; if (a) return a.length } return 0 }; l.listenerCount = function (a, e) { return a.listenerCount(e) } }, {}], 3: [function (g, h, m) { function l() { throw Error("setTimeout has not been defined"); } function f() { throw Error("clearTimeout has not been defined"); } function b(a) { if (t === setTimeout) return setTimeout(a, 0); if ((t === l || !t) && setTimeout) return t = setTimeout, setTimeout(a, 0); try { return t(a, 0) } catch (u) { try { return t.call(null, a, 0) } catch (fa) { return t.call(this, a, 0) } } } function a(a) { if (n === clearTimeout) return clearTimeout(a); if ((n === f || !n) && clearTimeout) return n = clearTimeout, clearTimeout(a); try { return n(a) } catch (u) { try { return n.call(null, a) } catch (fa) { return n.call(this, a) } } } function e() { k && q && (k = !1, q.length ? c = q.concat(c) : w = -1, c.length && d()) } function d() { if (!k) { var d = b(e); k = !0; for (var n = c.length; n;) { q = c; for (c = []; ++w < n;) q && q[w].run(); w = -1; n = c.length } q = null; k = !1; a(d) } } function p(a, c) { this.fun = a; this.array = c } function r() { } g = h.exports = {}; var t, n; try { t = "function" === typeof setTimeout ? setTimeout : l } catch (C) { t = l } try { n = "function" === typeof clearTimeout ? clearTimeout : f } catch (C) { n = f } var c = [], k = !1, q, w = -1; g.nextTick = function (a) { var q = Array(arguments.length - 1); if (1 < arguments.length) for (var e = 1; e < arguments.length; e++) q[e - 1] = arguments[e]; c.push(new p(a, q)); 1 !== c.length || k || b(d) }; p.prototype.run = function () { this.fun.apply(null, this.array) }; g.title = "browser"; g.browser = !0; g.env = {}; g.argv = []; g.version = ""; g.versions = {}; g.on = r; g.addListener = r; g.once = r; g.off = r; g.removeListener = r; g.removeAllListeners = r; g.emit = r; g.binding = function (a) { throw Error("process.binding is not supported"); }; g.cwd = function () { return "/" }; g.chdir = function (a) { throw Error("process.chdir is not supported"); }; g.umask = function () { return 0 } }, {}], 4: [function (g, h, m, l, f, b) { var a = JSON.stringify; h.exports = function (e, d) { function p(a) { w[a] = !0; for (var c in f[a][1]) { var k = f[a][1][c]; w[k] || p(k) } } for (var r, t = Object.keys(b), n = 0, c = t.length; n < c; n++) { var k = t[n], q = b[k].exports; if (q === e || q && q.default === e) { r = k; break } } if (!r) { r = Math.floor(Math.pow(16, 8) * Math.random()).toString(16); q = {}; n = 0; for (c = t.length; n < c; n++) k = t[n], q[k] = k; f[r] = [Function(["require", "module", "exports"], "(" + e + ")(self)"), q] } e = Math.floor(Math.pow(16, 8) * Math.random()).toString(16); t = {}; t[r] = r; f[e] = [Function(["require"], "var f = require(" + a(r) + ");(f.default ? f.default : f)(self);"), t]; var w = {}; p(e); e = "(" + l + ")({" + Object.keys(w).map(function (c) { return a(c) + ":[" + f[c][0] + "," + a(f[c][1]) + "]" }).join(",") + "},{},[" + a(e) + "])"; r = window.URL || window.webkitURL || window.mozURL || window.msURL; e = new Blob([e], { type: "text/javascript" }); if (d && d.bare) return e; d = r.createObjectURL(e); r = new Worker(d); r.objectURL = d; return r } }, {}], 5: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.createDefaultConfig = function () { return Object.assign({}, l) }; var l = m.defaultConfig = { enableWorker: !1, enableStashBuffer: !0, stashInitialSize: void 0, isLive: !1, lazyLoad: !0, lazyLoadMaxDuration: 180, deferLoadAfterSourceOpen: !0, statisticsInfoReportInterval: 600, accurateSeek: !1, seekType: "range", seekParamStart: "bstart", seekParamEnd: "bend", rangeLoadZeroStart: !1, customSeekHandler: void 0 } }, {}], 6: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function a(a, d) { for (var e = 0; e < d.length; e++) { var b = d[e]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (e, d, b) { d && a(e.prototype, d); b && a(e, b); return e } }(), f = (h = g("../io/io-controller.js")) && h.__esModule ? h : { default: h }, b = g("../config.js"); g = function () { function a() { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); } l(a, null, [{ key: "supportMSEH264Playback", value: function () { return window.MediaSource && window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"') } }, { key: "supportNetworkStreamIO", value: function () { var a = new f.default({}, (0, b.createDefaultConfig)()), d = a.loaderType; a.destroy(); return "fetch-stream-loader" == d || "xhr-moz-chunked-loader" == d } }, { key: "getNetworkLoaderTypeName", value: function () { var a = new f.default({}, (0, b.createDefaultConfig)()), d = a.loaderType; a.destroy(); return d } }, { key: "supportNativeMediaPlayback", value: function (e) { void 0 == a.videoElement && (a.videoElement = window.document.createElement("video")); e = a.videoElement.canPlayType(e); return "probably" === e || "maybe" == e } }, { key: "getFeatureList", value: function () { var e = { mseFlvPlayback: !1, mseLiveFlvPlayback: !1, networkStreamIO: !1, networkLoaderName: "", nativeMP4H264Playback: !1, nativeWebmVP8Playback: !1, nativeWebmVP9Playback: !1 }; e.mseFlvPlayback = a.supportMSEH264Playback(); e.networkStreamIO = a.supportNetworkStreamIO(); e.networkLoaderName = a.getNetworkLoaderTypeName(); e.mseLiveFlvPlayback = e.mseFlvPlayback && e.networkStreamIO; e.nativeMP4H264Playback = a.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'); e.nativeWebmVP8Playback = a.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'); e.nativeWebmVP9Playback = a.supportNativeMediaPlayback('video/webm; codecs="vp9"'); return e } }]); return a }(); m.default = g }, { "../config.js": 5, "../io/io-controller.js": 23 }], 7: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); this.keyframesIndex = this.hasKeyframesIndex = this.segmentCount = this.segments = this.metadata = this.sarDen = this.sarNum = this.chromaFormat = this.level = this.profile = this.fps = this.height = this.width = this.audioChannelCount = this.audioSampleRate = this.videoDataRate = this.audioDataRate = this.videoCodec = this.audioCodec = this.hasVideo = this.hasAudio = this.duration = this.mimeType = null } l(f, [{ key: "isComplete", value: function () { var b = !1 === this.hasAudio || !0 === this.hasAudio && null != this.audioCodec && null != this.audioSampleRate && null != this.audioChannelCount, a = !1 === this.hasVideo || !0 === this.hasVideo && null != this.videoCodec && null != this.width && null != this.height && null != this.fps && null != this.profile && null != this.level && null != this.chromaFormat && null != this.sarNum && null != this.sarDen; return null != this.mimeType && null != this.duration && null != this.metadata && null != this.hasKeyframesIndex && b && a } }, { key: "isSeekable", value: function () { return !0 === this.hasKeyframesIndex } }, { key: "getNearestKeyframe", value: function (b) { if (null == this.keyframesIndex) return null; var a = this.keyframesIndex; b = this._search(a.times, b); return { index: b, milliseconds: a.times[b], fileposition: a.filepositions[b] } } }, { key: "_search", value: function (b, a) { var e = 0, d = b.length - 1, f, g = 0, t = d; a < b[0] && (e = 0, g = t + 1); for (; g <= t;) if (f = g + Math.floor((t - g) / 2), f === d || a >= b[f] && a < b[f + 1]) { e = f; break } else b[f] < a ? g = f + 1 : t = f - 1; return e } }]); return f }(); m.default = g }, {}], 8: [function (g, h, m) { function l(b, a) { if (!(b instanceof a)) throw new TypeError("Cannot call a class as a function"); } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function b(a, e) { for (var d = 0; d < e.length; d++) { var b = e[d]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (a, e, d) { e && b(a.prototype, e); d && b(a, d); return a } }(); m.SampleInfo = function a(e, d, f, g, t) { l(this, a); this.dts = e; this.pts = d; this.duration = f; this.originalDts = g; this.isSyncPoint = t; this.fileposition = null }; m.MediaSegmentInfo = function () { function a() { l(this, a); this.originalEndDts = this.originalBeginDts = this.endPts = this.beginPts = this.endDts = this.beginDts = 0; this.syncPoints = []; this.lastSample = this.firstSample = null } f(a, [{ key: "appendSyncPoint", value: function (a) { a.isSyncPoint = !0; this.syncPoints.push(a) } }]); return a }(); m.IDRSampleList = function () { function a() { l(this, a); this._list = [] } f(a, [{ key: "clear", value: function () { this._list = [] } }, { key: "appendArray", value: function (a) { var d = this._list; 0 !== a.length && (0 < d.length && a[0].originalDts < d[d.length - 1].originalDts && this.clear(), Array.prototype.push.apply(d, a)) } }, { key: "getLastSyncPointBeforeDts", value: function (a) { if (0 == this._list.length) return null; var d = this._list, e = 0, f = d.length - 1, g, n = 0, c = f; a < d[0].dts && (e = 0, n = c + 1); for (; n <= c;) if (g = n + Math.floor((c - n) / 2), g === f || a >= d[g].dts && a < d[g + 1].dts) { e = g; break } else d[g].dts < a ? n = g + 1 : c = g - 1; return this._list[e] } }]); return a }(); m.MediaSegmentInfoList = function () { function a(e) { l(this, a); this._type = e; this._list = []; this._lastAppendLocation = -1 } f(a, [{ key: "isEmpty", value: function () { return 0 === this._list.length } }, { key: "clear", value: function () { this._list = []; this._lastAppendLocation = -1 } }, { key: "_searchNearestSegmentBefore", value: function (a) { var d = this._list; if (0 === d.length) return -2; var e = d.length - 1, f, g = 0, n = e, c = 0; if (a < d[0].originalBeginDts) return -1; for (; g <= n;) if (f = g + Math.floor((n - g) / 2), f === e || a > d[f].lastSample.originalDts && a < d[f + 1].originalBeginDts) { c = f; break } else d[f].originalBeginDts < a ? g = f + 1 : n = f - 1; return c } }, { key: "_searchNearestSegmentAfter", value: function (a) { return this._searchNearestSegmentBefore(a) + 1 } }, { key: "append", value: function (a) { var d = this._list, e = this._lastAppendLocation, f = 0; -1 !== e && e < d.length && a.originalBeginDts >= d[e].lastSample.originalDts && (e === d.length - 1 || e < d.length - 1 && a.originalBeginDts < d[e + 1].originalBeginDts) ? f = e + 1 : 0 < d.length && (f = this._searchNearestSegmentBefore(a.originalBeginDts) + 1); this._lastAppendLocation = f; this._list.splice(f, 0, a) } }, { key: "getLastSegmentBefore", value: function (a) { a = this._searchNearestSegmentBefore(a); return 0 <= a ? this._list[a] : null } }, { key: "getLastSampleBefore", value: function (a) { a = this.getLastSegmentBefore(a); return null != a ? a.lastSample : null } }, { key: "getLastSyncPointBefore", value: function (a) { a = this._searchNearestSegmentBefore(a); for (var d = this._list[a].syncPoints; 0 === d.length && 0 < a;) a--, d = this._list[a].syncPoints; return 0 < d.length ? d[d.length - 1] : null } }, { key: "type", get: function () { return this._type } }, { key: "length", get: function () { return this._list.length } }]); return a }() }, {}], 9: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function a(a, c) { for (var k = 0; k < c.length; k++) { var q = c[k]; q.enumerable = q.enumerable || !1; q.configurable = !0; "value" in q && (q.writable = !0); Object.defineProperty(a, q.key, q) } } return function (d, c, k) { c && a(d.prototype, c); k && a(d, k); return d } }(); h = g("events"); var b = l(h); h = g("../utils/logger.js"); var a = l(h); h = g("../utils/browser.js"); var e = l(h); h = g("./mse-events.js"); var d = l(h), p = g("./media-segment-info.js"), r = g("../utils/exception.js"); g = function () { function g() { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this.TAG = "MSEController"; this._emitter = new b.default; this.e = { onSourceOpen: this._onSourceOpen.bind(this), onSourceEnded: this._onSourceEnded.bind(this), onSourceClose: this._onSourceClose.bind(this), onSourceBufferError: this._onSourceBufferError.bind(this), onSourceBufferUpdateEnd: this._onSourceBufferUpdateEnd.bind(this) }; this._mediaElement = this._mediaSourceObjectURL = this._mediaSource = null; this._hasPendingEos = this._isBufferFull = !1; this._pendingSourceBufferInit = []; this._mimeTypes = { video: null, audio: null }; this._sourceBuffers = { video: null, audio: null }; this._lastInitSegments = { video: null, audio: null }; this._pendingSegments = { video: [], audio: [] }; this._pendingRemoveRanges = { video: [], audio: [] }; this._idrList = new p.IDRSampleList } f(g, [{ key: "destroy", value: function () { (this._mediaElement || this._mediaSource) && this.detachMediaElement(); this.e = null; this._emitter.removeAllListeners(); this._emitter = null } }, { key: "on", value: function (a, c) { this._emitter.addListener(a, c) } }, { key: "off", value: function (a, c) { this._emitter.removeListener(a, c) } }, { key: "attachMediaElement", value: function (a) { if (this._mediaSource) throw new r.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!"); var c = this._mediaSource = new window.MediaSource; c.addEventListener("sourceopen", this.e.onSourceOpen); c.addEventListener("sourceended", this.e.onSourceEnded); c.addEventListener("sourceclose", this.e.onSourceClose); this._mediaElement = a; this._mediaSourceObjectURL = window.URL.createObjectURL(this._mediaSource); a.src = this._mediaSourceObjectURL } }, { key: "detachMediaElement", value: function () { if (this._mediaSource) { var d = this._mediaSource, c; for (c in this._sourceBuffers) { var k = this._pendingSegments[c]; k.splice(0, k.length); this._pendingSegments[c] = null; this._pendingRemoveRanges[c] = null; this._lastInitSegments[c] = null; if (k = this._sourceBuffers[c]) "closed" !== d.readyState && (d.removeSourceBuffer(k), k.removeEventListener("error", this.e.onSourceBufferError), k.removeEventListener("updateend", this.e.onSourceBufferUpdateEnd)), this._mimeTypes[c] = null, this._sourceBuffers[c] = null } if ("open" === d.readyState) try { d.endOfStream() } catch (q) { a.default.e(this.TAG, q.message) } d.removeEventListener("sourceopen", this.e.onSourceOpen); d.removeEventListener("sourceended", this.e.onSourceEnded); d.removeEventListener("sourceclose", this.e.onSourceClose); this._pendingSourceBufferInit = []; this._isBufferFull = !1; this._idrList.clear(); this._mediaSource = null } this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src"), this._mediaElement = null); this._mediaSourceObjectURL && (window.URL.revokeObjectURL(this._mediaSourceObjectURL), this._mediaSourceObjectURL = null) } }, { key: "appendInitSegment", value: function (e, c) { if (this._mediaSource && "open" === this._mediaSource.readyState) { var k = e.container + ";codecs=" + e.codec, q = !1; a.default.v(this.TAG, "Received Initialization Segment, mimeType: " + k); this._lastInitSegments[e.type] = e; if (k !== this._mimeTypes[e.type]) { if (this._mimeTypes[e.type]) a.default.v(this.TAG, "Notice: " + e.type + " mimeType changed, origin: " + this._mimeTypes[e.type] + ", target: " + k); else { q = !0; try { var b = this._sourceBuffers[e.type] = this._mediaSource.addSourceBuffer(k); b.addEventListener("error", this.e.onSourceBufferError); b.addEventListener("updateend", this.e.onSourceBufferUpdateEnd) } catch (C) { a.default.e(this.TAG, C.message); this._emitter.emit(d.default.ERROR, { code: C.code, msg: C.message }); return } } this._mimeTypes[e.type] = k } c || this._pendingSegments[e.type].push(e); q || this._sourceBuffers[e.type] && !this._sourceBuffers[e.type].updating && this._doAppendSegments() } else this._pendingSourceBufferInit.push(e), this._pendingSegments[e.type].push(e) } }, { key: "appendMediaSegment", value: function (a) { this._pendingSegments[a.type].push(a); a = this._sourceBuffers[a.type]; !a || a.updating || this._hasPendingRemoveRanges() || this._doAppendSegments() } }, { key: "seek", value: function (d) { for (var c in this._sourceBuffers) if (this._sourceBuffers[c]) { d = this._sourceBuffers[c]; if ("open" === this._mediaSource.readyState) try { d.abort() } catch (C) { a.default.e(this.TAG, C.message) } this._idrList.clear(); var k = this._pendingSegments[c]; k.splice(0, k.length); if ("closed" !== this._mediaSource.readyState) { for (k = 0; k < d.buffered.length; k++) { var q = d.buffered.start(k), b = d.buffered.end(k); this._pendingRemoveRanges[c].push({ start: q, end: b }) } d.updating || this._doRemoveRanges(); e.default.safari && (k = this._lastInitSegments[c]) && (this._pendingSegments[c].push(k), d.updating || this._doAppendSegments()) } } } }, { key: "endOfStream", value: function () { var a = this._mediaSource, c = this._sourceBuffers; a && "open" === a.readyState ? c.video && c.video.updating || c.audio && c.audio.updating ? this._hasPendingEos = !0 : (this._hasPendingEos = !1, a.endOfStream()) : a && "closed" === a.readyState && this._hasPendingSegments() && (this._hasPendingEos = !0) } }, { key: "getNearestKeyframe", value: function (a) { return this._idrList.getLastSyncPointBeforeDts(a) } }, { key: "_doRemoveRanges", value: function () { for (var a in this._pendingRemoveRanges) if (this._sourceBuffers[a] && !this._sourceBuffers[a].updating) for (var c = this._sourceBuffers[a], k = this._pendingRemoveRanges[a]; k.length && !c.updating;) { var d = k.shift(); c.remove(d.start, d.end) } } }, { key: "_doAppendSegments", value: function () { var e = this._pendingSegments, c; for (c in e) if (this._sourceBuffers[c] && !this._sourceBuffers[c].updating && 0 < e[c].length) { var k = e[c].shift(); try { this._sourceBuffers[c].appendBuffer(k.data), this._isBufferFull = !1, "video" === c && k.hasOwnProperty("info") && this._idrList.appendArray(k.info.syncPoints) } catch (u) { this._pendingSegments[c].unshift(k), 22 === u.code ? (this._isBufferFull || this._emitter.emit(d.default.BUFFER_FULL), this._isBufferFull = !0) : (a.default.e(this.TAG, u.message), this._emitter.emit(d.default.ERROR, { code: u.code, msg: u.message })) } } for (var e = ["video", "audio"], q = k = c = 0; q < e.length; q++) { var b = this._sourceBuffers[e[q]]; if (b) for (var f = 0; f < b.buffered.length; f++) c = 0 == c ? b.buffered.start(f) : Math.min(b.buffered.start(f), c), k = Math.max(b.buffered.end(f), k) } if (20 < k - c) for (q = 0; q < e.length; q++) if (b = this._sourceBuffers[e[q]]) this._pendingRemoveRanges[e[q]].push({ start: 0, end: k - 10 }), this._doRemoveRanges(); 4 < k - this._mediaElement.currentTime && (this._mediaElement.currentTime = k - .5); 2 == this._mediaElement.playbackRate && 1 > k - this._mediaElement.currentTime && (this._mediaElement.playbackRate = 1) } }, { key: "_onSourceOpen", value: function () { a.default.v(this.TAG, "MediaSource onSourceOpen"); this._mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen); if (0 < this._pendingSourceBufferInit.length) for (var e = this._pendingSourceBufferInit; e.length;) { var c = e.shift(); this.appendInitSegment(c, !0) } this._hasPendingSegments() && this._doAppendSegments(); this._emitter.emit(d.default.SOURCE_OPEN) } }, { key: "_onSourceEnded", value: function () { a.default.v(this.TAG, "MediaSource onSourceEnded") } }, { key: "_onSourceClose", value: function () { a.default.v(this.TAG, "MediaSource onSourceClose"); this._mediaSource && null != this.e && (this._mediaSource.removeEventListener("sourceopen", this.e.onSourceOpen), this._mediaSource.removeEventListener("sourceended", this.e.onSourceEnded), this._mediaSource.removeEventListener("sourceclose", this.e.onSourceClose)) } }, { key: "_hasPendingSegments", value: function () { var a = this._pendingSegments; return 0 < a.video.length || 0 < a.audio.length } }, { key: "_hasPendingRemoveRanges", value: function () { var a = this._pendingRemoveRanges; return 0 < a.video.length || 0 < a.audio.length } }, { key: "_onSourceBufferUpdateEnd", value: function () { this._hasPendingRemoveRanges() ? this._doRemoveRanges() : this._hasPendingSegments() ? this._doAppendSegments() : this._hasPendingEos && this.endOfStream(); this._emitter.emit(d.default.UPDATE_END) } }, { key: "_onSourceBufferError", value: function (d) { a.default.e(this.TAG, "SourceBuffer Error: " + d) } }]); return g }(); m.default = g }, { "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./media-segment-info.js": 8, "./mse-events.js": 10, events: 2 }], 10: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.default = { ERROR: "error", SOURCE_OPEN: "source_open", UPDATE_END: "update_end", BUFFER_FULL: "buffer_full" } }, {}], 11: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function a(a, k) { for (var c = 0; c < k.length; c++) { var d = k[c]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (c, k, d) { k && a(c.prototype, k); d && a(c, d); return c } }(); h = g("events"); var b = l(h); h = g("../utils/logger.js"); var a = l(h); h = g("../utils/logging-control.js"); var e = l(h); h = g("./transmuxing-controller.js"); var d = l(h); h = g("./transmuxing-events.js"); var p = l(h); h = g("./transmuxing-worker.js"); var r = l(h); h = g("./media-info.js"); var t = l(h); h = function () { function n(c, k) { if (!(this instanceof n)) throw new TypeError("Cannot call a class as a function"); this.TAG = "Transmuxer"; this._emitter = new b.default; if (k.enableWorker && "undefined" !== typeof Worker) try { this._worker = g("webworkify")(r.default), this._workerDestroying = !1, this._worker.addEventListener("message", this._onWorkerMessage.bind(this)), this._worker.postMessage({ cmd: "init", param: [c, k] }), this.e = { onLoggingConfigChanged: this._onLoggingConfigChanged.bind(this) }, e.default.registerListener(this.e.onLoggingConfigChanged), this._worker.postMessage({ cmd: "logging_config", param: e.default.getConfig() }) } catch (q) { a.default.e(this.TAG, "Error while initialize transmuxing worker, fallback to inline transmuxing"), this._worker = null, this._controller = new d.default(c, k) } else this._controller = new d.default(c, k); this._controller && (c = this._controller, c.on(p.default.IO_ERROR, this._onIOError.bind(this)), c.on(p.default.DEMUX_ERROR, this._onDemuxError.bind(this)), c.on(p.default.INIT_SEGMENT, this._onInitSegment.bind(this)), c.on(p.default.MEDIA_SEGMENT, this._onMediaSegment.bind(this)), c.on(p.default.LOADING_COMPLETE, this._onLoadingComplete.bind(this)), c.on(p.default.RECOVERED_EARLY_EOF, this._onRecoveredEarlyEof.bind(this)), c.on(p.default.MEDIA_INFO, this._onMediaInfo.bind(this)), c.on(p.default.STATISTICS_INFO, this._onStatisticsInfo.bind(this)), c.on(p.default.RECOMMEND_SEEKPOINT, this._onRecommendSeekpoint.bind(this))) } f(n, [{ key: "destroy", value: function () { this._worker ? this._workerDestroying || (this._workerDestroying = !0, this._worker.postMessage({ cmd: "destroy" }), e.default.removeListener(this.e.onLoggingConfigChanged), this.e = null) : (this._controller.destroy(), this._controller = null); this._emitter.removeAllListeners(); this._emitter = null } }, { key: "on", value: function (a, k) { this._emitter.addListener(a, k) } }, { key: "off", value: function (a, k) { this._emitter.removeListener(a, k) } }, { key: "hasWorker", value: function () { return null != this._worker } }, { key: "open", value: function () { this._worker ? this._worker.postMessage({ cmd: "start" }) : this._controller.start() } }, { key: "close", value: function () { this._worker ? this._worker.postMessage({ cmd: "stop" }) : this._controller.stop() } }, { key: "seek", value: function (a) { this._worker ? this._worker.postMessage({ cmd: "seek", param: a }) : this._controller.seek(a) } }, { key: "pause", value: function () { this._worker ? this._worker.postMessage({ cmd: "pause" }) : this._controller.pause() } }, { key: "resume", value: function () { this._worker ? this._worker.postMessage({ cmd: "resume" }) : this._controller.resume() } }, { key: "_onInitSegment", value: function (a, k) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.INIT_SEGMENT, a, k) }) } }, { key: "_onMediaSegment", value: function (a, k) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.MEDIA_SEGMENT, a, k) }) } }, { key: "_onLoadingComplete", value: function () { var a = this; Promise.resolve().then(function () { a._emitter.emit(p.default.LOADING_COMPLETE) }) } }, { key: "_onRecoveredEarlyEof", value: function () { var a = this; Promise.resolve().then(function () { a._emitter.emit(p.default.RECOVERED_EARLY_EOF) }) } }, { key: "_onMediaInfo", value: function (a) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.MEDIA_INFO, a) }) } }, { key: "_onStatisticsInfo", value: function (a) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.STATISTICS_INFO, a) }) } }, { key: "_onIOError", value: function (a, k) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.IO_ERROR, a, k) }) } }, { key: "_onDemuxError", value: function (a, k) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.DEMUX_ERROR, a, k) }) } }, { key: "_onRecommendSeekpoint", value: function (a) { var c = this; Promise.resolve().then(function () { c._emitter.emit(p.default.RECOMMEND_SEEKPOINT, a) }) } }, { key: "_onLoggingConfigChanged", value: function (a) { this._worker && this._worker.postMessage({ cmd: "logging_config", param: a }) } }, { key: "_onWorkerMessage", value: function (a) { a = a.data; var c = a.data; if ("destroyed" === a.msg || this._workerDestroying) this._workerDestroying = !1, this._worker.terminate(), this._worker = null; else switch (a.msg) { case p.default.INIT_SEGMENT: case p.default.MEDIA_SEGMENT: this._emitter.emit(a.msg, c.type, c.data); break; case p.default.LOADING_COMPLETE: case p.default.RECOVERED_EARLY_EOF: this._emitter.emit(a.msg); break; case p.default.MEDIA_INFO: Object.setPrototypeOf(c, t.default.prototype); this._emitter.emit(a.msg, c); break; case p.default.STATISTICS_INFO: this._emitter.emit(a.msg, c); break; case p.default.IO_ERROR: case p.default.DEMUX_ERROR: this._emitter.emit(a.msg, c.type, c.info); break; case p.default.RECOMMEND_SEEKPOINT: this._emitter.emit(a.msg, c) } } }]); return n }(); m.default = h }, { "../utils/logger.js": 41, "../utils/logging-control.js": 42, "./media-info.js": 7, "./transmuxing-controller.js": 12, "./transmuxing-events.js": 13, "./transmuxing-worker.js": 14, events: 2, webworkify: 4 }], 12: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function a(a, c) { for (var k = 0; k < c.length; k++) { var d = c[k]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (c, k, d) { k && a(c.prototype, k); d && a(c, d); return c } }(); h = g("events"); var b = l(h); h = g("../utils/logger.js"); var a = l(h); h = g("../utils/browser.js"); var e = l(h); h = g("./media-info.js"); var d = l(h); h = g("../demux/flv-demuxer.js"); var p = l(h); h = g("../remux/mp4-remuxer.js"); var r = l(h); h = g("../demux/demux-errors.js"); var t = l(h); h = g("../io/io-controller.js"); var n = l(h); h = g("./transmuxing-events.js"); var c = l(h); g("../io/loader.js"); g = function () { function k(a, c) { if (!(this instanceof k)) throw new TypeError("Cannot call a class as a function"); this.TAG = "TransmuxingController"; this._emitter = new b.default; this._config = c; a.segments || (a.segments = [{ duration: a.duration, filesize: a.filesize, url: a.url }]); "boolean" !== typeof a.cors && (a.cors = !0); "boolean" !== typeof a.withCredentials && (a.withCredentials = !1); this._mediaDataSource = a; var d = this._currentSegmentIndex = 0; this._mediaDataSource.segments.forEach(function (c) { c.timestampBase = d; d += c.duration; c.cors = a.cors; c.withCredentials = a.withCredentials }); isNaN(d) || this._mediaDataSource.duration === d || (this._mediaDataSource.duration = d); this._statisticsReporter = this._pendingResolveSeekPoint = this._pendingSeekTime = this._ioctl = this._remuxer = this._demuxer = this._mediaInfo = null } f(k, [{ key: "destroy", value: function () { this._mediaDataSource = this._mediaInfo = null; this._statisticsReporter && this._disableStatisticsReporter(); this._ioctl && (this._ioctl.destroy(), this._ioctl = null); this._demuxer && (this._demuxer.destroy(), this._demuxer = null); this._remuxer && (this._remuxer.destroy(), this._remuxer = null); this._emitter.removeAllListeners(); this._emitter = null } }, { key: "on", value: function (a, c) { this._emitter.addListener(a, c) } }, { key: "off", value: function (a, c) { this._emitter.removeListener(a, c) } }, { key: "start", value: function () { this._loadSegment(0); this._enableStatisticsReporter() } }, { key: "_loadSegment", value: function (a, c) { this._currentSegmentIndex = a; a = this._ioctl = new n.default(this._mediaDataSource.segments[a], this._config, a); a.onError = this._onIOException.bind(this); a.onSeeked = this._onIOSeeked.bind(this); a.onComplete = this._onIOComplete.bind(this); a.onRecoveredEarlyEof = this._onIORecoveredEarlyEof.bind(this); c ? this._demuxer.bindDataSource(this._ioctl) : a.onDataArrival = this._onInitChunkArrival.bind(this); a.open(c) } }, { key: "stop", value: function () { this._internalAbort(); this._disableStatisticsReporter() } }, { key: "_internalAbort", value: function () { this._ioctl && (this._ioctl.destroy(), this._ioctl = null) } }, { key: "pause", value: function () { this._ioctl && this._ioctl.isWorking() && (this._ioctl.pause(), this._disableStatisticsReporter()) } }, { key: "resume", value: function () { this._ioctl && this._ioctl.isPaused() && (this._ioctl.resume(), this._enableStatisticsReporter()) } }, { key: "seek", value: function (a) { if (null != this._mediaInfo && this._mediaInfo.isSeekable()) { var c = this._searchSegmentIndexContains(a); if (c === this._currentSegmentIndex) c = this._mediaInfo.segments[c], void 0 == c ? this._pendingSeekTime = a : (a = c.getNearestKeyframe(a), this._remuxer.seek(a.milliseconds), this._ioctl.seek(a.fileposition), this._pendingResolveSeekPoint = a.milliseconds); else { var d = this._mediaInfo.segments[c]; void 0 == d ? (this._pendingSeekTime = a, this._internalAbort(), this._remuxer.seek(), this._remuxer.insertDiscontinuity(), this._loadSegment(c)) : (d = d.getNearestKeyframe(a), this._internalAbort(), this._remuxer.seek(a), this._remuxer.insertDiscontinuity(), this._demuxer.resetMediaInfo(), this._demuxer.timestampBase = this._mediaDataSource.segments[c].timestampBase, this._loadSegment(c, d.fileposition), this._pendingResolveSeekPoint = d.milliseconds, this._reportSegmentMediaInfo(c)) } this._enableStatisticsReporter() } } }, { key: "_searchSegmentIndexContains", value: function (a) { for (var c = this._mediaDataSource.segments, d = c.length - 1, k = 0; k < c.length; k++) if (a < c[k].timestampBase) { d = k - 1; break } return d } }, { key: "_onInitChunkArrival", value: function (d, k) { var e = this, b = null, b = 0; 0 < k ? (this._demuxer.bindDataSource(this._ioctl), this._demuxer.timestampBase = this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase, b = this._demuxer.parseChunks(d, k)) : (b = p.default.probe(d)).match ? (this._demuxer = new p.default(b, this._config), this._remuxer || (this._remuxer = new r.default(this._config)), b = this._mediaDataSource, void 0 == b.duration || isNaN(b.duration) || (this._demuxer.overridedDuration = b.duration), this._demuxer.timestampBase = b.segments[this._currentSegmentIndex].timestampBase, this._demuxer.onError = this._onDemuxException.bind(this), this._demuxer.onMediaInfo = this._onMediaInfo.bind(this), this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)), this._remuxer.onInitSegment = this._onRemuxerInitSegmentArrival.bind(this), this._remuxer.onMediaSegment = this._onRemuxerMediaSegmentArrival.bind(this), b = this._demuxer.parseChunks(d, k)) : (b = null, a.default.e(this.TAG, "Non-FLV, Unsupported media type!"), Promise.resolve().then(function () { e._internalAbort() }), this._emitter.emit(c.default.DEMUX_ERROR, t.default.FORMAT_UNSUPPORTED, "Non-FLV, Unsupported media type"), b = 0); return b } }, { key: "_onMediaInfo", value: function (a) { var c = this; null == this._mediaInfo && (this._mediaInfo = Object.assign({}, a), this._mediaInfo.keyframesIndex = null, this._mediaInfo.segments = [], this._mediaInfo.segmentCount = this._mediaDataSource.segments.length, Object.setPrototypeOf(this._mediaInfo, d.default.prototype)); a = Object.assign({}, a); Object.setPrototypeOf(a, d.default.prototype); this._mediaInfo.segments[this._currentSegmentIndex] = a; this._reportSegmentMediaInfo(this._currentSegmentIndex); null != this._pendingSeekTime && Promise.resolve().then(function () { var a = c._pendingSeekTime; c._pendingSeekTime = null; c.seek(a) }) } }, { key: "_onIOSeeked", value: function () { this._remuxer.insertDiscontinuity() } }, { key: "_onIOComplete", value: function (a) { a += 1; a < this._mediaDataSource.segments.length ? (this._internalAbort(), this._loadSegment(a)) : (this._emitter.emit(c.default.LOADING_COMPLETE), this._disableStatisticsReporter()) } }, { key: "_onIORecoveredEarlyEof", value: function () { this._emitter.emit(c.default.RECOVERED_EARLY_EOF) } }, { key: "_onIOException", value: function (d, k) { a.default.e(this.TAG, "IOException: type = " + d + ", code = " + k.code + ", msg = " + k.msg); this._emitter.emit(c.default.IO_ERROR, d, k); this._disableStatisticsReporter() } }, { key: "_onDemuxException", value: function (d, k) { a.default.e(this.TAG, "DemuxException: type = " + d + ", info = " + k); this._emitter.emit(c.default.DEMUX_ERROR, d, k) } }, { key: "_onRemuxerInitSegmentArrival", value: function (a, d) { this._emitter.emit(c.default.INIT_SEGMENT, a, d) } }, { key: "_onRemuxerMediaSegmentArrival", value: function (a, d) { null == this._pendingSeekTime && (this._emitter.emit(c.default.MEDIA_SEGMENT, a, d), null != this._pendingResolveSeekPoint && "video" === a && (a = d.info.syncPoints, d = this._pendingResolveSeekPoint, this._pendingResolveSeekPoint = null, e.default.safari && 0 < a.length && a[0].originalDts === d && (d = a[0].pts), this._emitter.emit(c.default.RECOMMEND_SEEKPOINT, d))) } }, { key: "_enableStatisticsReporter", value: function () { null == this._statisticsReporter && (this._statisticsReporter = self.setInterval(this._reportStatisticsInfo.bind(this), this._config.statisticsInfoReportInterval)) } }, { key: "_disableStatisticsReporter", value: function () { this._statisticsReporter && (self.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "_reportSegmentMediaInfo", value: function (a) { a = Object.assign({}, this._mediaInfo.segments[a]); a.duration = this._mediaInfo.duration; a.segmentCount = this._mediaInfo.segmentCount; delete a.segments; delete a.keyframesIndex; this._emitter.emit(c.default.MEDIA_INFO, a) } }, { key: "_reportStatisticsInfo", value: function () { var a = {}; a.url = this._ioctl.currentUrl; a.speed = this._ioctl.currentSpeed; a.loaderType = this._ioctl.loaderType; a.currentSegmentIndex = this._currentSegmentIndex; a.totalSegmentCount = this._mediaDataSource.segments.length; this._emitter.emit(c.default.STATISTICS_INFO, a) } }]); return k }(); m.default = g }, { "../demux/demux-errors.js": 16, "../demux/flv-demuxer.js": 18, "../io/io-controller.js": 23, "../io/loader.js": 24, "../remux/mp4-remuxer.js": 38, "../utils/browser.js": 39, "../utils/logger.js": 41, "./media-info.js": 7, "./transmuxing-events.js": 13, events: 2 }], 13: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.default = { IO_ERROR: "io_error", DEMUX_ERROR: "demux_error", INIT_SEGMENT: "init_segment", MEDIA_SEGMENT: "media_segment", LOADING_COMPLETE: "loading_complete", RECOVERED_EARLY_EOF: "recovered_early_eof", MEDIA_INFO: "media_info", STATISTICS_INFO: "statistics_info", RECOMMEND_SEEKPOINT: "recommend_seekpoint" } }, {}], 14: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); h = g("../utils/logger.js"); l(h); h = g("../utils/logging-control.js"); var f = l(h); h = g("../utils/polyfill.js"); var b = l(h); h = g("./transmuxing-controller.js"); var a = l(h); g = g("./transmuxing-events.js"); var e = l(g); m.default = function (d) { function g(a, c) { d.postMessage({ msg: e.default.INIT_SEGMENT, data: { type: a, data: c } }, [c.data]) } function h(a, c) { d.postMessage({ msg: e.default.MEDIA_SEGMENT, data: { type: a, data: c } }, [c.data]) } function t() { d.postMessage({ msg: e.default.LOADING_COMPLETE }) } function n() { d.postMessage({ msg: e.default.RECOVERED_EARLY_EOF }) } function c(a) { d.postMessage({ msg: e.default.MEDIA_INFO, data: a }) } function k(a) { d.postMessage({ msg: e.default.STATISTICS_INFO, data: a }) } function q(a, c) { d.postMessage({ msg: e.default.IO_ERROR, data: { type: a, info: c } }) } function w(a, c) { d.postMessage({ msg: e.default.DEMUX_ERROR, data: { type: a, info: c } }) } function C(a) { d.postMessage({ msg: e.default.RECOMMEND_SEEKPOINT, data: a }) } var u = null; b.default.install(); d.addEventListener("message", function (b) { switch (b.data.cmd) { case "init": u = new a.default(b.data.param[0], b.data.param[1]); u.on(e.default.IO_ERROR, q.bind(this)); u.on(e.default.DEMUX_ERROR, w.bind(this)); u.on(e.default.INIT_SEGMENT, g.bind(this)); u.on(e.default.MEDIA_SEGMENT, h.bind(this)); u.on(e.default.LOADING_COMPLETE, t.bind(this)); u.on(e.default.RECOVERED_EARLY_EOF, n.bind(this)); u.on(e.default.MEDIA_INFO, c.bind(this)); u.on(e.default.STATISTICS_INFO, k.bind(this)); u.on(e.default.RECOMMEND_SEEKPOINT, C.bind(this)); break; case "destroy": u && (u.destroy(), u = null); d.postMessage({ msg: "destroyed" }); break; case "start": u.start(); break; case "stop": u.stop(); break; case "seek": u.seek(b.data.param); break; case "pause": u.pause(); break; case "resume": u.resume(); break; case "logging_config": f.default.applyConfig(b.data.param) } }) } }, { "../utils/logger.js": 41, "../utils/logging-control.js": 42, "../utils/polyfill.js": 43, "./transmuxing-controller.js": 12, "./transmuxing-events.js": 13 }], 15: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function a(a, d) { for (var e = 0; e < d.length; e++) { var b = d[e]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (d, e, b) { e && a(d.prototype, e); b && a(d, b); return d } }(), f = (h = g("../utils/logger.js")) && h.__esModule ? h : { default: h }, b = (h = g("../utils/utf8-conv.js")) && h.__esModule ? h : { default: h }, a = g("../utils/exception.js"), e = function () { var a = new ArrayBuffer(2); (new DataView(a)).setInt16(0, 256, !0); return 256 === (new Int16Array(a))[0] }(); g = function () { function d() { if (!(this instanceof d)) throw new TypeError("Cannot call a class as a function"); } l(d, null, [{ key: "parseScriptData", value: function (a, e, b) { var n = {}; try { var c = d.parseValue(a, e, b), k = d.parseValue(a, e + c.size, b - c.size); n[c.data] = k.data } catch (q) { f.default.e("AMF", q.toString()) } return n } }, { key: "parseObject", value: function (e, b, f) { if (3 > f) throw new a.IllegalStateException("Data not enough when parse ScriptDataObject"); var n = d.parseString(e, b, f); e = d.parseValue(e, b + n.size, f - n.size); return { data: { name: n.data, value: e.data }, size: n.size + e.size, objectEnd: e.objectEnd } } }, { key: "parseVariable", value: function (a, e, b) { return d.parseObject(a, e, b) } }, { key: "parseString", value: function (d, f, g) { if (2 > g) throw new a.IllegalStateException("Data not enough when parse String"); g = (new DataView(d, f, g)).getUint16(0, !e); return { data: 0 < g ? (0, b.default)(new Uint8Array(d, f + 2, g)) : "", size: 2 + g } } }, { key: "parseLongString", value: function (d, f, g) { if (4 > g) throw new a.IllegalStateException("Data not enough when parse LongString"); g = (new DataView(d, f, g)).getUint32(0, !e); return { data: 0 < g ? (0, b.default)(new Uint8Array(d, f + 4, g)) : "", size: 4 + g } } }, { key: "parseDate", value: function (d, b, f) { if (10 > f) throw new a.IllegalStateException("Data size invalid when parse Date"); b = new DataView(d, b, f); d = b.getFloat64(0, !e); b = b.getInt16(8, !e); return { data: new Date(d + 6E4 * b), size: 10 } } }, { key: "parseValue", value: function (b, g, h) { if (1 > h) throw new a.IllegalStateException("Data not enough when parse Value"); var n = new DataView(b, g, h), c = 1, k = n.getUint8(0), q = void 0, w = !1; try { switch (k) { case 0: q = n.getFloat64(1, !e); c += 8; break; case 1: q = n.getUint8(1) ? !0 : !1; c += 1; break; case 2: var C = d.parseString(b, g + 1, h - 1), q = C.data, c = c + C.size; break; case 3: var q = {}, u = 0; for (9 === (n.getUint32(h - 4, !e) & 16777215) && (u = 3) ; c < h - 4;) { var p = d.parseObject(b, g + c, h - c - u); if (p.objectEnd) break; q[p.data.name] = p.data.value; c += p.size } c <= h - 3 && 9 === (n.getUint32(c - 1, !e) & 16777215) && (c += 3); break; case 8: q = {}; c += 4; p = 0; for (9 === (n.getUint32(h - 4, !e) & 16777215) && (p = 3) ; c < h - 8;) { u = d.parseVariable(b, g + c, h - c - p); if (u.objectEnd) break; q[u.data.name] = u.data.value; c += u.size } c <= h - 3 && 9 === (n.getUint32(c - 1, !e) & 16777215) && (c += 3); break; case 9: q = void 0; c = 1; w = !0; break; case 10: for (var q = [], r = n.getUint32(1, !e), c = c + 4, n = 0; n < r; n++) { var t = d.parseValue(b, g + c, h - c); q.push(t.data); c += t.size } break; case 11: var l = d.parseDate(b, g + 1, h - 1), q = l.data, c = c + l.size; break; case 12: var m = d.parseString(b, g + 1, h - 1), q = m.data, c = c + m.size; break; default: c = h, f.default.w("AMF", "Unsupported AMF value type " + k) } } catch (y) { f.default.e("AMF", y.toString()) } return { data: q, size: c, objectEnd: w } } }]); return d }(); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "../utils/utf8-conv.js": 44 }], 16: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.default = { OK: "OK", FORMAT_ERROR: "FormatError", FORMAT_UNSUPPORTED: "FormatUnsupported", CODEC_UNSUPPORTED: "CodecUnsupported" } }, {}], 17: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function b(a, b) { for (var d = 0; d < b.length; d++) { var e = b[d]; e.enumerable = e.enumerable || !1; e.configurable = !0; "value" in e && (e.writable = !0); Object.defineProperty(a, e.key, e) } } return function (a, e, d) { e && b(a.prototype, e); d && b(a, d); return a } }(), f = g("../utils/exception.js"); g = function () { function b(a) { if (!(this instanceof b)) throw new TypeError("Cannot call a class as a function"); this.TAG = "ExpGolomb"; this._buffer = a; this._buffer_index = 0; this._total_bytes = a.byteLength; this._total_bits = 8 * a.byteLength; this._current_word_bits_left = this._current_word = 0 } l(b, [{ key: "destroy", value: function () { this._buffer = null } }, { key: "_fillCurrentWord", value: function () { var a = this._total_bytes - this._buffer_index; if (0 >= a) throw new f.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available"); var a = Math.min(4, a), b = new Uint8Array(4); b.set(this._buffer.subarray(this._buffer_index, this._buffer_index + a)); this._current_word = (new DataView(b.buffer)).getUint32(0, !1); this._buffer_index += a; this._current_word_bits_left = 8 * a } }, { key: "readBits", value: function (a) { if (32 < a) throw new f.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!"); if (a <= this._current_word_bits_left) { var b = this._current_word >>> 32 - a; this._current_word <<= a; this._current_word_bits_left -= a; return b } b = this._current_word_bits_left ? this._current_word : 0; b >>>= 32 - this._current_word_bits_left; a -= this._current_word_bits_left; this._fillCurrentWord(); a = Math.min(a, this._current_word_bits_left); var d = this._current_word >>> 32 - a; this._current_word <<= a; this._current_word_bits_left -= a; return b << a | d } }, { key: "readBool", value: function () { return 1 === this.readBits(1) } }, { key: "readByte", value: function () { return this.readBits(8) } }, { key: "_skipLeadingZero", value: function () { var a; for (a = 0; a < this._current_word_bits_left; a++) if (0 !== (this._current_word & 2147483648 >>> a)) return this._current_word <<= a, this._current_word_bits_left -= a, a; this._fillCurrentWord(); return a + this._skipLeadingZero() } }, { key: "readUEG", value: function () { var a = this._skipLeadingZero(); return this.readBits(a + 1) - 1 } }, { key: "readSEG", value: function () { var a = this.readUEG(); return a & 1 ? a + 1 >>> 1 : -1 * (a >>> 1) } }]); return b }(); m.default = g }, { "../utils/exception.js": 40 }], 18: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function () { function a(a, d) { for (var c = 0; c < d.length; c++) { var k = d[c]; k.enumerable = k.enumerable || !1; k.configurable = !0; "value" in k && (k.writable = !0); Object.defineProperty(a, k.key, k) } } return function (c, d, b) { d && a(c.prototype, d); b && a(c, b); return c } }(); h = g("../utils/logger.js"); var a = l(h); h = g("./amf-parser.js"); var e = l(h); h = g("./sps-parser.js"); var d = l(h); h = g("./demux-errors.js"); var p = l(h); h = g("../core/media-info.js"); var r = l(h), t = g("../utils/exception.js"); g = function () { function g(a, d) { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this.TAG = "FLVDemuxer"; this._config = d; this._onDataAvailable = this._onTrackMetadata = this._onMediaInfo = this._onError = null; this._dataOffset = a.dataOffset; this._firstParse = !0; this._dispatch = !1; this._hasAudio = a.hasAudioTrack; this._hasVideo = a.hasVideoTrack; this._videoInitialMetadataDispatched = this._audioInitialMetadataDispatched = !1; this._mediaInfo = new r.default; this._mediaInfo.hasAudio = this._hasAudio; this._mediaInfo.hasVideo = this._hasVideo; this._videoMetadata = this._audioMetadata = this._metadata = null; this._naluLengthSize = 4; this._timestampBase = 0; this._timescale = 1E3; this._duration = 0; this._durationOverrided = !1; this._referenceFrameRate = { fixed: !0, fps: 23.976, fps_num: 23976, fps_den: 1E3 }; this._videoTrack = { type: "video", id: 1, sequenceNumber: 0, samples: [], length: 0 }; this._audioTrack = { type: "audio", id: 2, sequenceNumber: 0, samples: [], length: 0 }; a = new ArrayBuffer(2); (new DataView(a)).setInt16(0, 256, !0); this._littleEndian = 256 === (new Int16Array(a))[0] } b(g, [{ key: "destroy", value: function () { this._onDataAvailable = this._onTrackMetadata = this._onMediaInfo = this._onError = this._audioTrack = this._videoTrack = this._videoMetadata = this._audioMetadata = this._metadata = this._mediaInfo = null } }, { key: "bindDataSource", value: function (a) { a.onDataArrival = this.parseChunks.bind(this); return this } }, { key: "resetMediaInfo", value: function () { this._mediaInfo = new r.default } }, { key: "_isInitialMetadataDispatched", value: function () { if (this._hasAudio && this._hasVideo) return this._audioInitialMetadataDispatched && this._videoInitialMetadataDispatched; if (this._hasAudio && !this._hasVideo) return this._audioInitialMetadataDispatched; if (!this._hasAudio && this._hasVideo) return this._videoInitialMetadataDispatched } }, { key: "parseChunks", value: function (c, d) { if (!(this._onError && this._onMediaInfo && this._onTrackMetadata && this._onDataAvailable)) throw new t.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified"); var k = 0, b = this._littleEndian; if (0 === d) if (13 < c.byteLength) d = g.probe(c), d = k = d.dataOffset; else return 0; this._firstParse && (this._firstParse = !1, d !== this._dataOffset && a.default.w(this.TAG, "First time parsing but chunk byteStart invalid!"), 0 !== (new DataView(c, k)).getUint32(0, !b) && a.default.w(this.TAG, "PrevTagSize0 !== 0 !!!"), k += 4); for (; k < c.byteLength;) { this._dispatch = !0; var e = new DataView(c, k); if (k + 11 + 4 > c.byteLength) break; var f = e.getUint8(0), n = e.getUint32(0, !b) & 16777215; if (k + 11 + n + 4 > c.byteLength) break; if (8 !== f && 9 !== f && 18 !== f) a.default.w(this.TAG, "Unsupported tag type " + f + ", skipped"); else { var h = e.getUint8(4), r = e.getUint8(5), p = e.getUint8(6), l = e.getUint8(7), h = p | r << 8 | h << 16 | l << 24; 0 !== (e.getUint32(7, !b) & 16777215) && a.default.w(this.TAG, "Meet tag which has StreamID != 0!"); r = k + 11; switch (f) { case 8: this._parseAudioData(c, r, n, h); break; case 9: this._parseVideoData(c, r, n, h, d + k); break; case 18: this._parseScriptData(c, r, n) } e = e.getUint32(11 + n, !b); e !== 11 + n && a.default.w(this.TAG, "Invalid PrevTagSize " + e) } k += 11 + n + 4 } this._isInitialMetadataDispatched() && this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack); return k } }, { key: "_parseScriptData", value: function (c, d, b) { c = e.default.parseScriptData(c, d, b); c.hasOwnProperty("onMetaData") && (this._metadata && a.default.w(this.TAG, "Found another onMetaData tag!"), this._metadata = c, c = this._metadata.onMetaData, "boolean" === typeof c.hasAudio && (this._hasAudio = c.hasAudio, this._mediaInfo.hasAudio = this._hasAudio), "boolean" === typeof c.hasVideo && (this._hasVideo = c.hasVideo, this._mediaInfo.hasVideo = this._hasVideo), "number" === typeof c.audiodatarate && (this._mediaInfo.audioDataRate = c.audiodatarate), "number" === typeof c.videodatarate && (this._mediaInfo.videoDataRate = c.videodatarate), "number" === typeof c.width && (this._mediaInfo.width = c.width), "number" === typeof c.height && (this._mediaInfo.height = c.height), "number" === typeof c.duration ? this._durationOverrided || (this._duration = d = Math.floor(c.duration * this._timescale), this._mediaInfo.duration = d) : this._mediaInfo.duration = 0, "number" === typeof c.framerate && (d = Math.floor(1E3 * c.framerate), 0 < d && (b = d / 1E3, this._referenceFrameRate.fixed = !0, this._referenceFrameRate.fps = b, this._referenceFrameRate.fps_num = d, this._referenceFrameRate.fps_den = 1E3, this._mediaInfo.fps = b)), "object" === f(c.keyframes) ? (this._mediaInfo.hasKeyframesIndex = !0, this._mediaInfo.keyframesIndex = this._parseKeyframesIndex(c.keyframes), c.keyframes = null) : this._mediaInfo.hasKeyframesIndex = !1, this._dispatch = !1, this._mediaInfo.metadata = c, a.default.v(this.TAG, "Parsed onMetaData"), this._mediaInfo.isComplete() && this._onMediaInfo(this._mediaInfo)) } }, { key: "_parseKeyframesIndex", value: function (a) { for (var c = [], d = [], b = 1; b < a.times.length; b++) c.push(this._timestampBase + Math.floor(1E3 * a.times[b])), d.push(a.filepositions[b]); return { times: c, filepositions: d } } }, { key: "_parseAudioData", value: function (c, d, b, e) { if (1 >= b) a.default.w(this.TAG, "Flv: Invalid audio packet, missing SoundData payload!"); else { var k = this._audioMetadata, f = this._audioTrack; if (!k || !k.codec) { k = this._audioMetadata = {}; k.type = "audio"; k.id = f.id; k.timescale = this._timescale; k.duration = this._duration; var q = (new DataView(c, d, b)).getUint8(0), g = q >>> 4; if (10 !== g) { this._onError(p.default.CODEC_UNSUPPORTED, "Flv: Unsupported audio codec idx: " + g); return } var g = (q & 12) >>> 2, n = [5500, 11025, 22050, 44100, 48E3]; if (g < n.length) g = n[g]; else { this._onError(p.default.FORMAT_ERROR, "Flv: Invalid audio sample rate idx: " + g); return } k.audioSampleRate = g; k.channelCount = 0 === (q & 1) ? 1 : 2; k.refSampleDuration = Math.floor(1024 / k.audioSampleRate * k.timescale); k.codec = "mp4a.40.5" } c = this._parseAACAudioData(c, d + 1, b - 1); void 0 != c && (0 === c.packetType ? (k.config && a.default.w(this.TAG, "Found another AudioSpecificConfig!"), f = c.data, k.audioSampleRate = f.samplingRate, k.channelCount = f.channelCount, k.codec = f.codec, k.config = f.config, k.refSampleDuration = Math.floor(1024 / k.audioSampleRate * k.timescale), a.default.v(this.TAG, "Parsed AudioSpecificConfig"), this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._audioInitialMetadataDispatched = !0, this._dispatch = !1, this._onTrackMetadata("audio", k), e = this._mediaInfo, e.audioCodec = "mp4a.40." + f.originalAudioObjectType, e.audioSampleRate = k.audioSampleRate, e.audioChannelCount = k.channelCount, e.hasVideo ? null != e.videoCodec && (e.mimeType = 'video/x-flv; codecs="' + e.videoCodec + "," + e.audioCodec + '"') : e.mimeType = 'video/x-flv; codecs="' + e.audioCodec + '"', e.isComplete() && this._onMediaInfo(e)) : 1 === c.packetType ? (k = this._timestampBase + e, f.samples.push({ unit: c.data, dts: k, pts: k }), f.length += c.data.length) : a.default.e(this.TAG, "Flv: Unsupported AAC data type " + c.packetType)) } } }, { key: "_parseAACAudioData", value: function (c, d, b) { if (1 >= b) a.default.w(this.TAG, "Flv: Invalid AAC packet, missing AACPacketType or/and Data!"); else { var k = {}, e = new Uint8Array(c, d, b); k.packetType = e[0]; k.data = 0 === e[0] ? this._parseAACAudioSpecificConfig(c, d + 1, b - 1) : e.subarray(1); return k } } }, { key: "_parseAACAudioSpecificConfig", value: function (a, d, b) { var c = new Uint8Array(a, d, b), k; b = [96E3, 88200, 64E3, 48E3, 44100, 32E3, 24E3, 22050, 16E3, 12E3, 11025, 8E3, 7350]; var e, f; a = c[0] >>> 3; d = (c[0] & 7) << 1 | c[1] >>> 7; if (0 > d || d >= b.length) this._onError(p.default.FORMAT_ERROR, "Flv: AAC invalid sampling frequency index!"); else if (b = b[d], c = (c[1] & 120) >>> 3, 0 > c || 8 <= c) this._onError(p.default.FORMAT_ERROR, "Flv: AAC invalid channel configuration"); else return k = self.navigator.userAgent.toLowerCase(), -1 !== k.indexOf("firefox") ? 6 <= d ? (e = 5, k = Array(4), f = d - 3) : (e = 2, k = Array(2), f = d) : -1 !== k.indexOf("android") ? (e = 2, k = Array(2), f = d) : (e = 5, f = d, k = Array(4), 6 <= d ? f = d - 3 : 1 === c && (e = 2, k = Array(2), f = d)), k[0] = e << 3, k[0] |= (d & 15) >>> 1, k[1] = (d & 15) << 7, k[1] |= (c & 15) << 3, 5 === e && (k[1] |= (f & 15) >>> 1, k[2] = (f & 1) << 7, k[2] |= 8, k[3] = 0), { config: k, samplingRate: b, channelCount: c, codec: "mp4a.40." + e, originalAudioObjectType: a } } }, { key: "_parseVideoData", value: function (c, d, b, e, f) { if (1 >= b) a.default.w(this.TAG, "Flv: Invalid video packet, missing VideoData payload!"); else { var k = (new Uint8Array(c, d, b))[0], g = (k & 240) >>> 4, k = k & 15; 7 !== k ? this._onError(p.default.CODEC_UNSUPPORTED, "Flv: Unsupported codec in video frame: " + k) : this._parseAVCVideoPacket(c, d + 1, b - 1, e, f, g) } } }, { key: "_parseAVCVideoPacket", value: function (c, d, b, e, f, g) { if (4 > b) a.default.w(this.TAG, "Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime"); else { var k = this._littleEndian, q = new DataView(c, d, b), n = q.getUint8(0), k = q.getUint32(0, !k) & 16777215; 0 === n ? this._parseAVCDecoderConfigurationRecord(c, d + 4, b - 4) : 1 === n ? this._parseAVCVideoData(c, d + 4, b - 4, e, f, g, k) : 2 !== n && this._onError(p.default.FORMAT_ERROR, "Flv: Invalid video packet type " + n) } } }, { key: "_parseAVCDecoderConfigurationRecord", value: function (c, k, b) { if (7 > b) a.default.w(this.TAG, "Flv: Invalid AVCDecoderConfigurationRecord, lack of data!"); else { var e = this._videoMetadata, f = this._videoTrack, g = this._littleEndian, q = new DataView(c, k, b); e ? "undefined" !== typeof e.avcc && a.default.w(this.TAG, "Found another AVCDecoderConfigurationRecord!") : (e = this._videoMetadata = {}, e.type = "video", e.id = f.id, e.timescale = this._timescale, e.duration = this._duration); var f = q.getUint8(0), n = q.getUint8(1); q.getUint8(2); q.getUint8(3); if (1 !== f || 0 === n) this._onError(p.default.FORMAT_ERROR, "Flv: Invalid AVCDecoderConfigurationRecord"); else if (this._naluLengthSize = (q.getUint8(4) & 3) + 1, 3 !== this._naluLengthSize && 4 !== this._naluLengthSize) this._onError(p.default.FORMAT_ERROR, "Flv: Strange NaluLengthSizeMinusOne: " + (this._naluLengthSize - 1)); else if (n = q.getUint8(5) & 31, 0 === n || 1 < n) this._onError(p.default.FORMAT_ERROR, "Flv: Invalid H264 SPS count: " + n); else { for (var f = 6, h = 0; h < n; h++) { var r = q.getUint16(f, !g), f = f + 2; if (0 !== r) { var t = new Uint8Array(c, k + f, r), f = f + r, r = d.default.parseSPS(t); e.codecWidth = r.codec_size.width; e.codecHeight = r.codec_size.height; e.presentWidth = r.present_size.width; e.presentHeight = r.present_size.height; e.profile = r.profile_string; e.level = r.level_string; e.bitDepth = r.bit_depth; e.chromaFormat = r.chroma_format; e.sarRatio = r.sar_ratio; e.frameRate = r.frame_rate; if (!1 === r.frame_rate.fixed || 0 === r.frame_rate.fps_num || 0 === r.frame_rate.fps_den) e.frameRate = this._referenceFrameRate; e.refSampleDuration = Math.floor(e.frameRate.fps_den / e.frameRate.fps_num * e.timescale); for (var l = t.subarray(1, 4), t = "avc1.", m = 0; 3 > m; m++) { var z = l[m].toString(16); 2 > z.length && (z = "0" + z); t += z } e.codec = t; l = this._mediaInfo; l.width = e.codecWidth; l.height = e.codecHeight; l.fps = e.frameRate.fps; l.profile = e.profile; l.level = e.level; l.chromaFormat = r.chroma_format_string; l.sarNum = e.sarRatio.width; l.sarDen = e.sarRatio.height; l.videoCodec = t; l.hasAudio ? null != l.audioCodec && (l.mimeType = 'video/x-flv; codecs="' + l.videoCodec + "," + l.audioCodec + '"') : l.mimeType = 'video/x-flv; codecs="' + l.videoCodec + '"'; l.isComplete() && this._onMediaInfo(l) } } n = q.getUint8(f); if (0 === n || 1 < n) this._onError(p.default.FORMAT_ERROR, "Flv: Invalid H264 PPS count: " + n); else { f++; for (h = 0; h < n; h++) r = q.getUint16(f, !g), f += 2, 0 !== r && (f += r); e.avcc = new Uint8Array(b); e.avcc.set(new Uint8Array(c, k, b), 0); a.default.v(this.TAG, "Parsed AVCDecoderConfigurationRecord"); this._isInitialMetadataDispatched() ? this._dispatch && (this._audioTrack.length || this._videoTrack.length) && this._onDataAvailable(this._audioTrack, this._videoTrack) : this._videoInitialMetadataDispatched = !0; this._dispatch = !1; this._onTrackMetadata("video", e) } } } } }, { key: "_parseAVCVideoData", value: function (c, d, e, b, f, g, n) { var k = this._littleEndian, q = new DataView(c, d, e), h = [], r = 0, u = 0, t = this._naluLengthSize; b = this._timestampBase + b; for (g = 1 === g; u < e;) { if (u + 4 >= e) { a.default.w(this.TAG, "Malformed Nalu near timestamp " + b + ", offset = " + u + ", dataSize = " + e); break } var p = q.getUint32(u, !k); 3 === t && (p >>>= 8); if (p > e - t) { a.default.w(this.TAG, "Malformed Nalus near timestamp " + b + ", NaluSize > DataSize!"); return } var w = q.getUint8(u + t) & 31; 5 === w && (g = !0); var l = new Uint8Array(c, d + u, t + p); h.push({ type: w, data: l }); r += l.byteLength; u += t + p } h.length && (c = this._videoTrack, n = { units: h, length: r, isKeyframe: g, dts: b, cts: n, pts: b + n }, g && (n.fileposition = f), c.samples.push(n), c.length += r) } }, { key: "onTrackMetadata", get: function () { return this._onTrackMetadata }, set: function (a) { this._onTrackMetadata = a } }, { key: "onMediaInfo", get: function () { return this._onMediaInfo }, set: function (a) { this._onMediaInfo = a } }, { key: "onError", get: function () { return this._onError }, set: function (a) { this._onError = a } }, { key: "onDataAvailable", get: function () { return this._onDataAvailable }, set: function (a) { this._onDataAvailable = a } }, { key: "timestampBase", get: function () { return this._timestampBase }, set: function (a) { this._timestampBase = a } }, { key: "overridedDuration", get: function () { return this._duration }, set: function (a) { this._durationOverrided = !0; this._duration = a; this._mediaInfo.duration = a } }], [{ key: "probe", value: function (a) { var c = new Uint8Array(a); a = { match: !1 }; if (70 !== c[0] || 76 !== c[1] || 86 !== c[2] || 1 !== c[3]) return a; var d = 0 !== (c[4] & 4) >>> 2, e = 0 !== (c[4] & 1); if (!d && !e) return a; c = c[5] << 24 | c[6] << 16 | c[7] << 8 | c[8]; return 9 > c ? a : { match: !0, consumed: c, dataOffset: c, hasAudioTrack: d, hasVideoTrack: e } } }]); return g }(); m.default = g }, { "../core/media-info.js": 7, "../utils/exception.js": 40, "../utils/logger.js": 41, "./amf-parser.js": 15, "./demux-errors.js": 16, "./sps-parser.js": 19 }], 19: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function b(a, e) { for (var d = 0; d < e.length; d++) { var b = e[d]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (a, e, d) { e && b(a.prototype, e); d && b(a, d); return a } }(), f = (g = g("./exp-golomb.js")) && g.__esModule ? g : { default: g }; g = function () { function b() { if (!(this instanceof b)) throw new TypeError("Cannot call a class as a function"); } l(b, null, [{ key: "_ebsp2rbsp", value: function (a) { for (var e = a.byteLength, d = new Uint8Array(e), b = 0, f = 0; f < e; f++) 2 <= f && 3 === a[f] && 0 === a[f - 1] && 0 === a[f - 2] || (d[b] = a[f], b++); return new Uint8Array(d.buffer, 0, b) } }, { key: "parseSPS", value: function (a) { a = b._ebsp2rbsp(a); a = new f.default(a); a.readByte(); var e = a.readByte(); a.readByte(); var d = a.readByte(); a.readUEG(); var g = b.getProfileString(e), d = b.getLevelString(d), h = 1, t = 420, n = [0, 420, 422, 444], c = 8; if (100 === e || 110 === e || 122 === e || 244 === e || 44 === e || 83 === e || 86 === e || 118 === e || 128 === e || 138 === e || 144 === e) if (h = a.readUEG(), 3 === h && a.readBits(1), 3 >= h && (t = n[h]), c = a.readUEG() + 8, a.readUEG(), a.readBits(1), a.readBool()) for (e = 3 !== h ? 8 : 12, n = 0; n < e; n++) a.readBool() && (6 > n ? b._skipScalingList(a, 16) : b._skipScalingList(a, 64)); a.readUEG(); e = a.readUEG(); if (0 === e) a.readUEG(); else if (1 === e) for (a.readBits(1), a.readSEG(), a.readSEG(), e = a.readUEG(), n = 0; n < e; n++) a.readSEG(); a.readUEG(); a.readBits(1); var k = a.readUEG(), q = a.readUEG(), w = a.readBits(1); 0 === w && a.readBits(1); a.readBits(1); var l = 0, u = 0, m = 0, T = 0; a.readBool() && (l = a.readUEG(), u = a.readUEG(), m = a.readUEG(), T = a.readUEG()); var n = e = 1, K = 0, D = !0, A = 0, y = 0; if (a.readBool()) { if (a.readBool()) { var x = a.readByte(), z = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2], G = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1]; 0 < x && 16 > x ? (e = z[x - 1], n = G[x - 1]) : 255 === x && (e = a.readByte() << 8 | a.readByte(), n = a.readByte() << 8 | a.readByte()) } a.readBool() && a.readBool(); a.readBool() && (a.readBits(4), a.readBool() && a.readBits(24)); a.readBool() && (a.readUEG(), a.readUEG()); a.readBool() && (K = a.readBits(32), A = a.readBits(32), D = a.readBool(), y = 2 * K, K = A / y) } x = 1; if (1 !== e || 1 !== n) x = e / n; 0 === h ? (z = 1, h = 2 - w) : (z = 3 === h ? 1 : 2, h = (1 === h ? 2 : 1) * (2 - w)); k = 16 * (k + 1) - (l + u) * z; h = 16 * (2 - w) * (q + 1) - (m + T) * h; q = Math.ceil(k * x); a.destroy(); return { profile_string: g, level_string: d, bit_depth: c, chroma_format: t, chroma_format_string: b.getChromaFormatString(t), frame_rate: { fixed: D, fps: K, fps_den: y, fps_num: A }, sar_ratio: { width: e, height: n }, codec_size: { width: k, height: h }, present_size: { width: q, height: h } } } }, { key: "_skipScalingList", value: function (a, e) { for (var d = 8, b = 8, f = 0; f < e; f++) 0 !== b && (b = a.readSEG(), b = (d + b + 256) % 256), d = 0 === b ? d : b } }, { key: "getProfileString", value: function (a) { switch (a) { case 66: return "Baseline"; case 77: return "Main"; case 88: return "Extended"; case 100: return "High"; case 110: return "High10"; case 122: return "High422"; case 244: return "High444"; default: return "Unknown" } } }, { key: "getLevelString", value: function (a) { return (a / 10).toFixed(1) } }, { key: "getChromaFormatString", value: function (a) { switch (a) { case 420: return "4:2:0"; case 422: return "4:2:2"; case 444: return "4:4:4"; default: return "Unknown" } } }]); return b }(); m.default = g }, { "./exp-golomb.js": 17 }], 20: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }; h = g("./utils/polyfill.js"); h = l(h); var b = g("./core/features.js"), a = l(b), b = g("./player/flv-player.js"), e = l(b), b = g("./player/native-player.js"), d = l(b), b = g("./player/player-events.js"), b = l(b), p = g("./player/player-errors.js"), r = g("./utils/logging-control.js"), r = l(r), t = g("./utils/exception.js"); h.default.install(); g = { createPlayer: function (a, c) { if (null == a || "object" !== ("undefined" === typeof a ? "undefined" : f(a))) throw new t.InvalidArgumentException("MediaDataSource must be an javascript object!"); if (!a.hasOwnProperty("type")) throw new t.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!"); switch (a.type) { case "flv": return new e.default(a, c); default: return new d.default(a, c) } }, isSupported: function () { return a.default.supportMSEH264Playback() }, getFeatureList: function () { return a.default.getFeatureList() } }; g.Events = b.default; g.ErrorTypes = p.ErrorTypes; g.ErrorDetails = p.ErrorDetails; g.FlvPlayer = e.default; g.NativePlayer = d.default; g.LoggingControl = r.default; Object.defineProperty(g, "version", { enumerable: !0, get: function () { return "1.1.0" } }); m.default = g }, { "./core/features.js": 6, "./player/flv-player.js": 32, "./player/native-player.js": 33, "./player/player-errors.js": 34, "./player/player-events.js": 35, "./utils/exception.js": 40, "./utils/logging-control.js": 42, "./utils/polyfill.js": 43 }], 21: [function (g, h, m) { h.exports = g("./flv.js").default }, { "./flv.js": 20 }], 22: [function (g, h, m) { function l(a, d) { if ("function" !== typeof d && null !== d) throw new TypeError("Super expression must either be null or a function, not " + typeof d); a.prototype = Object.create(d && d.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); d && (Object.setPrototypeOf ? Object.setPrototypeOf(a, d) : a.__proto__ = d) } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function t(a, c, d) { null === a && (a = Function.prototype); var b = Object.getOwnPropertyDescriptor(a, c); if (void 0 === b) { if (a = Object.getPrototypeOf(a), null !== a) return t(a, c, d) } else { if ("value" in b) return b.value; c = b.get; return void 0 === c ? void 0 : c.call(d) } }, a = function () { function a(a, c) { for (var d = 0; d < c.length; d++) { var b = c[d]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (d, c, b) { c && a(d.prototype, c); b && a(d, b); return d } }(); g("../utils/logger.js"); var e = (h = g("../utils/browser.js")) && h.__esModule ? h : { default: h }, d = g("./loader.js"), p = g("../utils/exception.js"); g = function (g) { function h(a) { if (!(this instanceof h)) throw new TypeError("Cannot call a class as a function"); var c; c = (h.__proto__ || Object.getPrototypeOf(h)).call(this, "fetch-stream-loader"); if (!this) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); c = !c || "object" !== typeof c && "function" !== typeof c ? this : c; c.TAG = "FetchStreamLoader"; c._seekHandler = a; c._needStash = !0; c._requestAbort = !1; c._contentLength = null; c._receivedLength = 0; return c } l(h, g); a(h, null, [{ key: "isSupported", value: function () { try { return self.fetch && self.ReadableStream && !e.default.msedge } catch (c) { return !1 } } }]); a(h, [{ key: "destroy", value: function () { this.isWorking() && this.abort(); b(h.prototype.__proto__ || Object.getPrototypeOf(h.prototype), "destroy", this).call(this) } }, { key: "open", value: function (a, b) { var c = this; this._dataSource = a; this._range = b; var e = this._seekHandler.getConfig(a.url, b); b = new self.Headers; if ("object" === f(e.headers)) { var k = e.headers, g; for (g in k) k.hasOwnProperty(g) && b.append(g, k[g]) } g = e.url; b = { method: "GET", headers: b, mode: "cors", cache: "default" }; !1 === a.cors && (b.mode = "same-origin"); a.withCredentials && (b.credentials = "include"); this._status = d.LoaderStatus.kConnecting; self.fetch(g, b).then(function (a) { if (c._requestAbort) c._requestAbort = !1, c._status = d.LoaderStatus.kIdle; else { if (a.ok && 200 <= a.status && 299 >= a.status) { var b = a.headers.get("Content-Length"); null != b && (c._contentLength = parseInt(b), 0 !== c._contentLength && c._onContentLengthKnown && c._onContentLengthKnown(c._contentLength)); return c._pump.call(c, a.body.getReader()) } c._status = d.LoaderStatus.kError; if (c._onError) c._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: a.status, msg: a.statusText }); else throw new p.RuntimeException("FetchStreamLoader: Http code invalid, " + a.status + " " + a.statusText); } }).catch(function (a) { c._status = d.LoaderStatus.kError; if (c._onError) c._onError(d.LoaderErrors.EXCEPTION, { code: -1, msg: a.message }); else throw a; }) } }, { key: "abort", value: function () { this._requestAbort = !0 } }, { key: "_pump", value: function (a) { var c = this; return a.read().then(function (b) { if (b.done) c._status = d.LoaderStatus.kComplete, c._onComplete && c._onComplete(c._range.from, c._range.from + c._receivedLength - 1); else { if (!0 === c._requestAbort) return c._requestAbort = !1, c._status = d.LoaderStatus.kComplete, a.cancel(); c._status = d.LoaderStatus.kBuffering; b = b.value.buffer; var e = c._range.from + c._receivedLength; c._receivedLength += b.byteLength; c._onDataArrival && c._onDataArrival(b, e, c._receivedLength); return c._pump(a) } }).catch(function (a) { c._status = d.LoaderStatus.kError; var b; 19 === a.code && (null === c._contentLength || null !== c._contentLength && c._receivedLength < c._contentLength) ? (b = d.LoaderErrors.EARLY_EOF, a = { code: a.code, msg: "Fetch stream meet Early-EOF" }) : (b = d.LoaderErrors.EXCEPTION, a = { code: a.code, msg: a.message }); if (c._onError) c._onError(b, a); else throw new p.RuntimeException(a.msg); }) } }]); return h }(d.BaseLoader); m.default = g }, { "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 23: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function a(a, c) { for (var d = 0; d < c.length; d++) { var b = c[d]; b.enumerable = b.enumerable || !1; b.configurable = !0; "value" in b && (b.writable = !0); Object.defineProperty(a, b.key, b) } } return function (c, d, b) { d && a(c.prototype, d); b && a(c, b); return c } }(); h = g("../utils/logger.js"); var b = l(h); h = g("./speed-sampler.js"); var a = l(h), e = g("./loader.js"); h = g("./fetch-stream-loader.js"); var d = l(h); h = g("./xhr-moz-chunked-loader.js"); var p = l(h); h = g("./xhr-msstream-loader.js"); l(h); h = g("./xhr-range-loader.js"); var r = l(h); h = g("./websocket-loader.js"); var t = l(h); h = g("./range-seek-handler.js"); var n = l(h); h = g("./param-seek-handler.js"); var c = l(h), k = g("../utils/exception.js"); g = function () { function g(c, d, b) { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this.TAG = "IOController"; this._config = d; this._extraData = b; this._stashInitialSize = 393216; !0 === d.isLive && (this._stashInitialSize = 524288); void 0 != d.stashInitialSize && 0 < d.stashInitialSize && (this._stashInitialSize = d.stashInitialSize); this._stashUsed = 0; this._stashSize = this._stashInitialSize; this._bufferSize = 3145728; this._stashBuffer = new ArrayBuffer(this._bufferSize); this._stashByteStart = 0; this._enableStash = !0; !1 === d.enableStashBuffer && (this._enableStash = !1); this._seekHandler = this._loaderClass = this._loader = null; this._dataSource = c; this._isWebSocketURL = /wss?:\/\/(.+?)\//.test(c.url); this._totalLength = this._refTotalLength = c.filesize ? c.filesize : null; this._fullRequestFlag = !1; this._currentRange = null; this._speedNormalized = 0; this._speedSampler = new a.default; this._speedNormalizeList = [64, 128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096]; this._paused = this._isEarlyEofReconnecting = !1; this._resumeFrom = 0; this._onRecoveredEarlyEof = this._onComplete = this._onError = this._onSeeked = this._onDataArrival = null; this._selectSeekHandler(); this._selectLoader(); this._createLoader() } f(g, [{ key: "destroy", value: function () { this._loader.isWorking() && this._loader.abort(); this._loader.destroy(); this._stashBuffer = this._dataSource = this._loaderClass = this._loader = null; this._stashUsed = this._stashSize = this._bufferSize = this._stashByteStart = 0; this._speedSampler = this._currentRange = null; this._isEarlyEofReconnecting = !1; this._extraData = this._onRecoveredEarlyEof = this._onComplete = this._onError = this._onSeeked = this._onDataArrival = null } }, { key: "isWorking", value: function () { return this._loader && this._loader.isWorking() && !this._paused } }, { key: "isPaused", value: function () { return this._paused } }, { key: "_selectSeekHandler", value: function () { var a = this._config; if ("range" === a.seekType) this._seekHandler = new n.default(this._config.rangeLoadZeroStart); else if ("param" === a.seekType) this._seekHandler = new c.default(a.seekParamStart || "bstart", a.seekParamEnd || "bend"); else if ("custom" === a.seekType) { if ("function" !== typeof a.customSeekHandler) throw new k.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!"); this._seekHandler = new a.customSeekHandler } else throw new k.InvalidArgumentException("Invalid seekType in config: " + a.seekType); } }, { key: "_selectLoader", value: function () { if (this._isWebSocketURL) this._loaderClass = t.default; else if (d.default.isSupported()) this._loaderClass = d.default; else if (p.default.isSupported()) this._loaderClass = p.default; else if (r.default.isSupported()) this._loaderClass = r.default; else throw new k.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!"); } }, { key: "_createLoader", value: function () { this._loader = new this._loaderClass(this._seekHandler); !1 === this._loader.needStashBuffer && (this._enableStash = !1); this._loader.onContentLengthKnown = this._onContentLengthKnown.bind(this); this._loader.onDataArrival = this._onLoaderChunkArrival.bind(this); this._loader.onComplete = this._onLoaderComplete.bind(this); this._loader.onError = this._onLoaderError.bind(this) } }, { key: "open", value: function (a) { this._currentRange = { from: 0, to: -1 }; a && (this._currentRange.from = a); this._speedSampler.reset(); a || (this._fullRequestFlag = !0); this._loader.open(this._dataSource, Object.assign({}, this._currentRange)) } }, { key: "abort", value: function () { this._loader.abort(); this._paused && (this._paused = !1, this._resumeFrom = 0) } }, { key: "pause", value: function () { this.isWorking() && (this._loader.abort(), 0 !== this._stashUsed ? (this._resumeFrom = this._stashByteStart, this._currentRange.to = this._stashByteStart - 1) : this._resumeFrom = this._currentRange.to + 1, this._stashByteStart = this._stashUsed = 0, this._paused = !0) } }, { key: "resume", value: function () { if (this._paused) { this._paused = !1; var a = this._resumeFrom; this._resumeFrom = 0; this._internalSeek(a, !0) } } }, { key: "seek", value: function (a) { this._paused = !1; this._stashByteStart = this._stashUsed = 0; this._internalSeek(a, !0) } }, { key: "_internalSeek", value: function (a, c) { this._loader.isWorking() && this._loader.abort(); this._flushStashBuffer(c); this._loader.destroy(); this._loader = null; a = { from: a, to: -1 }; this._currentRange = { from: a.from, to: -1 }; this._speedSampler.reset(); this._stashSize = this._stashInitialSize; this._createLoader(); this._loader.open(this._dataSource, a); this._onSeeked && this._onSeeked() } }, { key: "updateUrl", value: function (a) { if (!a || "string" !== typeof a || 0 === a.length) throw new k.InvalidArgumentException("Url must be a non-empty string!"); this._dataSource.url = a } }, { key: "_expandBuffer", value: function (a) { for (var c = this._stashSize; c + 1048576 < a;) c *= 2; c += 1048576; if (c !== this._bufferSize) { a = new ArrayBuffer(c); if (0 < this._stashUsed) { var d = new Uint8Array(this._stashBuffer, 0, this._stashUsed); (new Uint8Array(a, 0, c)).set(d, 0) } this._stashBuffer = a; this._bufferSize = c } } }, { key: "_normalizeSpeed", value: function (a) { var c = this._speedNormalizeList, d = c.length - 1, b, e = 0, k = d; if (a < c[0]) return c[0]; for (; e <= k;) { b = e + Math.floor((k - e) / 2); if (b === d || a >= c[b] && a < c[b + 1]) return c[b]; c[b] < a ? e = b + 1 : k = b - 1 } } }, { key: "_adjustStashSize", value: function (a) { a = this._config.isLive ? a : 512 > a ? a : 512 <= a && 1024 >= a ? Math.floor(1.5 * a) : 2 * a; 8192 < a && (a = 8192); var c = 1024 * a + 1048576; this._bufferSize < c && this._expandBuffer(c); this._stashSize = 1024 * a } }, { key: "_dispatchChunks", value: function (a, c) { this._currentRange.to = c + a.byteLength - 1; return this._onDataArrival(a, c) } }, { key: "_onContentLengthKnown", value: function (a) { a && this._fullRequestFlag && (this._totalLength = a, this._fullRequestFlag = !1) } }, { key: "_onLoaderChunkArrival", value: function (a, c, d) { if (!this._onDataArrival) throw new k.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!"); if (!this._paused) if (this._isEarlyEofReconnecting && (this._isEarlyEofReconnecting = !1, this._onRecoveredEarlyEof && this._onRecoveredEarlyEof()), this._speedSampler.addBytes(a.byteLength), d = this._speedSampler.lastSecondKBps, 0 !== d && (d = this._normalizeSpeed(d), this._speedNormalized !== d && (this._speedNormalized = d, this._adjustStashSize(d))), this._enableStash) if (0 === this._stashUsed && 0 === this._stashByteStart && (this._stashByteStart = c), this._stashUsed + a.byteLength <= this._stashSize) (new Uint8Array(this._stashBuffer, 0, this._stashSize)).set(new Uint8Array(a), this._stashUsed), this._stashUsed += a.byteLength; else if (d = new Uint8Array(this._stashBuffer, 0, this._bufferSize), 0 < this._stashUsed) { var b = this._stashBuffer.slice(0, this._stashUsed); c = this._dispatchChunks(b, this._stashByteStart); c < b.byteLength ? 0 < c && (b = new Uint8Array(b, c), d.set(b, 0), this._stashUsed = b.byteLength, this._stashByteStart += c) : (this._stashUsed = 0, this._stashByteStart += c); this._stashUsed + a.byteLength > this._bufferSize && (this._expandBuffer(this._stashUsed + a.byteLength), d = new Uint8Array(this._stashBuffer, 0, this._bufferSize)); d.set(new Uint8Array(a), this._stashUsed); this._stashUsed += a.byteLength } else { if (b = this._dispatchChunks(a, c), b < a.byteLength) { var e = a.byteLength - b; e > this._bufferSize && (this._expandBuffer(e), d = new Uint8Array(this._stashBuffer, 0, this._bufferSize)); d.set(new Uint8Array(a, b), 0); this._stashUsed += e; this._stashByteStart = c + b } } else 0 === this._stashUsed ? (d = this._dispatchChunks(a, c), d < a.byteLength && (b = a.byteLength - d, b > this._bufferSize && this._expandBuffer(b), (new Uint8Array(this._stashBuffer, 0, this._bufferSize)).set(new Uint8Array(a, d), 0), this._stashUsed += b, this._stashByteStart = c + d)) : (this._stashUsed + a.byteLength > this._bufferSize && this._expandBuffer(this._stashUsed + a.byteLength), c = new Uint8Array(this._stashBuffer, 0, this._bufferSize), c.set(new Uint8Array(a), this._stashUsed), this._stashUsed += a.byteLength, a = this._dispatchChunks(this._stashBuffer.slice(0, this._stashUsed), this._stashByteStart), a < this._stashUsed && 0 < a && (d = new Uint8Array(this._stashBuffer, a), c.set(d, 0)), this._stashUsed -= a, this._stashByteStart += a) } }, { key: "_flushStashBuffer", value: function (a) { if (0 < this._stashUsed) { var c = this._stashBuffer.slice(0, this._stashUsed), d = this._dispatchChunks(c, this._stashByteStart), e = c.byteLength - d; if (d < c.byteLength) if (a) b.default.w(this.TAG, e + " bytes unconsumed data remain when flush buffer, dropped"); else return 0 < d && (a = new Uint8Array(this._stashBuffer, 0, this._bufferSize), c = new Uint8Array(c, d), a.set(c, 0), this._stashUsed = c.byteLength, this._stashByteStart += d), 0; this._stashByteStart = this._stashUsed = 0; return e } return 0 } }, { key: "_onLoaderComplete", value: function (a, c) { this._flushStashBuffer(!0); this._onComplete && this._onComplete(this._extraData) } }, { key: "_onLoaderError", value: function (a, c) { b.default.e(this.TAG, "Loader error, code = " + c.code + ", msg = " + c.msg); this._flushStashBuffer(!1); this._isEarlyEofReconnecting && (this._isEarlyEofReconnecting = !1, a = e.LoaderErrors.UNRECOVERABLE_EARLY_EOF); switch (a) { case e.LoaderErrors.EARLY_EOF: if (!this._config.isLive && this._totalLength) { a = this._currentRange.to + 1; a < this._totalLength && (b.default.w(this.TAG, "Connection lost, trying reconnect..."), this._isEarlyEofReconnecting = !0, this._internalSeek(a, !1)); return } a = e.LoaderErrors.UNRECOVERABLE_EARLY_EOF } if (this._onError) this._onError(a, c); else throw new k.RuntimeException("IOException: " + c.msg); } }, { key: "status", get: function () { return this._loader.status } }, { key: "extraData", get: function () { return this._extraData }, set: function (a) { this._extraData = a } }, { key: "onDataArrival", get: function () { return this._onDataArrival }, set: function (a) { this._onDataArrival = a } }, { key: "onSeeked", get: function () { return this._onSeeked }, set: function (a) { this._onSeeked = a } }, { key: "onError", get: function () { return this._onError }, set: function (a) { this._onError = a } }, { key: "onComplete", get: function () { return this._onComplete }, set: function (a) { this._onComplete = a } }, { key: "onRecoveredEarlyEof", get: function () { return this._onRecoveredEarlyEof }, set: function (a) { this._onRecoveredEarlyEof = a } }, { key: "currentUrl", get: function () { return this._dataSource.url } }, { key: "currentSpeed", get: function () { return this._loaderClass === r.default ? this._loader.currentSpeed : this._speedSampler.lastSecondKBps } }, { key: "loaderType", get: function () { return this._loader.type } }]); return g }(); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./fetch-stream-loader.js": 22, "./loader.js": 24, "./param-seek-handler.js": 25, "./range-seek-handler.js": 26, "./speed-sampler.js": 27, "./websocket-loader.js": 28, "./xhr-moz-chunked-loader.js": 29, "./xhr-msstream-loader.js": 30, "./xhr-range-loader.js": 31 }], 24: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.BaseLoader = m.LoaderErrors = m.LoaderStatus = void 0; var l = function () { function a(a, d) { for (var b = 0; b < d.length; b++) { var e = d[b]; e.enumerable = e.enumerable || !1; e.configurable = !0; "value" in e && (e.writable = !0); Object.defineProperty(a, e.key, e) } } return function (b, d, f) { d && a(b.prototype, d); f && a(b, f); return b } }(), f = g("../utils/exception.js"), b = m.LoaderStatus = { kIdle: 0, kConnecting: 1, kBuffering: 2, kError: 3, kComplete: 4 }; m.LoaderErrors = { OK: "OK", EXCEPTION: "Exception", HTTP_STATUS_CODE_INVALID: "HttpStatusCodeInvalid", CONNECTING_TIMEOUT: "ConnectingTimeout", EARLY_EOF: "EarlyEof", UNRECOVERABLE_EARLY_EOF: "UnrecoverableEarlyEof" }; m.BaseLoader = function () { function a(e) { if (!(this instanceof a)) throw new TypeError("Cannot call a class as a function"); this._type = e || "undefined"; this._status = b.kIdle; this._needStash = !1; this._onComplete = this._onError = this._onDataArrival = this._onContentLengthKnown = null } l(a, [{ key: "destroy", value: function () { this._status = b.kIdle; this._onComplete = this._onError = this._onDataArrival = this._onContentLengthKnown = null } }, { key: "isWorking", value: function () { return this._status === b.kConnecting || this._status === b.kBuffering } }, { key: "open", value: function (a, d) { throw new f.NotImplementedException("Unimplemented abstract function!"); } }, { key: "abort", value: function () { throw new f.NotImplementedException("Unimplemented abstract function!"); } }, { key: "type", get: function () { return this._type } }, { key: "status", get: function () { return this._status } }, { key: "needStashBuffer", get: function () { return this._needStash } }, { key: "onContentLengthKnown", get: function () { return this._onContentLengthKnown }, set: function (a) { this._onContentLengthKnown = a } }, { key: "onDataArrival", get: function () { return this._onDataArrival }, set: function (a) { this._onDataArrival = a } }, { key: "onError", get: function () { return this._onError }, set: function (a) { this._onError = a } }, { key: "onComplete", get: function () { return this._onComplete }, set: function (a) { this._onComplete = a } }]); return a }() }, { "../utils/exception.js": 40 }], 25: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f(b, a) { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); this._startName = b; this._endName = a } l(f, [{ key: "getConfig", value: function (b, a) { if (0 !== a.from || -1 !== a.to) { var e = !0; -1 === b.indexOf("?") && (b += "?", e = !1); e && (b += "&"); b += this._startName + "=" + a.from.toString(); -1 !== a.to && (b += "&" + this._endName + "=" + a.to.toString()) } return { url: b, headers: {} } } }]); return f }(); m.default = g }, {}], 26: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f(b) { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); this._zeroStart = b || !1 } l(f, [{ key: "getConfig", value: function (b, a) { var e = {}; 0 !== a.from || -1 !== a.to ? e.Range = -1 !== a.to ? "bytes=" + a.from.toString() + "-" + a.to.toString() : "bytes=" + a.from.toString() + "-" : this._zeroStart && (e.Range = "bytes=0-"); return { url: b, headers: e } } }]); return f }(); m.default = g }, {}], 27: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); this._lastSecondBytes = this._totalBytes = this._intervalBytes = this._lastCheckpoint = this._firstCheckpoint = 0; this._now = self.performance && self.performance.now ? self.performance.now.bind(self.performance) : Date.now } l(f, [{ key: "reset", value: function () { this._lastSecondBytes = this._totalBytes = this._intervalBytes = this._firstCheckpoint = this._lastCheckpoint = 0 } }, { key: "addBytes", value: function (b) { 0 === this._firstCheckpoint ? (this._lastCheckpoint = this._firstCheckpoint = this._now(), this._intervalBytes += b, this._totalBytes += b) : 1E3 > this._now() - this._lastCheckpoint ? (this._intervalBytes += b, this._totalBytes += b) : (this._lastSecondBytes = this._intervalBytes, this._intervalBytes = b, this._totalBytes += b, this._lastCheckpoint = this._now()) } }, { key: "currentKBps", get: function () { this.addBytes(0); var b = (this._now() - this._lastCheckpoint) / 1E3; 0 == b && (b = 1); return this._intervalBytes / b / 1024 } }, { key: "lastSecondKBps", get: function () { this.addBytes(0); return 0 !== this._lastSecondBytes ? this._lastSecondBytes / 1024 : 500 <= this._now() - this._lastCheckpoint ? this.currentKBps : 0 } }, { key: "averageKBps", get: function () { var b = (this._now() - this._firstCheckpoint) / 1E3; return this._totalBytes / b / 1024 } }]); return f }(); m.default = g }, {}], 28: [function (g, h, m) { function l(a, b) { if ("function" !== typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b); a.prototype = Object.create(b && b.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b) } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function p(a, b, e) { null === a && (a = Function.prototype); var c = Object.getOwnPropertyDescriptor(a, b); if (void 0 === c) { if (a = Object.getPrototypeOf(a), null !== a) return p(a, b, e) } else { if ("value" in c) return c.value; b = c.get; return void 0 === b ? void 0 : b.call(e) } }, b = function () { function a(a, b) { for (var e = 0; e < b.length; e++) { var c = b[e]; c.enumerable = c.enumerable || !1; c.configurable = !0; "value" in c && (c.writable = !0); Object.defineProperty(a, c.key, c) } } return function (b, e, f) { e && a(b.prototype, e); f && a(b, f); return b } }(); g("../utils/logger.js"); var a = g("./loader.js"), e = g("../utils/exception.js"); g = function (g) { function h() { if (!(this instanceof h)) throw new TypeError("Cannot call a class as a function"); var a; a = (h.__proto__ || Object.getPrototypeOf(h)).call(this, "websocket-loader"); if (!this) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); a = !a || "object" !== typeof a && "function" !== typeof a ? this : a; a.TAG = "WebSocketLoader"; a._needStash = !0; a._ws = null; a._requestAbort = !1; a._receivedLength = 0; return a } l(h, g); b(h, null, [{ key: "isSupported", value: function () { try { return "undefined" !== typeof self.WebSocket } catch (t) { return !1 } } }]); b(h, [{ key: "destroy", value: function () { this._ws && this.abort(); f(h.prototype.__proto__ || Object.getPrototypeOf(h.prototype), "destroy", this).call(this) } }, { key: "open", value: function (b) { try { var f = this._ws = new self.WebSocket(b.url); f.binaryType = "arraybuffer"; f.onopen = this._onWebSocketOpen.bind(this); f.onclose = this._onWebSocketClose.bind(this); f.onmessage = this._onWebSocketMessage.bind(this); f.onerror = this._onWebSocketError.bind(this); this._status = a.LoaderStatus.kConnecting } catch (c) { if (this._status = a.LoaderStatus.kError, b = { code: c.code, msg: c.message }, this._onError) this._onError(a.LoaderErrors.EXCEPTION, b); else throw new e.RuntimeException(b.msg); } } }, { key: "abort", value: function () { var b = this._ws; !b || 0 !== b.readyState && 1 !== b.readyState || (this._requestAbort = !0, b.close()); this._ws = null; this._status = a.LoaderStatus.kComplete } }, { key: "_onWebSocketOpen", value: function (b) { this._status = a.LoaderStatus.kBuffering } }, { key: "_onWebSocketClose", value: function (b) { !0 === this._requestAbort ? this._requestAbort = !1 : (this._status = a.LoaderStatus.kComplete, this._onComplete && this._onComplete(0, this._receivedLength - 1)) } }, { key: "_onWebSocketMessage", value: function (b) { var f = this; if (b.data instanceof ArrayBuffer) this._dispatchArrayBuffer(b.data); else if (b.data instanceof Blob) (function () { var a = new FileReader; a.onload = function () { f._dispatchArrayBuffer(a.result) }; a.readAsArrayBuffer(b.data) })(); else { this._status = a.LoaderStatus.kError; var c = { code: -1, msg: "Unsupported WebSocket message type: " + b.data.constructor.name }; if (this._onError) this._onError(a.LoaderErrors.EXCEPTION, c); else throw new e.RuntimeException(c.msg); } } }, { key: "_dispatchArrayBuffer", value: function (a) { var b = this._receivedLength; this._receivedLength += a.byteLength; this._onDataArrival && this._onDataArrival(a, b, this._receivedLength) } }, { key: "_onWebSocketError", value: function (b) { this._status = a.LoaderStatus.kError; b = { code: b.code, msg: b.message }; if (this._onError) this._onError(a.LoaderErrors.EXCEPTION, b); else throw new e.RuntimeException(b.msg); } }]); return h }(a.BaseLoader); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 29: [function (g, h, m) { function l(a, b) { if ("function" !== typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b); a.prototype = Object.create(b && b.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b) } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function t(a, c, b) { null === a && (a = Function.prototype); var d = Object.getOwnPropertyDescriptor(a, c); if (void 0 === d) { if (a = Object.getPrototypeOf(a), null !== a) return t(a, c, b) } else { if ("value" in d) return d.value; c = d.get; return void 0 === c ? void 0 : c.call(b) } }, a = function () { function a(a, c) { for (var b = 0; b < c.length; b++) { var d = c[b]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (b, c, d) { c && a(b.prototype, c); d && a(b, d); return b } }(), e = (h = g("../utils/logger.js")) && h.__esModule ? h : { default: h }, d = g("./loader.js"), p = g("../utils/exception.js"); g = function (g) { function h(a) { if (!(this instanceof h)) throw new TypeError("Cannot call a class as a function"); var c; c = (h.__proto__ || Object.getPrototypeOf(h)).call(this, "xhr-moz-chunked-loader"); if (!this) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); c = !c || "object" !== typeof c && "function" !== typeof c ? this : c; c.TAG = "MozChunkedLoader"; c._seekHandler = a; c._needStash = !0; c._xhr = null; c._requestAbort = !1; c._contentLength = null; c._receivedLength = 0; return c } l(h, g); a(h, null, [{ key: "isSupported", value: function () { try { var a = new XMLHttpRequest; a.open("GET", "https://example.com", !0); a.responseType = "moz-chunked-arraybuffer"; return "moz-chunked-arraybuffer" === a.responseType } catch (k) { return e.default.w("MozChunkedLoader", k.message), !1 } } }]); a(h, [{ key: "destroy", value: function () { this.isWorking() && this.abort(); this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onloadend = null, this._xhr = this._xhr.onerror = null); b(h.prototype.__proto__ || Object.getPrototypeOf(h.prototype), "destroy", this).call(this) } }, { key: "open", value: function (a, b) { this._dataSource = a; this._range = b; var c = this._seekHandler.getConfig(a.url, b); b = this._xhr = new XMLHttpRequest; b.open("GET", c.url, !0); b.responseType = "moz-chunked-arraybuffer"; b.onreadystatechange = this._onReadyStateChange.bind(this); b.onprogress = this._onProgress.bind(this); b.onloadend = this._onLoadEnd.bind(this); b.onerror = this._onXhrError.bind(this); a.withCredentials && b.withCredentials && (b.withCredentials = !0); if ("object" === f(c.headers)) { a = c.headers; for (var e in a) a.hasOwnProperty(e) && b.setRequestHeader(e, a[e]) } this._status = d.LoaderStatus.kConnecting; b.send() } }, { key: "abort", value: function () { this._requestAbort = !0; this._xhr && this._xhr.abort(); this._status = d.LoaderStatus.kComplete } }, { key: "_onReadyStateChange", value: function (a) { a = a.target; if (2 === a.readyState) if (0 !== a.status && (200 > a.status || 299 < a.status)) if (this._status = d.LoaderStatus.kError, this._onError) this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: a.status, msg: a.statusText }); else throw new p.RuntimeException("MozChunkedLoader: Http code invalid, " + a.status + " " + a.statusText); else this._status = d.LoaderStatus.kBuffering } }, { key: "_onProgress", value: function (a) { null === this._contentLength && null !== a.total && 0 !== a.total && (this._contentLength = a.total, this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength)); a = a.target.response; var c = this._range.from + this._receivedLength; this._receivedLength += a.byteLength; this._onDataArrival && this._onDataArrival(a, c, this._receivedLength) } }, { key: "_onLoadEnd", value: function (a) { !0 === this._requestAbort ? this._requestAbort = !1 : this._status !== d.LoaderStatus.kError && (this._status = d.LoaderStatus.kComplete, this._onComplete && this._onComplete(this._range.from, this._range.from + this._receivedLength - 1)) } }, { key: "_onXhrError", value: function (a) { this._status = d.LoaderStatus.kError; var c; this._contentLength && a.loaded < this._contentLength ? (c = d.LoaderErrors.EARLY_EOF, a = { code: -1, msg: "Moz-Chunked stream meet Early-Eof" }) : (c = d.LoaderErrors.EXCEPTION, a = { code: -1, msg: a.constructor.name + " " + a.type }); if (this._onError) this._onError(c, a); else throw new p.RuntimeException(a.msg); } }]); return h }(d.BaseLoader); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 30: [function (g, h, m) { function l(a, b) { if ("function" !== typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b); a.prototype = Object.create(b && b.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b) } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function t(a, c, b) { null === a && (a = Function.prototype); var d = Object.getOwnPropertyDescriptor(a, c); if (void 0 === d) { if (a = Object.getPrototypeOf(a), null !== a) return t(a, c, b) } else { if ("value" in d) return d.value; c = d.get; return void 0 === c ? void 0 : c.call(b) } }, a = function () { function a(a, c) { for (var b = 0; b < c.length; b++) { var d = c[b]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (b, c, d) { c && a(b.prototype, c); d && a(b, d); return b } }(), e = (h = g("../utils/logger.js")) && h.__esModule ? h : { default: h }, d = g("./loader.js"), p = g("../utils/exception.js"); g = function (g) { function h(a) { if (!(this instanceof h)) throw new TypeError("Cannot call a class as a function"); var c; c = (h.__proto__ || Object.getPrototypeOf(h)).call(this, "xhr-msstream-loader"); if (!this) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); c = !c || "object" !== typeof c && "function" !== typeof c ? this : c; c.TAG = "MSStreamLoader"; c._seekHandler = a; c._needStash = !0; c._xhr = null; c._reader = null; c._totalRange = null; c._currentRange = null; c._contentLength = null; c._receivedLength = 0; c._bufferLimit = 16777216; c._lastTimeBufferSize = 0; c._isReconnecting = !1; return c } l(h, g); a(h, null, [{ key: "isSupported", value: function () { try { if ("undefined" === typeof self.MSStream || "undefined" === typeof self.MSStreamReader) return !1; var a = new XMLHttpRequest; a.open("GET", "https://example.com", !0); a.responseType = "ms-stream"; return "ms-stream" === a.responseType } catch (k) { return e.default.w("MSStreamLoader", k.message), !1 } } }]); a(h, [{ key: "destroy", value: function () { this.isWorking() && this.abort(); this._reader && (this._reader.onprogress = null, this._reader.onload = null, this._reader = this._reader.onerror = null); this._xhr && (this._xhr = this._xhr.onreadystatechange = null); b(h.prototype.__proto__ || Object.getPrototypeOf(h.prototype), "destroy", this).call(this) } }, { key: "open", value: function (a, b) { this._internalOpen(a, b, !1) } }, { key: "_internalOpen", value: function (a, b, e) { this._dataSource = a; e ? this._currentRange = b : this._totalRange = b; b = this._seekHandler.getConfig(a.url, b); e = this._reader = new self.MSStreamReader; e.onprogress = this._msrOnProgress.bind(this); e.onload = this._msrOnLoad.bind(this); e.onerror = this._msrOnError.bind(this); e = this._xhr = new XMLHttpRequest; e.open("GET", b.url, !0); e.responseType = "ms-stream"; e.onreadystatechange = this._xhrOnReadyStateChange.bind(this); e.onerror = this._xhrOnError.bind(this); a.withCredentials && (e.withCredentials = !0); if ("object" === f(b.headers)) { a = b.headers; for (var c in a) a.hasOwnProperty(c) && e.setRequestHeader(c, a[c]) } this._isReconnecting ? this._isReconnecting = !1 : this._status = d.LoaderStatus.kConnecting; e.send() } }, { key: "abort", value: function () { this._internalAbort(); this._status = d.LoaderStatus.kComplete } }, { key: "_internalAbort", value: function () { this._reader && (1 === this._reader.readyState && this._reader.abort(), this._reader.onprogress = null, this._reader.onload = null, this._reader = this._reader.onerror = null); this._xhr && (this._xhr.abort(), this._xhr = this._xhr.onreadystatechange = null) } }, { key: "_xhrOnReadyStateChange", value: function (a) { a = a.target; if (3 === a.readyState) if (200 <= a.status && 299 >= a.status) { this._status = d.LoaderStatus.kBuffering; var c = a.getResponseHeader("Content-Length"); null != c && null == this._contentLength && (c = parseInt(c), 0 < c && (this._contentLength = c, this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength))); this._reader.readAsArrayBuffer(a.response) } else if (this._status = d.LoaderStatus.kError, this._onError) this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: a.status, msg: a.statusText }); else throw new p.RuntimeException("MSStreamLoader: Http code invalid, " + a.status + " " + a.statusText); } }, { key: "_xhrOnError", value: function (a) { this._status = d.LoaderStatus.kError; var c = d.LoaderErrors.EXCEPTION; a = { code: -1, msg: a.constructor.name + " " + a.type }; if (this._onError) this._onError(c, a); else throw new p.RuntimeException(a.msg); } }, { key: "_msrOnProgress", value: function (a) { a = a.target.result; if (null == a) this._doReconnectIfNeeded(); else { var b = a.slice(this._lastTimeBufferSize); this._lastTimeBufferSize = a.byteLength; var c = this._totalRange.from + this._receivedLength; this._receivedLength += b.byteLength; this._onDataArrival && this._onDataArrival(b, c, this._receivedLength); a.byteLength >= this._bufferLimit && (e.default.v(this.TAG, "MSStream buffer exceeded max size near " + (c + b.byteLength) + ", reconnecting..."), this._doReconnectIfNeeded()) } } }, { key: "_doReconnectIfNeeded", value: function () { if (null == this._contentLength || this._receivedLength < this._contentLength) this._isReconnecting = !0, this._lastTimeBufferSize = 0, this._internalAbort(), this._internalOpen(this._dataSource, { from: this._totalRange.from + this._receivedLength, to: -1 }, !0) } }, { key: "_msrOnLoad", value: function (a) { this._status = d.LoaderStatus.kComplete; this._onComplete && this._onComplete(this._totalRange.from, this._totalRange.from + this._receivedLength - 1) } }, { key: "_msrOnError", value: function (a) { this._status = d.LoaderStatus.kError; var b; this._contentLength && this._receivedLength < this._contentLength ? (b = d.LoaderErrors.EARLY_EOF, a = { code: -1, msg: "MSStream meet Early-Eof" }) : (b = d.LoaderErrors.EARLY_EOF, a = { code: -1, msg: a.constructor.name + " " + a.type }); if (this._onError) this._onError(b, a); else throw new p.RuntimeException(a.msg); } }]); return h }(d.BaseLoader); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24 }], 31: [function (g, h, m) { function l(a, b) { if ("function" !== typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b); a.prototype = Object.create(b && b.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b) } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function n(a, b, d) { null === a && (a = Function.prototype); var c = Object.getOwnPropertyDescriptor(a, b); if (void 0 === c) { if (a = Object.getPrototypeOf(a), null !== a) return n(a, b, d) } else { if ("value" in c) return c.value; b = c.get; return void 0 === b ? void 0 : b.call(d) } }, a = function () { function a(a, b) { for (var c = 0; c < b.length; c++) { var d = b[c]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (b, d, e) { d && a(b.prototype, d); e && a(b, e); return b } }(), e = (h = g("../utils/logger.js")) && h.__esModule ? h : { default: h }, d = (h = g("./speed-sampler.js")) && h.__esModule ? h : { default: h }, p = g("./loader.js"), r = g("../utils/exception.js"); g = function (g) { function c(a) { if (!(this instanceof c)) throw new TypeError("Cannot call a class as a function"); var b; b = (c.__proto__ || Object.getPrototypeOf(c)).call(this, "xhr-range-loader"); if (!this) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); b = !b || "object" !== typeof b && "function" !== typeof b ? this : b; b.TAG = "RangeLoader"; b._seekHandler = a; b._needStash = !1; b._chunkSizeKBList = [128, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096, 5120, 6144, 7168, 8192]; b._currentChunkSizeKB = 384; b._currentSpeedNormalized = 0; b._zeroSpeedChunkCount = 0; b._xhr = null; b._speedSampler = new d.default; b._requestAbort = !1; b._waitForTotalLength = !1; b._totalLengthReceived = !1; b._currentRequestRange = null; b._totalLength = null; b._contentLength = null; b._receivedLength = 0; b._lastTimeLoaded = 0; return b } l(c, g); a(c, null, [{ key: "isSupported", value: function () { try { var a = new XMLHttpRequest; a.open("GET", "https://example.com", !0); a.responseType = "arraybuffer"; return "arraybuffer" === a.responseType } catch (q) { return e.default.w("RangeLoader", q.message), !1 } } }]); a(c, [{ key: "destroy", value: function () { this.isWorking() && this.abort(); this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onload = null, this._xhr = this._xhr.onerror = null); b(c.prototype.__proto__ || Object.getPrototypeOf(c.prototype), "destroy", this).call(this) } }, { key: "open", value: function (a, b) { this._dataSource = a; this._range = b; this._status = p.LoaderStatus.kConnecting; this._totalLengthReceived ? this._openSubRange() : (this._waitForTotalLength = !0, this._internalOpen(this._dataSource, { from: 0, to: -1 })) } }, { key: "_openSubRange", value: function () { var a = this._range.from + this._receivedLength, b = a + 1024 * this._currentChunkSizeKB; null != this._contentLength && b - this._range.from >= this._contentLength && (b = this._range.from + this._contentLength - 1); this._currentRequestRange = { from: a, to: b }; this._internalOpen(this._dataSource, this._currentRequestRange) } }, { key: "_internalOpen", value: function (a, b) { this._lastTimeLoaded = 0; var c = this._seekHandler.getConfig(a.url, b); b = this._xhr = new XMLHttpRequest; b.open("GET", c.url, !0); b.responseType = "arraybuffer"; b.onreadystatechange = this._onReadyStateChange.bind(this); b.onprogress = this._onProgress.bind(this); b.onload = this._onLoad.bind(this); b.onerror = this._onXhrError.bind(this); a.withCredentials && b.withCredentials && (b.withCredentials = !0); if ("object" === f(c.headers)) { a = c.headers; for (var d in a) a.hasOwnProperty(d) && b.setRequestHeader(d, a[d]) } b.send() } }, { key: "abort", value: function () { this._requestAbort = !0; this._internalAbort(); this._status = p.LoaderStatus.kComplete } }, { key: "_internalAbort", value: function () { this._xhr && (this._xhr.onreadystatechange = null, this._xhr.onprogress = null, this._xhr.onload = null, this._xhr.onerror = null, this._xhr.abort(), this._xhr = null) } }, { key: "_onReadyStateChange", value: function (a) { a = a.target; if (2 === a.readyState) if (200 <= a.status && 300 > a.status) this._waitForTotalLength || (this._status = p.LoaderStatus.kBuffering); else if (this._status = p.LoaderStatus.kError, this._onError) this._onError(p.LoaderErrors.HTTP_STATUS_CODE_INVALID, { code: a.status, msg: a.statusText }); else throw new r.RuntimeException("RangeLoader: Http code invalid, " + a.status + " " + a.statusText); } }, { key: "_onProgress", value: function (a) { if (null === this._contentLength) { var b = !1; if (this._waitForTotalLength) { this._waitForTotalLength = !1; var b = this._totalLengthReceived = !0, c = a.total; this._internalAbort(); null != c & 0 !== c && (this._totalLength = c) } this._contentLength = -1 === this._range.to ? this._totalLength - this._range.from : this._range.to - this._range.from + 1; if (b) { this._openSubRange(); return } this._onContentLengthKnown && this._onContentLengthKnown(this._contentLength) } b = a.loaded - this._lastTimeLoaded; this._lastTimeLoaded = a.loaded; this._speedSampler.addBytes(b) } }, { key: "_normalizeSpeed", value: function (a) { var b = this._chunkSizeKBList, c = b.length - 1, d, e = 0, f = c; if (a < b[0]) return b[0]; for (; e <= f;) { d = e + Math.floor((f - e) / 2); if (d === c || a >= b[d] && a < b[d + 1]) return b[d]; b[d] < a ? e = d + 1 : f = d - 1 } } }, { key: "_onLoad", value: function (a) { if (this._waitForTotalLength) this._waitForTotalLength = !1; else { this._lastTimeLoaded = 0; var b = this._speedSampler.lastSecondKBps; 0 === b && (this._zeroSpeedChunkCount++, 3 <= this._zeroSpeedChunkCount && (b = this._speedSampler.currentKBps)); 0 !== b && (b = this._normalizeSpeed(b), this._currentSpeedNormalized !== b && (this._currentChunkSizeKB = this._currentSpeedNormalized = b)); a = a.target.response; b = this._range.from + this._receivedLength; this._receivedLength += a.byteLength; var c = !1; null != this._contentLength && this._receivedLength < this._contentLength ? this._openSubRange() : c = !0; this._onDataArrival && this._onDataArrival(a, b, this._receivedLength); c && (this._status = p.LoaderStatus.kComplete, this._onComplete && this._onComplete(this._range.from, this._range.from + this._receivedLength - 1)) } } }, { key: "_onXhrError", value: function (a) { this._status = p.LoaderStatus.kError; var b; this._contentLength && 0 < this._receivedLength && this._receivedLength < this._contentLength ? (b = p.LoaderErrors.EARLY_EOF, a = { code: -1, msg: "RangeLoader meet Early-Eof" }) : (b = p.LoaderErrors.EXCEPTION, a = { code: -1, msg: a.constructor.name + " " + a.type }); if (this._onError) this._onError(b, a); else throw new r.RuntimeException(a.msg); } }, { key: "currentSpeed", get: function () { return this._speedSampler.lastSecondKBps } }]); return c }(p.BaseLoader); m.default = g }, { "../utils/exception.js": 40, "../utils/logger.js": 41, "./loader.js": 24, "./speed-sampler.js": 27 }], 32: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, b = function () { function a(a, b) { for (var c = 0; c < b.length; c++) { var d = b[c]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (b, c, d) { c && a(b.prototype, c); d && a(b, d); return b } }(); h = g("events"); var a = l(h); h = g("../utils/logger.js"); var e = l(h); h = g("../utils/browser.js"); var d = l(h); h = g("./player-events.js"); var p = l(h); h = g("../core/transmuxer.js"); var r = l(h); h = g("../core/transmuxing-events.js"); var t = l(h); h = g("../core/mse-controller.js"); var n = l(h); h = g("../core/mse-events.js"); var c = l(h), k = g("./player-errors.js"), q = g("../config.js"), w = g("../utils/exception.js"); g = function () { function g(b, c) { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this._type = this.TAG = "FlvPlayer"; this._emitter = new a.default; this._config = (0, q.createDefaultConfig)(); "object" === ("undefined" === typeof c ? "undefined" : f(c)) && Object.assign(this._config, c); if ("flv" !== b.type.toLowerCase()) throw new w.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!"); !0 === b.isLive && (this._config.isLive = !0); this.e = { onvLoadedMetadata: this._onvLoadedMetadata.bind(this), onvSeeking: this._onvSeeking.bind(this), onvCanPlay: this._onvCanPlay.bind(this), onvStalled: this._onvStalled.bind(this), onvProgress: this._onvProgress.bind(this) }; this._now = self.performance && self.performance.now ? self.performance.now.bind(self.performance) : Date.now; this._pendingSeekTime = null; this._requestSetTime = !1; this._progressChecker = this._seekpointRecord = null; this._mediaDataSource = b; this._transmuxer = this._msectl = this._mediaElement = null; this._receivedCanPlay = this._hasPendingLoad = this._mseSourceOpened = !1; this._statisticsInfo = this._mediaInfo = null; if (this._alwaysSeekKeyframe = d.default.chrome && (50 > d.default.version.major || 50 === d.default.version.major && 2661 > d.default.version.build) || d.default.msedge || d.default.msie ? !0 : !1) this._config.accurateSeek = !1 } b(g, [{ key: "destroy", value: function () { null != this._progressChecker && (window.clearInterval(this._progressChecker), this._progressChecker = null); this._transmuxer && this.unload(); this._mediaElement && this.detachMediaElement(); this._mediaDataSource = this.e = null; this._emitter.removeAllListeners(); this._emitter = null } }, { key: "on", value: function (a, b) { var c = this; a === p.default.MEDIA_INFO ? null != this._mediaInfo && Promise.resolve().then(function () { c._emitter.emit(p.default.MEDIA_INFO, c.mediaInfo) }) : a === p.default.STATISTICS_INFO && null != this._statisticsInfo && Promise.resolve().then(function () { c._emitter.emit(p.default.STATISTICS_INFO, c.statisticsInfo) }); this._emitter.addListener(a, b) } }, { key: "off", value: function (a, b) { this._emitter.removeListener(a, b) } }, { key: "attachMediaElement", value: function (a) { var b = this; this._mediaElement = a; a.addEventListener("loadedmetadata", this.e.onvLoadedMetadata); a.addEventListener("seeking", this.e.onvSeeking); a.addEventListener("canplay", this.e.onvCanPlay); a.addEventListener("stalled", this.e.onvStalled); a.addEventListener("progress", this.e.onvProgress); this._msectl = new n.default; this._msectl.on(c.default.UPDATE_END, this._onmseUpdateEnd.bind(this)); this._msectl.on(c.default.BUFFER_FULL, this._onmseBufferFull.bind(this)); this._msectl.on(c.default.SOURCE_OPEN, function () { b._mseSourceOpened = !0; b._hasPendingLoad && (b._hasPendingLoad = !1, b.load()) }); this._msectl.on(c.default.ERROR, function (a) { b._emitter.emit(p.default.ERROR, k.ErrorTypes.MEDIA_ERROR, k.ErrorDetails.MEDIA_MSE_ERROR, a) }); this._msectl.attachMediaElement(a); if (null != this._pendingSeekTime) try { a.currentTime = this._pendingSeekTime, this._pendingSeekTime = null } catch (T) { } } }, { key: "detachMediaElement", value: function () { this._mediaElement && (this._msectl.detachMediaElement(), this._mediaElement.removeEventListener("loadedmetadata", this.e.onvLoadedMetadata), this._mediaElement.removeEventListener("seeking", this.e.onvSeeking), this._mediaElement.removeEventListener("canplay", this.e.onvCanPlay), this._mediaElement.removeEventListener("stalled", this.e.onvStalled), this._mediaElement.removeEventListener("progress", this.e.onvProgress), this._mediaElement = null); this._msectl && (this._msectl.destroy(), this._msectl = null) } }, { key: "load", value: function () { var a = this; if (!this._mediaElement) throw new w.IllegalStateException("HTMLMediaElement must be attached before load()!"); if (this._transmuxer) throw new w.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!"); this._hasPendingLoad || (this._config.deferLoadAfterSourceOpen && !1 === this._mseSourceOpened ? this._hasPendingLoad = !0 : (0 < this._mediaElement.readyState && (this._requestSetTime = !0, this._mediaElement.currentTime = 0), this._transmuxer = new r.default(this._mediaDataSource, this._config), this._transmuxer.on(t.default.INIT_SEGMENT, function (b, c) { a._msectl.appendInitSegment(c) }), this._transmuxer.on(t.default.MEDIA_SEGMENT, function (b, c) { a._msectl.appendMediaSegment(c); a._config.lazyLoad && !a._config.isLive && c.info.endDts >= 1E3 * (a._mediaElement.currentTime + a._config.lazyLoadMaxDuration) && null == a._progressChecker && (e.default.v(a.TAG, "Maximum buffering duration exceeded, suspend transmuxing task"), a._suspendTransmuxer()) }), this._transmuxer.on(t.default.LOADING_COMPLETE, function () { a._msectl.endOfStream(); a._emitter.emit(p.default.LOADING_COMPLETE) }), this._transmuxer.on(t.default.RECOVERED_EARLY_EOF, function () { a._emitter.emit(p.default.RECOVERED_EARLY_EOF) }), this._transmuxer.on(t.default.IO_ERROR, function (b, c) { a._emitter.emit(p.default.ERROR, k.ErrorTypes.NETWORK_ERROR, b, c) }), this._transmuxer.on(t.default.DEMUX_ERROR, function (b, c) { a._emitter.emit(p.default.ERROR, k.ErrorTypes.MEDIA_ERROR, b, { code: -1, msg: c }) }), this._transmuxer.on(t.default.MEDIA_INFO, function (b) { a._mediaInfo = b; a._emitter.emit(p.default.MEDIA_INFO, Object.assign({}, b)) }), this._transmuxer.on(t.default.STATISTICS_INFO, function (b) { a._statisticsInfo = a._fillStatisticsInfo(b); a._emitter.emit(p.default.STATISTICS_INFO, Object.assign({}, a._statisticsInfo)) }), this._transmuxer.on(t.default.RECOMMEND_SEEKPOINT, function (b) { a._mediaElement && !a._config.accurateSeek && (a._requestSetTime = !0, a._mediaElement.currentTime = b / 1E3) }), this._transmuxer.open())) } }, { key: "unload", value: function () { this._mediaElement && this._mediaElement.pause(); this._msectl && this._msectl.seek(0); this._transmuxer && (this._transmuxer.close(), this._transmuxer.destroy(), this._transmuxer = null) } }, { key: "play", value: function () { this._mediaElement.play() } }, { key: "pause", value: function () { this._mediaElement.pause() } }, { key: "_fillStatisticsInfo", value: function (a) { a.playerType = this._type; if (!(this._mediaElement instanceof HTMLVideoElement)) return a; var b = !0, c = 0, d = 0; this._mediaElement.getVideoPlaybackQuality ? (d = this._mediaElement.getVideoPlaybackQuality(), c = d.totalVideoFrames, d = d.droppedVideoFrames) : void 0 != this._mediaElement.webkitDecodedFrameCount ? (c = this._mediaElement.webkitDecodedFrameCount, d = this._mediaElement.webkitDroppedFrameCount) : b = !1; b && (a.decodedFrames = c, a.droppedFrames = d); return a } }, { key: "_onmseUpdateEnd", value: function () { if (this._config.lazyLoad && !this._config.isLive) { for (var a = this._mediaElement.buffered, b = this._mediaElement.currentTime, c = 0, d = 0; d < a.length; d++) { var f = a.start(d), g = a.end(d); if (f <= b && b < g) { c = g; break } } c >= b + this._config.lazyLoadMaxDuration && null == this._progressChecker && (e.default.v(this.TAG, "Maximum buffering duration exceeded, suspend transmuxing task"), this._suspendTransmuxer()) } } }, { key: "_onmseBufferFull", value: function () { e.default.v(this.TAG, "MSE SourceBuffer is full, suspend transmuxing task"); null == this._progressChecker && this._suspendTransmuxer() } }, { key: "_suspendTransmuxer", value: function () { this._transmuxer && (this._transmuxer.pause(), null == this._progressChecker && (this._progressChecker = window.setInterval(this._checkProgressAndResume.bind(this), 1E3))) } }, { key: "_checkProgressAndResume", value: function () { for (var a = this._mediaElement.currentTime, b = this._mediaElement.buffered, c = !1, d = 0; d < b.length; d++) { var f = b.start(d), g = b.end(d); if (a >= f && a < g) { a >= g - 30 && (c = !0); break } } c && (window.clearInterval(this._progressChecker), this._progressChecker = null, c && (e.default.v(this.TAG, "Continue loading from paused position"), this._transmuxer.resume())) } }, { key: "_isTimepointBuffered", value: function (a) { for (var b = this._mediaElement.buffered, c = 0; c < b.length; c++) { var d = b.start(c), e = b.end(c); if (a >= d && a < e) return !0 } return !1 } }, { key: "_internalSeek", value: function (a) { var b = this._isTimepointBuffered(a), c = !1, e = 0; if (1 > a && 0 < this._mediaElement.buffered.length) { var f = this._mediaElement.buffered.start(0); if (1 > f && a < f || d.default.safari) c = !0, e = d.default.safari ? .1 : f } c ? (this._requestSetTime = !0, this._mediaElement.currentTime = e) : b ? (this._alwaysSeekKeyframe ? (b = this._msectl.getNearestKeyframe(Math.floor(1E3 * a)), this._requestSetTime = !0, this._mediaElement.currentTime = null != b ? b.dts / 1E3 : a) : (this._requestSetTime = !0, this._mediaElement.currentTime = a), null != this._progressChecker && this._checkProgressAndResume()) : (null != this._progressChecker && (window.clearInterval(this._progressChecker), this._progressChecker = null), this._msectl.seek(a), this._transmuxer.seek(Math.floor(1E3 * a)), this._config.accurateSeek && (this._requestSetTime = !0, this._mediaElement.currentTime = a)) } }, { key: "_checkAndApplyUnbufferedSeekpoint", value: function () { if (this._seekpointRecord) if (this._seekpointRecord.recordTime <= this._now() - 100) { var a = this._mediaElement.currentTime; this._seekpointRecord = null; this._isTimepointBuffered(a) || (null != this._progressChecker && (window.clearTimeout(this._progressChecker), this._progressChecker = null), this._msectl.seek(a), this._transmuxer.seek(Math.floor(1E3 * a)), this._config.accurateSeek && (this._requestSetTime = !0, this._mediaElement.currentTime = a)) } else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50) } }, { key: "_checkAndResumeStuckPlayback", value: function (a) { var b = this._mediaElement; a || !this._receivedCanPlay || 2 > b.readyState ? (a = b.buffered, 0 < a.length && b.currentTime < a.start(0) && (e.default.w(this.TAG, "Playback seems stuck at " + b.currentTime + ", seek to " + a.start(0)), this._requestSetTime = !0, this._mediaElement.currentTime = a.start(0), this._mediaElement.removeEventListener("progress", this.e.onvProgress))) : this._mediaElement.removeEventListener("progress", this.e.onvProgress) } }, { key: "_onvLoadedMetadata", value: function (a) { null != this._pendingSeekTime && (this._mediaElement.currentTime = this._pendingSeekTime, this._pendingSeekTime = null) } }, { key: "_onvSeeking", value: function (a) { a = this._mediaElement.currentTime; var b = this._mediaElement.buffered; if (this._requestSetTime) this._requestSetTime = !1; else { if (1 > a && 0 < b.length && (b = b.start(0), 1 > b && a < b || d.default.safari)) { this._requestSetTime = !0; this._mediaElement.currentTime = d.default.safari ? .1 : b; return } this._isTimepointBuffered(a) ? (this._alwaysSeekKeyframe && (a = this._msectl.getNearestKeyframe(Math.floor(1E3 * a)), null != a && (this._requestSetTime = !0, this._mediaElement.currentTime = a.dts / 1E3)), null != this._progressChecker && this._checkProgressAndResume()) : (this._seekpointRecord = { seekPoint: a, recordTime: this._now() }, window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this), 50)) } } }, { key: "_onvCanPlay", value: function (a) { this._receivedCanPlay = !0; this._mediaElement.removeEventListener("canplay", this.e.onvCanPlay) } }, { key: "_onvStalled", value: function (a) { this._checkAndResumeStuckPlayback(!0) } }, { key: "_onvProgress", value: function (a) { this._checkAndResumeStuckPlayback() } }, { key: "type", get: function () { return this._type } }, { key: "buffered", get: function () { return this._mediaElement.buffered } }, { key: "duration", get: function () { return this._mediaElement.duration } }, { key: "volume", get: function () { return this._mediaElement.volume }, set: function (a) { this._mediaElement.volume = a } }, { key: "muted", get: function () { return this._mediaElement.muted }, set: function (a) { this._mediaElement.muted = a } }, { key: "currentTime", get: function () { return this._mediaElement ? this._mediaElement.currentTime : 0 }, set: function (a) { this._mediaElement ? this._internalSeek(a) : this._pendingSeekTime = a } }, { key: "mediaInfo", get: function () { return Object.assign({}, this._mediaInfo) } }, { key: "statisticsInfo", get: function () { null == this._statisticsInfo && (this._statisticsInfo = {}); this._statisticsInfo = this._fillStatisticsInfo(this._statisticsInfo); return Object.assign({}, this._statisticsInfo) } }]); return g }(); m.default = g }, { "../config.js": 5, "../core/mse-controller.js": 9, "../core/mse-events.js": 10, "../core/transmuxer.js": 11, "../core/transmuxing-events.js": 13, "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./player-errors.js": 34, "./player-events.js": 35, events: 2 }], 33: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = "function" === typeof Symbol && "symbol" === typeof Symbol.iterator ? function (a) { return typeof a } : function (a) { return a && "function" === typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a }, f = function () { function a(a, b) { for (var d = 0; d < b.length; d++) { var c = b[d]; c.enumerable = c.enumerable || !1; c.configurable = !0; "value" in c && (c.writable = !0); Object.defineProperty(a, c.key, c) } } return function (b, d, e) { d && a(b.prototype, d); e && a(b, e); return b } }(), b = (h = g("events")) && h.__esModule ? h : { default: h }, a = (h = g("./player-events.js")) && h.__esModule ? h : { default: h }, e = g("../config.js"), d = g("../utils/exception.js"); g = function () { function g(a, f) { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this._type = this.TAG = "NativePlayer"; this._emitter = new b.default; this._config = (0, e.createDefaultConfig)(); "object" === ("undefined" === typeof f ? "undefined" : l(f)) && Object.assign(this._config, f); if ("flv" === a.type.toLowerCase()) throw new d.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!"); if (a.hasOwnProperty("segments")) throw new d.InvalidArgumentException("NativePlayer(" + a.type + ") doesn't support multipart playback!"); this.e = { onvLoadedMetadata: this._onvLoadedMetadata.bind(this) }; this._statisticsReporter = this._pendingSeekTime = null; this._mediaDataSource = a; this._mediaElement = null } f(g, [{ key: "destroy", value: function () { this._mediaElement && (this.unload(), this.detachMediaElement()); this._mediaDataSource = this.e = null; this._emitter.removeAllListeners(); this._emitter = null } }, { key: "on", value: function (b, d) { var e = this; b === a.default.MEDIA_INFO ? null != this._mediaElement && 0 !== this._mediaElement.readyState && Promise.resolve().then(function () { e._emitter.emit(a.default.MEDIA_INFO, e.mediaInfo) }) : b === a.default.STATISTICS_INFO && null != this._mediaElement && 0 !== this._mediaElement.readyState && Promise.resolve().then(function () { e._emitter.emit(a.default.STATISTICS_INFO, e.statisticsInfo) }); this._emitter.addListener(b, d) } }, { key: "off", value: function (a, b) { this._emitter.removeListener(a, b) } }, { key: "attachMediaElement", value: function (a) { this._mediaElement = a; a.addEventListener("loadedmetadata", this.e.onvLoadedMetadata); if (null != this._pendingSeekTime) try { a.currentTime = this._pendingSeekTime, this._pendingSeekTime = null } catch (t) { } } }, { key: "detachMediaElement", value: function () { this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src"), this._mediaElement.removeEventListener("loadedmetadata", this.e.onvLoadedMetadata), this._mediaElement = null); null != this._statisticsReporter && (window.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "load", value: function () { if (!this._mediaElement) throw new d.IllegalStateException("HTMLMediaElement must be attached before load()!"); this._mediaElement.src = this._mediaDataSource.url; 0 < this._mediaElement.readyState && (this._mediaElement.currentTime = 0); this._mediaElement.preload = "auto"; this._mediaElement.load(); this._statisticsReporter = window.setInterval(this._reportStatisticsInfo.bind(this), this._config.statisticsInfoReportInterval) } }, { key: "unload", value: function () { this._mediaElement && (this._mediaElement.src = "", this._mediaElement.removeAttribute("src")); null != this._statisticsReporter && (window.clearInterval(this._statisticsReporter), this._statisticsReporter = null) } }, { key: "play", value: function () { this._mediaElement.play() } }, { key: "pause", value: function () { this._mediaElement.pause() } }, { key: "_onvLoadedMetadata", value: function (b) { null != this._pendingSeekTime && (this._mediaElement.currentTime = this._pendingSeekTime, this._pendingSeekTime = null); this._emitter.emit(a.default.MEDIA_INFO, this.mediaInfo) } }, { key: "_reportStatisticsInfo", value: function () { this._emitter.emit(a.default.STATISTICS_INFO, this.statisticsInfo) } }, { key: "type", get: function () { return this._type } }, { key: "buffered", get: function () { return this._mediaElement.buffered } }, { key: "duration", get: function () { return this._mediaElement.duration } }, { key: "volume", get: function () { return this._mediaElement.volume }, set: function (a) { this._mediaElement.volume = a } }, { key: "muted", get: function () { return this._mediaElement.muted }, set: function (a) { this._mediaElement.muted = a } }, { key: "currentTime", get: function () { return this._mediaElement ? this._mediaElement.currentTime : 0 }, set: function (a) { this._mediaElement ? this._mediaElement.currentTime = a : this._pendingSeekTime = a } }, { key: "mediaInfo", get: function () { var a = { mimeType: (this._mediaElement instanceof HTMLAudioElement ? "audio/" : "video/") + this._mediaDataSource.type }; this._mediaElement && (a.duration = Math.floor(1E3 * this._mediaElement.duration), this._mediaElement instanceof HTMLVideoElement && (a.width = this._mediaElement.videoWidth, a.height = this._mediaElement.videoHeight)); return a } }, { key: "statisticsInfo", get: function () { var a = { playerType: this._type, url: this._mediaDataSource.url }; if (!(this._mediaElement instanceof HTMLVideoElement)) return a; var b = !0, d = 0, c = 0; this._mediaElement.getVideoPlaybackQuality ? (c = this._mediaElement.getVideoPlaybackQuality(), d = c.totalVideoFrames, c = c.droppedVideoFrames) : void 0 != this._mediaElement.webkitDecodedFrameCount ? (d = this._mediaElement.webkitDecodedFrameCount, c = this._mediaElement.webkitDroppedFrameCount) : b = !1; b && (a.decodedFrames = d, a.droppedFrames = c); return a } }]); return g }(); m.default = g }, { "../config.js": 5, "../utils/exception.js": 40, "./player-events.js": 35, events: 2 }], 34: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.ErrorDetails = m.ErrorTypes = void 0; h = g("../io/loader.js"); g = (g = g("../demux/demux-errors.js")) && g.__esModule ? g : { default: g }; m.ErrorTypes = { NETWORK_ERROR: "NetworkError", MEDIA_ERROR: "MediaError", OTHER_ERROR: "OtherError" }; m.ErrorDetails = { NETWORK_EXCEPTION: h.LoaderErrors.EXCEPTION, NETWORK_STATUS_CODE_INVALID: h.LoaderErrors.HTTP_STATUS_CODE_INVALID, NETWORK_TIMEOUT: h.LoaderErrors.CONNECTING_TIMEOUT, NETWORK_UNRECOVERABLE_EARLY_EOF: h.LoaderErrors.UNRECOVERABLE_EARLY_EOF, MEDIA_MSE_ERROR: "MediaMSEError", MEDIA_FORMAT_ERROR: g.default.FORMAT_ERROR, MEDIA_FORMAT_UNSUPPORTED: g.default.FORMAT_UNSUPPORTED, MEDIA_CODEC_UNSUPPORTED: g.default.CODEC_UNSUPPORTED } }, { "../demux/demux-errors.js": 16, "../io/loader.js": 24 }], 35: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); m.default = { ERROR: "error", LOADING_COMPLETE: "loading_complete", RECOVERED_EARLY_EOF: "recovered_early_eof", MEDIA_INFO: "media_info", STATISTICS_INFO: "statistics_info" } }, {}], 36: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); } l(f, null, [{ key: "getSilentFrame", value: function (b) { return 1 === b ? new Uint8Array([0, 200, 0, 128, 35, 128]) : 2 === b ? new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]) : 3 === b ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]) : 4 === b ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]) : 5 === b ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56]) : 6 === b ? new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8, 224]) : null } }]); return f }(); m.default = g }, {}], 37: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); } l(f, null, [{ key: "init", value: function () { f.types = { avc1: [], avcC: [], btrt: [], dinf: [], dref: [], esds: [], ftyp: [], hdlr: [], mdat: [], mdhd: [], mdia: [], mfhd: [], minf: [], moof: [], moov: [], mp4a: [], mvex: [], mvhd: [], sdtp: [], stbl: [], stco: [], stsc: [], stsd: [], stsz: [], stts: [], tfdt: [], tfhd: [], traf: [], trak: [], trun: [], trex: [], tkhd: [], vmhd: [], smhd: [] }; for (var b in f.types) f.types.hasOwnProperty(b) && (f.types[b] = [b.charCodeAt(0), b.charCodeAt(1), b.charCodeAt(2), b.charCodeAt(3)]); b = f.constants = {}; b.FTYP = new Uint8Array([105, 115, 111, 109, 0, 0, 0, 1, 105, 115, 111, 109, 97, 118, 99, 49]); b.STSD_PREFIX = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]); b.STTS = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]); b.STSC = b.STCO = b.STTS; b.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]); b.HDLR_VIDEO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0]); b.HDLR_AUDIO = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0]); b.DREF = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]); b.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]); b.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]) } }, { key: "box", value: function (b) { var a = 8, e, d = Array.prototype.slice.call(arguments, 1), f = d.length; for (e = 0; e < f; e++) a += d[e].byteLength; e = new Uint8Array(a); e[0] = a >>> 24 & 255; e[1] = a >>> 16 & 255; e[2] = a >>> 8 & 255; e[3] = a & 255; e.set(b, 4); for (var a = 8, g = 0; g < f; g++) e.set(d[g], a), a += d[g].byteLength; return e } }, { key: "generateInitSegment", value: function (b) { var a = f.box(f.types.ftyp, f.constants.FTYP); b = f.moov(b); var e = new Uint8Array(a.byteLength + b.byteLength); e.set(a, 0); e.set(b, a.byteLength); return e } }, { key: "moov", value: function (b) { var a = f.mvhd(b.timescale, b.duration), e = f.trak(b); b = f.mvex(b); return f.box(f.types.moov, a, e, b) } }, { key: "mvhd", value: function (b, a) { return f.box(f.types.mvhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, b >>> 24 & 255, b >>> 16 & 255, b >>> 8 & 255, b & 255, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, a & 255, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255])) } }, { key: "trak", value: function (b) { return f.box(f.types.trak, f.tkhd(b), f.mdia(b)) } }, { key: "tkhd", value: function (b) { var a = b.id, e = b.duration, d = b.presentWidth; b = b.presentHeight; return f.box(f.types.tkhd, new Uint8Array([0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, a & 255, 0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, e & 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, d >>> 8 & 255, d & 255, 0, 0, b >>> 8 & 255, b & 255, 0, 0])) } }, { key: "mdia", value: function (b) { return f.box(f.types.mdia, f.mdhd(b), f.hdlr(b), f.minf(b)) } }, { key: "mdhd", value: function (b) { var a = b.timescale; b = b.duration; return f.box(f.types.mdhd, new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, a & 255, b >>> 24 & 255, b >>> 16 & 255, b >>> 8 & 255, b & 255, 85, 196, 0, 0])) } }, { key: "hdlr", value: function (b) { return f.box(f.types.hdlr, "audio" === b.type ? f.constants.HDLR_AUDIO : f.constants.HDLR_VIDEO) } }, { key: "minf", value: function (b) { var a; a = "audio" === b.type ? f.box(f.types.smhd, f.constants.SMHD) : f.box(f.types.vmhd, f.constants.VMHD); return f.box(f.types.minf, a, f.dinf(), f.stbl(b)) } }, { key: "dinf", value: function () { return f.box(f.types.dinf, f.box(f.types.dref, f.constants.DREF)) } }, { key: "stbl", value: function (b) { return f.box(f.types.stbl, f.stsd(b), f.box(f.types.stts, f.constants.STTS), f.box(f.types.stsc, f.constants.STSC), f.box(f.types.stsz, f.constants.STSZ), f.box(f.types.stco, f.constants.STCO)) } }, { key: "stsd", value: function (b) { return "audio" === b.type ? f.box(f.types.stsd, f.constants.STSD_PREFIX, f.mp4a(b)) : f.box(f.types.stsd, f.constants.STSD_PREFIX, f.avc1(b)) } }, { key: "mp4a", value: function (b) { var a = b.audioSampleRate, a = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, b.channelCount, 0, 16, 0, 0, 0, 0, a >>> 8 & 255, a & 255, 0, 0]); return f.box(f.types.mp4a, a, f.esds(b)) } }, { key: "esds", value: function (b) { b = b.config; var a = b.length; b = new Uint8Array([0, 0, 0, 0, 3, 23 + a, 0, 1, 0, 4, 15 + a, 64, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5].concat([a]).concat(b).concat([6, 1, 2])); return f.box(f.types.esds, b) } }, { key: "avc1", value: function (b) { var a = b.avcc, e = b.codecWidth; b = b.codecHeight; e = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, e >>> 8 & 255, e & 255, b >>> 8 & 255, b & 255, 0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 10, 120, 113, 113, 47, 102, 108, 118, 46, 106, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 255, 255]); return f.box(f.types.avc1, e, f.box(f.types.avcC, a)) } }, { key: "mvex", value: function (b) { return f.box(f.types.mvex, f.trex(b)) } }, { key: "trex", value: function (b) { b = b.id; b = new Uint8Array([0, 0, 0, 0, b >>> 24 & 255, b >>> 16 & 255, b >>> 8 & 255, b & 255, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1]); return f.box(f.types.trex, b) } }, { key: "moof", value: function (b, a) { return f.box(f.types.moof, f.mfhd(b.sequenceNumber), f.traf(b, a)) } }, { key: "mfhd", value: function (b) { b = new Uint8Array([0, 0, 0, 0, b >>> 24 & 255, b >>> 16 & 255, b >>> 8 & 255, b & 255]); return f.box(f.types.mfhd, b) } }, { key: "traf", value: function (b, a) { var e = b.id, e = f.box(f.types.tfhd, new Uint8Array([0, 0, 0, 0, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, e & 255])); a = f.box(f.types.tfdt, new Uint8Array([0, 0, 0, 0, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, a & 255])); var d = f.sdtp(b); b = f.trun(b, d.byteLength + 16 + 16 + 8 + 16 + 8 + 8); return f.box(f.types.traf, e, a, b, d) } }, { key: "sdtp", value: function (b) { b = b.samples || []; for (var a = b.length, e = new Uint8Array(4 + a), d = 0; d < a; d++) { var g = b[d].flags; e[d + 4] = g.isLeading << 6 | g.dependsOn << 4 | g.isDependedOn << 2 | g.hasRedundancy } return f.box(f.types.sdtp, e) } }, { key: "trun", value: function (b, a) { b = b.samples || []; var e = b.length, d = 12 + 16 * e, g = new Uint8Array(d); a += 8 + d; g.set([0, 0, 15, 1, e >>> 24 & 255, e >>> 16 & 255, e >>> 8 & 255, e & 255, a >>> 24 & 255, a >>> 16 & 255, a >>> 8 & 255, a & 255], 0); for (a = 0; a < e; a++) { var d = b[a].duration, h = b[a].size, l = b[a].flags, n = b[a].cts; g.set([d >>> 24 & 255, d >>> 16 & 255, d >>> 8 & 255, d & 255, h >>> 24 & 255, h >>> 16 & 255, h >>> 8 & 255, h & 255, l.isLeading << 2 | l.dependsOn, l.isDependedOn << 6 | l.hasRedundancy << 4 | l.isNonSync, 0, 0, n >>> 24 & 255, n >>> 16 & 255, n >>> 8 & 255, n & 255], 12 + 16 * a) } return f.box(f.types.trun, g) } }, { key: "mdat", value: function (b) { return f.box(f.types.mdat, b) } }]); return f }(); g.init(); m.default = g }, {}], 38: [function (g, h, m) { function l(a) { return a && a.__esModule ? a : { default: a } } Object.defineProperty(m, "__esModule", { value: !0 }); var f = function () { function a(a, b) { for (var c = 0; c < b.length; c++) { var d = b[c]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(a, d.key, d) } } return function (b, c, d) { c && a(b.prototype, c); d && a(b, d); return b } }(); h = g("../utils/logger.js"); var b = l(h); h = g("./mp4-generator.js"); var a = l(h); h = g("./aac-silent.js"); var e = l(h); h = g("../utils/browser.js"); var d = l(h), p = g("../core/media-segment-info.js"), r = g("../utils/exception.js"); g = function () { function g(a) { if (!(this instanceof g)) throw new TypeError("Cannot call a class as a function"); this.TAG = "MP4Remuxer"; this._config = a; this._isLive = !0 === a.isLive ? !0 : !1; this._dtsBase = -1; this._dtsBaseInited = !1; this._videoDtsBase = this._audioDtsBase = Infinity; this._videoNextDts = this._audioNextDts = void 0; this._videoMeta = this._audioMeta = null; this._audioSegmentInfoList = new p.MediaSegmentInfoList("audio"); this._videoSegmentInfoList = new p.MediaSegmentInfoList("video"); this._onMediaSegment = this._onInitSegment = null; this._forceFirstIDR = d.default.chrome && (50 > d.default.version.major || 50 === d.default.version.major && 2661 > d.default.version.build) ? !0 : !1; this._fillSilentAfterSeek = d.default.msedge || d.default.msie } f(g, [{ key: "destroy", value: function () { this._dtsBase = -1; this._dtsBaseInited = !1; this._videoMeta = this._audioMeta = null; this._audioSegmentInfoList.clear(); this._audioSegmentInfoList = null; this._videoSegmentInfoList.clear(); this._onMediaSegment = this._onInitSegment = this._videoSegmentInfoList = null } }, { key: "bindDataSource", value: function (a) { a.onDataAvailable = this.remux.bind(this); a.onTrackMetadata = this._onTrackMetadataReceived.bind(this); return this } }, { key: "insertDiscontinuity", value: function () { this._audioNextDts = this._videoNextDts = void 0 } }, { key: "seek", value: function (a) { this._videoSegmentInfoList.clear(); this._audioSegmentInfoList.clear() } }, { key: "remux", value: function (a, b) { if (!this._onMediaSegment) throw new r.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!"); this._dtsBaseInited || this._calculateDtsBase(a, b); this._remuxVideo(b); this._remuxAudio(a) } }, { key: "_onTrackMetadataReceived", value: function (b, c) { var d; if ("audio" === b) this._audioMeta = c, d = a.default.generateInitSegment(c); else if ("video" === b) this._videoMeta = c, d = a.default.generateInitSegment(c); else return; if (!this._onInitSegment) throw new r.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!"); this._onInitSegment(b, { type: b, data: d.buffer, codec: c.codec, container: b + "/mp4" }) } }, { key: "_calculateDtsBase", value: function (a, b) { this._dtsBaseInited || (a.samples && a.samples.length && (this._audioDtsBase = a.samples[0].dts), b.samples && b.samples.length && (this._videoDtsBase = b.samples[0].dts), this._dtsBase = Math.min(this._audioDtsBase, this._videoDtsBase), this._dtsBaseInited = !0) } }, { key: "_remuxAudio", value: function (b) { var c = b.samples, d = void 0, e = -1, f; if (!(2 > c.length)) { f = !1; var g = -1; if (c && 0 !== c.length) { var h = 8 + b.length, l = new Uint8Array(h); l[0] = h >>> 24 & 255; l[1] = h >>> 16 & 255; l[2] = h >>> 8 & 255; l[3] = h & 255; l.set(a.default.types.mdat, 4); for (var m = 8, n = []; c.length;) { var r = c.shift(), t = r.unit, y = r.dts - this._dtsBase; if (void 0 == d) if (void 0 == this._audioNextDts) if (this._audioSegmentInfoList.isEmpty()) d = 0, this._fillSilentAfterSeek && !this._videoSegmentInfoList.isEmpty() && (f = !0); else if (d = this._audioSegmentInfoList.getLastSampleBefore(y), null != d) { var x = y - (d.originalDts + d.duration); 3 >= x && (x = 0); d = y - (d.dts + d.duration + x) } else d = 0; else d = y - this._audioNextDts; x = y - d; if (f) { var z = this._videoSegmentInfoList.getLastSegmentBefore(y); null != z && z.beginDts < x ? (g = x - z.beginDts, x = z.beginDts) : f = !1 } -1 === e && (e = x); f ? (f = !1, c.unshift(r), r = this._generateSilentAudio(x, g), null != r && (t = r.unit, n.push(r.mp4Sample), h += t.byteLength, l = new Uint8Array(h), l[0] = h >>> 24 & 255, l[1] = h >>> 16 & 255, l[2] = h >>> 8 & 255, l[3] = h & 255, l.set(a.default.types.mdat, 4), l.set(t, m), m += t.byteLength)) : (n.push({ dts: x, pts: x, cts: 0, size: t.byteLength, duration: 1 <= c.length ? c[0].dts - this._dtsBase - d - x : 1 <= n.length ? n[n.length - 1].duration : this._audioMeta.refSampleDuration, originalDts: y, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0 } }), l.set(t, m), m += t.byteLength) } g = n[n.length - 1]; this._audioNextDts = f = g.dts + g.duration; c = new p.MediaSegmentInfo; c.beginDts = e; c.endDts = f; c.beginPts = e; c.endPts = f; c.originalBeginDts = n[0].originalDts; c.originalEndDts = g.originalDts + g.duration; c.firstSample = new p.SampleInfo(n[0].dts, n[0].pts, n[0].duration, n[0].originalDts, !1); c.lastSample = new p.SampleInfo(g.dts, g.pts, g.duration, g.originalDts, !1); this._isLive || this._audioSegmentInfoList.append(c); b.samples = n; b.sequenceNumber++; e = a.default.moof(b, e); b.samples = []; b.length = 0; this._onMediaSegment("audio", { type: "audio", data: this._mergeBoxes(e, l).buffer, sampleCount: n.length, info: c }) } } } }, { key: "_generateSilentAudio", value: function (a, c) { b.default.v(this.TAG, "GenerateSilentAudio: dts = " + a + ", duration = " + c); var d = e.default.getSilentFrame(this._audioMeta.channelCount); return null == d ? (b.default.w(this.TAG, "Cannot generate silent aac frame for channelCount = " + this._audioMeta.channelCount), null) : { unit: d, mp4Sample: { dts: a, pts: a, cts: 0, size: d.byteLength, duration: c, originalDts: a, flags: { isLeading: 0, dependsOn: 1, isDependedOn: 0, hasRedundancy: 0 } } } } }, { key: "_remuxVideo", value: function (b) { var c = b.samples, d = void 0, e = -1, f = -1, g; if (c && 0 !== c.length && !(2 > c.length)) { var h = 8 + b.length, l = new Uint8Array(h); l[0] = h >>> 24 & 255; l[1] = h >>> 16 & 255; l[2] = h >>> 8 & 255; l[3] = h & 255; l.set(a.default.types.mdat, 4); g = 8; for (var h = [], m = new p.MediaSegmentInfo; 1 < c.length;) { var n = c.shift(), r = n.isKeyframe, t = n.dts - this._dtsBase; if (void 0 == d) if (void 0 == this._videoNextDts) if (this._videoSegmentInfoList.isEmpty()) d = 0; else if (d = this._videoSegmentInfoList.getLastSampleBefore(t), null != d) { var y = t - (d.originalDts + d.duration); 3 >= y && (y = 0); d = t - (d.dts + d.duration + y) } else d = 0; else d = t - this._videoNextDts; var y = t - d, x = n.cts, z = y + x; -1 === e && (e = y, f = z); for (var G = 0; n.units.length;) { var E = n.units.shift().data; l.set(E, g); g += E.byteLength; G += E.byteLength } E = 1 <= c.length ? c[0].dts - this._dtsBase - d - y : 1 <= h.length ? h[h.length - 1].duration : this._videoMeta.refSampleDuration; if (r) { var M = new p.SampleInfo(y, z, E, n.dts, !0); M.fileposition = n.fileposition; m.appendSyncPoint(M) } h.push({ dts: y, pts: z, cts: x, size: G, isKeyframe: r, duration: E, originalDts: t, flags: { isLeading: 0, dependsOn: r ? 2 : 1, isDependedOn: r ? 1 : 0, hasRedundancy: 0, isNonSync: r ? 0 : 1 } }) } n = h[h.length - 1]; c = n.dts + n.duration; g = n.pts + n.duration; this._videoNextDts = c; m.beginDts = e; m.endDts = c; m.beginPts = f; m.endPts = g; m.originalBeginDts = h[0].originalDts; m.originalEndDts = n.originalDts + n.duration; m.firstSample = new p.SampleInfo(h[0].dts, h[0].pts, h[0].duration, h[0].originalDts, h[0].isKeyframe); m.lastSample = new p.SampleInfo(n.dts, n.pts, n.duration, n.originalDts, n.isKeyframe); this._isLive || this._videoSegmentInfoList.append(m); f = b.samples[0]; b.samples = h; b.sequenceNumber++; this._forceFirstIDR && (c = h[0].flags, c.dependsOn = 2, c.isNonSync = 0); e = a.default.moof(b, e); b.samples = []; b.length = 0; b.samples.push(f); b.length = f.length; this._onMediaSegment("video", { type: "video", data: this._mergeBoxes(e, l).buffer, sampleCount: h.length, info: m }) } } }, { key: "_mergeBoxes", value: function (a, b) { var d = new Uint8Array(a.byteLength + b.byteLength); d.set(a, 0); d.set(b, a.byteLength); return d } }, { key: "onInitSegment", get: function () { return this._onInitSegment }, set: function (a) { this._onInitSegment = a } }, { key: "onMediaSegment", get: function () { return this._onMediaSegment }, set: function (a) { this._onMediaSegment = a } }]); return g }(); m.default = g }, { "../core/media-segment-info.js": 8, "../utils/browser.js": 39, "../utils/exception.js": 40, "../utils/logger.js": 41, "./aac-silent.js": 36, "./mp4-generator.js": 37 }], 39: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); g = {}; h = self.navigator.userAgent.toLowerCase(); var l = /(edge)\/([\w.]+)/.exec(h) || /(opr)[\/]([\w.]+)/.exec(h) || /(chrome)[ \/]([\w.]+)/.exec(h) || /(iemobile)[\/]([\w.]+)/.exec(h) || /(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(h) || /(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(h) || /(webkit)[ \/]([\w.]+)/.exec(h) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(h) || /(msie) ([\w.]+)/.exec(h) || 0 <= h.indexOf("trident") && /(rv)(?::| )([\w.]+)/.exec(h) || 0 > h.indexOf("compatible") && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(h) || [], f = /(ipad)/.exec(h) || /(ipod)/.exec(h) || /(windows phone)/.exec(h) || /(iphone)/.exec(h) || /(kindle)/.exec(h) || /(android)/.exec(h) || /(windows)/.exec(h) || /(mac)/.exec(h) || /(linux)/.exec(h) || /(cros)/.exec(h) || []; h = l[5] || l[3] || l[1] || ""; var b = l[2] || l[4] || "0", l = l[4] || l[2] || "0", f = f[0] || "", a = {}; if (h) { a[h] = !0; var e = l.split("."); a.version = { major: parseInt(l, 10), string: b }; 1 < e.length && (a.version.minor = parseInt(e[1], 10)); 2 < e.length && (a.version.build = parseInt(e[2], 10)) } f && (a[f] = !0); if (a.chrome || a.opr || a.safari) a.webkit = !0; if (a.rv || a.iemobile) a.rv && delete a.rv, h = "msie", a.msie = !0; a.edge && (delete a.edge, h = "msedge", a.msedge = !0); a.opr && (h = "opera", a.opera = !0); a.safari && a.android && (h = "android", a.android = !0); a.name = h; a.platform = f; for (var d in g) g.hasOwnProperty(d) && delete g[d]; Object.assign(g, a); m.default = g }, {}], 40: [function (g, h, m) { function l(a, b) { if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return !b || "object" !== typeof b && "function" !== typeof b ? a : b } function f(a, b) { if ("function" !== typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b); a.prototype = Object.create(b && b.prototype, { constructor: { value: a, enumerable: !1, writable: !0, configurable: !0 } }); b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b) } function b(a, b) { if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function"); } Object.defineProperty(m, "__esModule", { value: !0 }); var a = function () { function a(a, b) { for (var d = 0; d < b.length; d++) { var e = b[d]; e.enumerable = e.enumerable || !1; e.configurable = !0; "value" in e && (e.writable = !0); Object.defineProperty(a, e.key, e) } } return function (b, e, f) { e && a(b.prototype, e); f && a(b, f); return b } }(); g = m.RuntimeException = function () { function e(a) { b(this, e); this._message = a } a(e, [{ key: "toString", value: function () { return this.name + ": " + this.message } }, { key: "name", get: function () { return "RuntimeException" } }, { key: "message", get: function () { return this._message } }]); return e }(); m.IllegalStateException = function (e) { function d(a) { b(this, d); return l(this, (d.__proto__ || Object.getPrototypeOf(d)).call(this, a)) } f(d, e); a(d, [{ key: "name", get: function () { return "IllegalStateException" } }]); return d }(g); m.InvalidArgumentException = function (e) { function d(a) { b(this, d); return l(this, (d.__proto__ || Object.getPrototypeOf(d)).call(this, a)) } f(d, e); a(d, [{ key: "name", get: function () { return "InvalidArgumentException" } }]); return d }(g); m.NotImplementedException = function (e) { function d(a) { b(this, d); return l(this, (d.__proto__ || Object.getPrototypeOf(d)).call(this, a)) } f(d, e); a(d, [{ key: "name", get: function () { return "NotImplementedException" } }]); return d }(g) }, {}], 41: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); g = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); } l(f, null, [{ key: "e", value: function (b, a) { if (f.ENABLE_ERROR) { if (!b || f.FORCE_GLOBAL_TAG) b = f.GLOBAL_TAG; b = "[" + b + "] > " + a; console.error ? console.error(b) : console.warn ? console.warn(b) : console.log(b) } } }, { key: "i", value: function (b, a) { if (f.ENABLE_INFO) { if (!b || f.FORCE_GLOBAL_TAG) b = f.GLOBAL_TAG; b = "[" + b + "] > " + a; console.info ? console.info(b) : console.log(b) } } }, { key: "w", value: function (b, a) { if (f.ENABLE_WARN) { if (!b || f.FORCE_GLOBAL_TAG) b = f.GLOBAL_TAG; b = "[" + b + "] > " + a; console.warn ? console.warn(b) : console.log(b) } } }, { key: "d", value: function (b, a) { if (f.ENABLE_DEBUG) { if (!b || f.FORCE_GLOBAL_TAG) b = f.GLOBAL_TAG; b = "[" + b + "] > " + a; console.debug ? console.debug(b) : console.log(b) } } }, { key: "v", value: function (b, a) { if (f.ENABLE_VERBOSE) { if (!b || f.FORCE_GLOBAL_TAG) b = f.GLOBAL_TAG; console.log("[" + b + "] > " + a) } } }]); return f }(); g.GLOBAL_TAG = "flv.js"; g.FORCE_GLOBAL_TAG = !1; g.ENABLE_ERROR = !0; g.ENABLE_INFO = !0; g.ENABLE_WARN = !0; g.ENABLE_DEBUG = !0; g.ENABLE_VERBOSE = !0; m.default = g }, {}], 42: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function b(a, b) { for (var d = 0; d < b.length; d++) { var e = b[d]; e.enumerable = e.enumerable || !1; e.configurable = !0; "value" in e && (e.writable = !0); Object.defineProperty(a, e.key, e) } } return function (a, e, d) { e && b(a.prototype, e); d && b(a, d); return a } }(); h = (h = g("events")) && h.__esModule ? h : { default: h }; var f = (g = g("./logger.js")) && g.__esModule ? g : { default: g }; g = function () { function b() { if (!(this instanceof b)) throw new TypeError("Cannot call a class as a function"); } l(b, null, [{ key: "getConfig", value: function () { return { globalTag: f.default.GLOBAL_TAG, forceGlobalTag: f.default.FORCE_GLOBAL_TAG, enableVerbose: f.default.ENABLE_VERBOSE, enableDebug: f.default.ENABLE_DEBUG, enableInfo: f.default.ENABLE_INFO, enableWarn: f.default.ENABLE_WARN, enableError: f.default.ENABLE_ERROR } } }, { key: "applyConfig", value: function (a) { f.default.GLOBAL_TAG = a.globalTag; f.default.FORCE_GLOBAL_TAG = a.forceGlobalTag; f.default.ENABLE_VERBOSE = a.enableVerbose; f.default.ENABLE_DEBUG = a.enableDebug; f.default.ENABLE_INFO = a.enableInfo; f.default.ENABLE_WARN = a.enableWarn; f.default.ENABLE_ERROR = a.enableError } }, { key: "_notifyChange", value: function () { var a = b.emitter; if (0 < a.listenerCount("change")) { var e = b.getConfig(); a.emit("change", e) } } }, { key: "registerListener", value: function (a) { b.emitter.addListener("change", a) } }, { key: "removeListener", value: function (a) { b.emitter.removeListener("change", a) } }, { key: "forceGlobalTag", get: function () { return f.default.FORCE_GLOBAL_TAG }, set: function (a) { f.default.FORCE_GLOBAL_TAG = a; b._notifyChange() } }, { key: "globalTag", get: function () { return f.default.GLOBAL_TAG }, set: function (a) { f.default.GLOBAL_TAG = a; b._notifyChange() } }, { key: "enableAll", get: function () { return f.default.ENABLE_VERBOSE && f.default.ENABLE_DEBUG && f.default.ENABLE_INFO && f.default.ENABLE_WARN && f.default.ENABLE_ERROR }, set: function (a) { f.default.ENABLE_VERBOSE = a; f.default.ENABLE_DEBUG = a; f.default.ENABLE_INFO = a; f.default.ENABLE_WARN = a; f.default.ENABLE_ERROR = a; b._notifyChange() } }, { key: "enableDebug", get: function () { return f.default.ENABLE_DEBUG }, set: function (a) { f.default.ENABLE_DEBUG = a; b._notifyChange() } }, { key: "enableVerbose", get: function () { return f.default.ENABLE_VERBOSE }, set: function (a) { f.default.ENABLE_VERBOSE = a; b._notifyChange() } }, { key: "enableInfo", get: function () { return f.default.ENABLE_INFO }, set: function (a) { f.default.ENABLE_INFO = a; b._notifyChange() } }, { key: "enableWarn", get: function () { return f.default.ENABLE_WARN }, set: function (a) { f.default.ENABLE_WARN = a; b._notifyChange() } }, { key: "enableError", get: function () { return f.default.ENABLE_ERROR }, set: function (a) { f.default.ENABLE_ERROR = a; b._notifyChange() } }]); return b }(); g.emitter = new h.default; m.default = g }, { "./logger.js": 41, events: 2 }], 43: [function (g, h, m) { Object.defineProperty(m, "__esModule", { value: !0 }); var l = function () { function f(b, a) { for (var e = 0; e < a.length; e++) { var d = a[e]; d.enumerable = d.enumerable || !1; d.configurable = !0; "value" in d && (d.writable = !0); Object.defineProperty(b, d.key, d) } } return function (b, a, e) { a && f(b.prototype, a); e && f(b, e); return b } }(); h = function () { function f() { if (!(this instanceof f)) throw new TypeError("Cannot call a class as a function"); } l(f, null, [{ key: "install", value: function () { Object.setPrototypeOf = Object.setPrototypeOf || function (b, a) { b.__proto__ = a; return b }; Object.assign = Object.assign || function (b) { if (void 0 === b || null === b) throw new TypeError("Cannot convert undefined or null to object"); for (var a = Object(b), e = 1; e < arguments.length; e++) { var d = arguments[e]; if (void 0 !== d && null !== d) for (var f in d) d.hasOwnProperty(f) && (a[f] = d[f]) } return a }; "function" !== typeof self.Promise && g("es6-promise").polyfill() } }]); return f }(); h.install(); m.default = h }, { "es6-promise": 1 }], 44: [function (g, h, m) { function l(f, b, a) { if (b + a < f.length) { for (; a--;) if (128 !== (f[++b] & 192)) return !1; return !0 } return !1 } Object.defineProperty(m, "__esModule", { value: !0 }); m.default = function (f) { for (var b = [], a = 0, e = f.length; a < e;) { if (128 > f[a]) b.push(String.fromCharCode(f[a])); else { if (!(192 > f[a])) if (224 > f[a]) { if (l(f, a, 1)) { var d = (f[a] & 31) << 6 | f[a + 1] & 63; if (128 <= d) { b.push(String.fromCharCode(d & 65535)); a += 2; continue } } } else if (240 > f[a]) { if (l(f, a, 2) && (d = (f[a] & 15) << 12 | (f[a + 1] & 63) << 6 | f[a + 2] & 63, 2048 <= d && 55296 !== (d & 63488))) { b.push(String.fromCharCode(d & 65535)); a += 3; continue } } else if (248 > f[a] && l(f, a, 3) && (d = (f[a] & 7) << 18 | (f[a + 1] & 63) << 12 | (f[a + 2] & 63) << 6 | f[a + 3] & 63, 65536 < d && 1114112 > d)) { d -= 65536; b.push(String.fromCharCode(d >>> 10 | 55296)); b.push(String.fromCharCode(d & 1023 | 56320)); a += 4; continue } b.push(String.fromCharCode(65533)) } ++a } return b.join("") } }, {}] }, {}, [21])(21) }); function liveplay(v, g, h) { flvjs.isSupported() || console.log("flv dont supported"); var m = flvjs.createPlayer({ type: "flv", isLive: !0, url: g }, { enableStashBuffer: !0 }); m.attachMediaElement(v); m.load(); m.play(); v.flvPlayer = m; h && (v.fivPlayerTimer = setTimeout(function () { liveplaystop(v); liveplay(v, g) }, h)); m.on(flvjs.Events.ERROR, function (h, f) { console.log("type:" + h + " details:" + f); switch (h) { case "NetworkError": m.pause(); m.unload(); setTimeout(function () { liveplaystop(v); liveplay(v, g) }, 1E3); break; case "MediaError": m.pause(), m.unload(), setTimeout(function () { liveplaystop(v); liveplay(v, g) }, 1E3) } }); return m } function liveplaystop(v) { v.flvPlayer && (v.flvPlayer.destroy(), v.flvPlayer = null); v.fivPlayerTimer && clearTimeout(v.fivPlayerTimer) } function captureimage(v, g) { var h = document.createElement("canvas"), m = h.getContext("2d"); h.width = v.videoWidth; h.height = v.videoHeight; m.drawImage(v, 0, 0, h.width, h.height); h = h.toDataURL(); v = document.createElementNS("http://www.w3.org/1999/xhtml", "a"); v.href = h; v.download = g; g = document.createEvent("MouseEvents"); g.initMouseEvent("click", !0, !1, window, 0, 0, 0, 0, 0, !1, !1, !1, !1, 0, null); v.dispatchEvent(g) } function showsub(v, g) { var h = v.textTracks[0]; h || (h = v.addTextTrack("subtitles", "sample"), h.mode = "showing", window.VTTCue = window.VTTCue || window.TextTrackCue); (v = h.cues[0]) && h.removeCue(v); v = new VTTCue(0, 99999, g); v.line = 0; v.align = "start"; h.addCue(v) };