!function(a){var e={init:function(e){var t=this,o=a(e),l=o.data("combobox").options;o.combo(l);var n=o.data("combo").panel.addClass("list-group").css({overflow:"auto"});o.data("combobox").panel=n,l.url?t.remoteData(o,l,n):l.data&&t.loadData(o,l,n),t.initEvent(o,l,n)},loadData:function(a,e,t,o){for(var l=e.data,n=[],i=a.val(),u=0;u<l.length;u++)(!o||o(i,l[u]))&&n.push("<a href='javascript:;' class='list-group-item' data-value='"+l[u][e.valueField]+"'>"+l[u][e.textField]+"</a>");t.html(n.join("")),e.onLoadSuccess&&e.onLoadSuccess()},remoteData:function(e,t,o){var l=this;a.ajax({url:t.url,type:t.method,dataType:"json",data:t.formData,success:function(a){t.loadFilter&&(a=t.loadFilter(a)),t.data=a,l.loadData(e,t,o)}})},initEvent:function(e,t,o){var l=this;o.delegate(".list-group-item","click",function(){var n=a(this),i=n.attr("data-value");t.multiple?(n.hasClass("active")?(n.removeClass("active"),l.setValue(e,t,i,!1),t.onUnselect&&t.onUnselect(l.getItemByValue(t.data,i,t.valueField))):(n.addClass("active"),l.setValue(e,t,i,!0),t.onSelect&&t.onSelect(l.getItemByValue(t.data,i,t.valueField))),l.setInputValue(e,t.values,t.textField)):(n.hasClass("active")||(o.find(".active").removeClass("active"),n.addClass("active"),l.setValue(e,t,i),t.onSelect&&t.onSelect(l.getItemByValue(t.data,i,t.valueField))),o.hide())}),"local"==t.mode&&t.filter?e.on("keyup",function(){t.value=null,e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){l.loadData(e,t,o,t.filter)},200)}):"remote"==t.mode&&t.loader&&e.on("keyup",function(){t.values={},e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){t.loader({q:e.val()},function(a){t.data=a,l.loadData(e,t,o)},function(){console.log&&console.log("loader: load err.")})},200)})},setValue:function(a,e,t,o){var l=this,n=(e.data,e.values),i=l.getItemByValue(e.data,t,e.valueField);void 0==o?(e.value=t,a.val(i?i[e.textField]:"")):1==o?n[t]=i?i[e.textField]:"":delete n[t]},getItemByValue:function(a,e,t){for(var o=0;o<a.length;o++)if(a[o][t]==e)return a[o];return null},setInputValue:function(a,e){var t=[];for(var o in e)t.push(e[o]);a.val(t.join(","))},setValues:function(e,t){var o=a(e),l=o.data("combobox").options,n=this;l.values={};for(var i=0;i<t.length;i++){var u=n.getItemByValue(l.data,t[i],l.valueField);l.values[t[i]]=u?u[l.textField]:""}n.setInputValue(o,l.values,l.textField)}};a.fn.combobox=function(t,o){return"string"==typeof t?a.fn.combobox.methods[t](this,o):void a.each(this,function(){var o={};a.extend(o,a.fn.combo.defaults),a.extend(o,a.fn.combobox.defaults),a.extend(o,t),a(this).data("combobox",{options:o}),e.init(this)})},a.fn.combobox.defaults={url:null,method:"get",valueField:"id",textField:"text",multiple:!1,panelHeight:250,value:null,values:{},mode:"local",filter:null,formData:{},onSelect:null,onLoadSucces:null},a.fn.combobox.methods={getValue:function(e){return a(e).data("combobox").options.value},getValues:function(e){var t=a(e).data("combobox").options.values,o=[];for(var l in t)o.push(l);return o},setValue:function(t,o){var l=a(t),n=l.data("combobox").options;e.setValue(l,n,o),l.data("combobox").panel.find(".active").removeClass("active"),l.data("combobox").panel.find('[data-value="'+o+'"]').addClass("active")},setValues:function(t,o){var l=a(t);e.setValues(t,o),l.data("combobox").panel.find(".active").removeClass("active");for(var n in o)l.data("combobox").panel.find('[data-value="'+o[n]+'"]').addClass("active")},reload:function(t,o){var l=a(t);o&&(l.data("combobox").options.url=o),e.remoteData(l,l.data("combobox").options,l.data("combo").panel)}}}(jQuery);