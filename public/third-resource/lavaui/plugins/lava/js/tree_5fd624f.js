!function(e,t){var a={treeId:1,isIE:void 0,init:function(e){var t=this;t.bindEvent(e),t.checkIsIE()},checkIsIE:function(){var e=this;e.isIE=/msie|edge|trident/.test(t.navigator.userAgent.toLowerCase())?!0:!1},loadLocalData:function(t){var a=this,n=e(t),r=n.data("tree").options;r.data.length>0?(r.loadFilter&&(r.data=r.loadFilter(r.data)),a.loadData(t,r.data)):console.error("本地数据为空")},loadData:function(t,n){var r=e(t),o=r.data("tree").options;r.addClass("lavaui-tree"),r.html(""),a.initData(n,o.htmlArray,0,void 0,o),a.initDom(t,t,o.htmlArray)},remoteData:function(a){var n=this,r=e(a),o=r.data("tree").options,l=r.data("tree").options.url;e.ajax({url:l,type:o.method,dataType:"json",data:o.queryParams}).done(function(e){e?(o.data=e,o.loadFilter&&(o.data=o.loadFilter(o.data)),n.loadData(a,o.data),t.setTimeout(function(){if(o.onLoadSuccess){var e=o.data;o.onLoadSuccess(e)}},200)):console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空")}).fail(function(){o.onLoadError&&o.onLoadError(),console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败")})},initData:function(e,t,a,n,r){for(var o=this,l=0;l<e.length;l++){e[l].treeId="lava_tree_"+o.treeId++,e[l].level=a?a:0,e[l].parentTreeId=n?n:void 0;var s=r.checkbox,d=r.async;if(s){var c="<li id='"+e[l].treeId+"' {0}>{1}<span class='tree-chkbx {2}'></span><a href='javascript:;'><span class='{3}'></span><span>"+e[l].text+"</span></a>{4}</li>",i="";if(d?e[l].closed?(c=c.replace("{0}","class='closed'"),c=c.replace("{1}","<span class='button-open'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):e[l].children&&e[l].children.length>0?(c=c.replace("{0}",""),c=c.replace("{1}","<span class='button-cloed'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}",""),i="icon-file",c=c.replace("{4}","")):e[l].children&&e[l].children.length>0?e[l].closed?(c=c.replace("{0}","class='closed'"),c=c.replace("{1}","<span class='button-open'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}","<span class='button-close'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}",""),i="icon-file",c=c.replace("{4}","")),c=e[l].iconCls?c.replace("{3}","icon "+e[l].iconCls):c.replace("{3}","node-icon "+i),e[l].checked)e[l].checked=2,c=c.replace("{2}","tree-chk");else if(e[l].children&&e[l].children.length>0){for(var h=[],p=0;p<e[l].children.length;p++)h.push(e[l].children[p].checked?!0:!1);/\/false/.test("/"+h.join("/"))?/\/true/.test("/"+h.join("/"))?(e[l].checked=1,c=c.replace("{2}","tree-halfchk")):(e[l].checked=0,c=c.replace("{2}","tree-nochk")):(e[l].checked=2,c=c.replace("{2}","tree-chk"))}else e[l].checked=0,c=c.replace("{2}","tree-nochk")}else{var i="";if(d)if(e[l].closed){i="icon-folder";var c="<li id='"+e[l].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a><ul></ul></li>"}else if(e[l].children&&e[l].children.length>0){i="icon-folder";var c="<li id='"+e[l].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a><ul></ul></li>"}else{i="icon-file";var c="<li id='"+e[l].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a></li>"}else if(e[l].children&&e[l].children.length>0)if(e[l].closed){i="icon-folder";var c="<li id='"+e[l].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a><ul></ul></li>"}else{i="icon-folder";var c="<li id='"+e[l].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a><ul></ul></li>"}else{i="icon-file";var c="<li id='"+e[l].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+e[l].text+"</span></a></li>"}c=e[l].iconCls?c.replace("{0}","icon "+e[l].iconCls):c.replace("{0}","node-icon "+i)}t.push({html:c,parentTreeId:n});var f=a+1;e[l].children&&o.initData(e[l].children,t,f,e[l].treeId,r)}},initDom:function(t,a,n){var r=this,o=e(t).data("tree").options.closedChildren;if(0!=n.length){var l=e(a),s=e(t);s.data("tree").options,n[0].parentTreeId&&(l=e("#"+n[0].parentTreeId).children("ul"));var d=n[0].parentTreeId,c=100;r.isIE&&(c=1e4),c=n.length>c?c:n.length;var i=n.splice(0,c),h=[],p=[];if(t==a)var f=!0;else var f=!l.parent("li").hasClass("closed");for(var u=!1,v=((new Date).getTime(),0);v<i.length;v++)d==i[v].parentTreeId?f?h.push(i[v].html):p.push(i[v]):(f?(l[0].childNodes.length>0?l.append(h.join("")):l[0].innerHTML=h.join(""),u=!0):o[d]=o[d]?o[d].concat(p):p,d=i[v].parentTreeId,l=d?e("#"+d).children("ul"):e(t),f=!l.parent("li").hasClass("closed"),f?(h=[i[v].html],p=[]):(h=[],p=[i[v]]));h.length>0&&(l[0].childNodes.length>0?l.append(h.join("")):l[0].innerHTML=h.join(""),u=!0),p.length>0&&(o[d]=o[d]?o[d].concat(p):p);var k=u?5:0;r.isIE&&u&&(k=3e3),n.length>0&&(k?setTimeout(function(){r.initDom(t,l,n)},k):r.initDom(t,l,n))}},bindEvent:function(t){var a=this,n=e(t),r=n.data("tree").options;n.delegate(".button-open, .button-close, a, .tree-chkbx","click",function(){var n=e(this);if(n.hasClass("button-open")){a.expandNodes(n.parent(),t,r);var o=n.parent().prop("id"),l=a.findNode(r.data,o);r.onExpand&&r.onExpand(l)}else if(n.hasClass("button-close")){a.collapseNodes(n);var o=n.parent().prop("id"),l=a.findNode(r.data,o);r.onCollapse&&r.onCollapse(l)}else if("A"==n[0].tagName)a.selectNode(t,n);else if(n.hasClass("tree-chkbx")){a.checkNodes(t,n);var l=a.findNode(r.data,n.parent().prop("id"));r.onCheck&&r.onCheck(l)}})},expandNodes:function(t,n,r){var o=this,l=e(n),r=l.data("tree").options,s=t,d=s.attr("id"),c=o.findNode(r.data,d),i=c.level,h=c.id;s.hasClass("closed")&&s.removeClass("closed"),s.children(".button-open")[0].setAttribute("class","button-close"),s.children("a").children(".node-icon").removeClass("icon-folder node-icon").addClass("icon-loading"),s.children("ul")||s.append("<ul></ul>");var p=s.children("ul"),f=null;if(r.async)if(r.closedChildren[d]&&r.closedChildren[d].length>0)f=r.closedChildren[d],s.hasClass("closed")&&s.removeClass("closed"),f&&(o.initDom(n,p,f),s.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open"));else{if(c.children&&c.children.length>0)return void s.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open");e.ajax({url:r.url,type:r.method,dataType:"json",data:{id:h},success:function(e){if(e.length>0){var t=i+1;o.initData(e,r.htmlArray,t,d,r),o.findNode(r.data,d,function(t){t.children=e}),a.initDom(n,p,r.htmlArray)}else console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空");s.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")},error:function(){console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败"),s.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}})}else{if(f=r.closedChildren[d]){if(r.cascadeCheck)if(0===c.checked){var u=JSON.stringify(f);u.replace(/(tree\-chk)|(tree\-halfchk)/g,function(){return"tree-nochk"}),f=JSON.parse(u)}else if(2===c.checked){var u=JSON.stringify(f);u=u.replace(/(tree\-nochk)|(tree\-halfchk)/g,function(){return"tree-chk"}),f=JSON.parse(u)}o.initDom(n,p,f)}s.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}},collapseNodes:function(e){var t=e;t[0].setAttribute("class","button-open"),t.siblings("a").children(".node-icon").removeClass("icon-folder_open").addClass("icon-folder"),t.parent("li").addClass("closed")},selectNode:function(t,a,n){var r=this,o=a,l=e(t),s=l.data("tree").options;s.selectedNodes||(s.selectedNodes=[]);var d=s.selectedNodes,c=o.parent().prop("id"),i=r.findNode(s.data,c);if(void 0===n||null===n)if(o.hasClass("selectNode")&&s.multiSelect){if(o.removeClass("selectNode"),d.length>0){for(var h=0,p=0;p<d.length;p++)if(c===d[p].treeId){h=p;break}d.splice(h,1)}}else{if(!o.hasClass("selectNode")){if(s.multiSelect||(l.find(".selectNode").eq(0).removeClass("selectNode"),d=[]),o.addClass("selectNode"),d.length>=0)for(var h=null,p=0;p<d.length;p++)if(c===d[p].treeId){h=p;break}null===h&&d.push(i)}s.onSelect&&s.onSelect(i)}else if(n===!1){if(o.hasClass("selectNode")&&o.removeClass("selectNode"),d.length>0){for(var h=0,p=0;p<d.length;p++)if(c===d[p].treeId){h=p;break}d.splice(h,1)}}else if(n===!0){if(s.multiSelect||(l.find(".selectNode").eq(0).removeClass("selectNode"),d=[]),o.hasClass("selectNode")||(o.addClass("selectNode"),s.onSelect&&s.onSelect(i)),d.length>=0)for(var h=null,p=0;p<d.length;p++)if(c===d[p].treeId){h=p;break}null===h&&d.push(i)}s.selectedNodes=d},checkNodes:function(t,a){var n=this,r=a,o=e(t).data("tree").options,l=(o.data,r.hasClass("tree-chk")),s=r.hasClass("tree-nochk"),d=r.hasClass("tree-halfchk");l?n.setCheckStatus(t,r,0):s?n.setCheckStatus(t,r,2):d&&n.setCheckStatus(t,r,2)},setCheckStatus:function(t,a,n){var r=this,o=e(t),l=o.data("tree").options,s=l.data,d=a,c=d.parent(),i=c.children("ul").find(".tree-chkbx"),h=c.prop("id"),p=r.findNode(s,h),f=!1,u=null;p.children&&p.children.length>0&&(f=!0),p.parentTreeId&&p.parentTreeId.length>0&&(u=p.parentTreeId);var v="";if(0===n?v="tree-nochk":1===n?v="tree-halfchk":2===n&&(v="tree-chk"),d[0].setAttribute("class","tree-chkbx "+v),r.updateCheckStatusData(s,h,n),l.cascadeCheck){if(f&&(0===n||2===n)){for(var k=0,N=i.length;N>k;k++)i[k].setAttribute("class","tree-chkbx "+v);r.updateChildCheckStatusData(s,h,n)}u&&r.cascadeCheck(s,u)}},cascadeCheck:function(t,a){var n=this,r=e("#"+a).children(".tree-chkbx"),o=n.findNode(t,a),l=o.children,s=o.parentTreeId,d=null,c=/"checked":2/.test(JSON.stringify(l)),i=/"checked":1/.test(JSON.stringify(l)),h=/"checked":0/.test(JSON.stringify(l));c?i?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),d=1):h?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),d=1):(r[0].setAttribute("class","tree-chkbx tree-chk"),d=2):i?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),d=1):(r[0].setAttribute("class","tree-chkbx tree-nochk"),d=0),n.updateCheckStatusData(t,a,d),void 0!==s&&n.cascadeCheck(t,s)},findNode:function(e,t,a){for(var n=this,r=0;r<e.length;r++){if(e[r].treeId==t)return a?a(e[r]):e[r];if(e[r].children&&e[r].children.length>0&&n.findNode(e[r].children,t))return a?a(n.findNode(e[r].children,t)):n.findNode(e[r].children,t)}},findNodeById:function(t,a,n){for(var r=this,o=e(t).data("tree").options.nodesById,l=0;l<a.length;l++)a[l].id==n&&o.push(a[l]),a[l].children&&a[l].children.length>0&&r.findNodeById(t,a[l].children,n)},findNodeByFilter:function(t,a,n){for(var r=this,o=e(t).data("tree").options,l=0;l<a.length;l++)n(a[l])&&o.nodesFilter.push(a[l]),a[l].children&&a[l].children.length>0&&r.findNodeByFilter(t,a[l].children,n)},removeNodeById:function(e,t,a){for(var n=this,r=0;r<t.length;r++){if(t[r].treeId==a){t.splice(r,1);break}t[r].children&&t[r].children.length>0&&n.removeNodeById(e,t[r].children,a)}},tranverseNode:function(t,a){for(var n=this,r=e(t).data("tree").options,o=0;o<a.length;o++)0==a[o].checked?r.uncheckedNodes.push(a[o]):1==a[o].checked?r.indeterminateNodes.push(a[o]):2==a[o].checked&&r.checkedNodes.push(a[o]),a[o].children&&a[o].children.length>0&&n.tranverseNode(t,a[o].children)},updateChildCheckStatusData:function(e,t,a){var n=this;n.findNode(e,t,function(e){if(e&&e.children&&e.children.length>0){var t=JSON.stringify(e.children);t=t.replace(/"checked":[0|1|2]/g,function(){return'"checked":'+a}),e.children=JSON.parse(t)}})},updateCheckStatusData:function(e,t,a){var n=this;n.findNode(e,t,function(e){e&&(e.checked=a)})}};e.fn.tree=function(t,n){return"string"==typeof t?e.fn.tree.methods[t](this,n):void e.each(this,function(){var n={};e.extend(n,e.fn.tree.defaults),e.extend(n,t);var r=e(this).data("tree"),o={htmlArray:[],closedChildren:{}};e.extend(n,o),e(this).data("tree",{options:n}),r||a.init(this),e(this).data("tree").options.url?a.remoteData(this):"data"in e(this).data("tree").options&&e(this).data("tree").options.data.length>0&&a.loadLocalData(this)})},e.fn.tree.defaults={url:"",method:"GET",data:[],checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,async:!1,onSelect:null,multiSelect:!1,onCheck:null,onExpand:null,onCollapse:null,onLoadSuccess:null,onLoadError:null,queryParams:{},loadFilter:null},e.fn.tree.methods={find:function(t,n){e(t).data("tree").options.nodesById=[];var r=e(t).data("tree").options.data;return a.findNodeById(t,r,n),e(t).data("tree").options.nodesById},check:function(t,n){var r=e("#"+n).children(".tree-chkbx"),o=e(t).data("tree").options;if(a.setCheckStatus(t,r,2),o.onCheck){var l=a.findNode(o.data,n);o.onCheck(l)}},uncheck:function(t,n){var r=e("#"+n).children(".tree-chkbx");a.setCheckStatus(t,r,0)},select:function(t,n){var r=e("#"+n).children("a");a.selectNode(t,r,!0)},unSelect:function(t,n){var r=e("#"+n).children("a");a.selectNode(t,r,!1)},getChecked:function(t,n){var r=e(t),o=r.data("tree").options,l=o.data;o.checkedNodes=[],o.indeterminateNodes=[],o.uncheckedNodes=[],a.tranverseNode(t,l);var s={};if("object"==typeof n)for(var d=0;d<n.length;d++){var c=n[d];s[c]=o[c+"Nodes"]}else"string"==typeof n?s[n]=o[n+"Nodes"]:n||(s.checked=o.checkedNodes);return s},getSelected:function(t){var a=e(t).data("tree").options;return a.selectedNodes||(a.selectedNodes=[]),a.selectedNodes},getChildren:function(t,n){var r=e(t),o=r.data("tree").options.data,l=a.findNode(o,n);return l.children?l.children:[]},getParent:function(t,n){var r=e(t),o=r.data("tree").options.data,l=a.findNode(o,n);if(l.parentTreeId){var s=a.findNode(o,l.parentTreeId);if(s)return s}return{}},reload:function(t,n){var r=e(t).data("tree").options;r.queryParams=n?n:{},r.selectedNodes=[],r.checkedNodes=[],a.remoteData(t)},loadData:function(t,n){e(t).data("tree").options.data=n,a.loadData(t,e(t).data("tree").options.data)},getNodesByFilter:function(t,n){var r=e(t).data("tree").options;return r.nodesFilter=[],a.findNodeByFilter(t,r.data,n),r.nodesFilter},removeNode:function(t,n){e("#"+n).remove();var r=e(t).data("tree").options.data;a.removeNodeById(t,r,n)}}}(jQuery,window);