var lavaCalendar={init:function(a){var e=this,t=$(a),n=t.data("calendar").options,l=$.fn.lavaCalendar.locales[n.lang];t.hasClass("lava-calendar")?t.html(""):t.addClass("lava-calendar");for(var r=$("<div class='lava-calendar-header' style='background:"+n.color+";'></div>").appendTo(t),d=($("<div class='lava-calendar-prevyear'>«</div>").appendTo(r),$("<div class='lava-calendar-nextyear'>»</div>").appendTo(r),$("<div class='lava-calendar-prevmonth'><</div>").appendTo(r),$("<div class='lava-calendar-nextmonth'>></div>").appendTo(r),$("<span class='lava-calendar-text'></span>").appendTo(r),$("<table class='lava-calendar-table'></table>").appendTo(t)),o=$("<thead class='lava-calendar-thead'></thead>").appendTo(d),i=$("<tbody class='lava-calendar-tbody'></tbody>").appendTo(d),c=["<tr>"],s=0;7>s;s++)c.push("<th style='color:"+n.color+";'>"+l[s]+"</th>");c.push("</tr>");for(var v=[],s=0;6>s;s++){for(var p=["<tr>"],h=0;7>h;h++)p.push("<td></td>");p.push("</tr>"),v.push(p.join(""))}o.html(c.join("")),i.html(v.join(""));for(var u=$("<div class='lava-calendar-menu hidden'></div>").appendTo(t),f=$("<div class='lava-calendar-menu-year'></div>").appendTo(u),m=($("<div class='lava-calendar-prevyear-inner'>«</div>").appendTo(f),$("<span><input class='lava-calendar-menu-year-input'/></span>").appendTo(f),$("<div class='lava-calendar-nextyear-inner'>»</div>").appendTo(f),$("<div class='lava-calendar-menu-month'></div>").appendTo(u)),g=$("<table></table>").appendTo(m),_=$("<tbody></tbody>").appendTo(g),D=[],s=1;13>s;s++){var b="";(0===s||s%4===1)&&(b+="<tr>"),b=b+"<td data-month='"+s+"'>"+l[s+6]+"</td>",0!==s&&s%4===0&&(b+="</tr>"),D.push(b)}$(D.join("")).appendTo(_),e.loadDate(a),e.resize(a)},loadDate:function(a){var e=this,t=$(a),n=t.data("calendar").options,l=n.currentDate;l.setDate(1);var r=n.currentDate.getFullYear(),d=n.currentDate.getMonth();t.find(".lava-calendar-header span").text(r+"-"+e.round(d+1));var o=t.find(".lava-calendar-table").find("td"),i=l.getDay(),c=new Date(l.getTime());c.setMonth(d+1),c.setTime(c.getTime()-864e5);var s=c.getDate();o.text("").removeAttr("data-date").removeAttr("class");for(var v=0;s>v;v++)o.eq(v+i).text(v+1).attr("data-date",r+"/"+(d+1)+"/"+(v+1));if(n.showOtherDate){for(var p=new Date(l.getTime()-864e5),h=p.getDate(),r=p.getFullYear(),d=p.getMonth(),v=0;i>v;v++){var u=h-i+v+1;o.eq(v).text(u).attr("data-date",r+"/"+(d+1)+"/"+u).addClass("other")}var f=new Date(l.getTime());f.setMonth(d+2);for(var r=f.getFullYear(),d=f.getMonth(),v=0;42-i-s>v;v++)o.eq(i+s+v).text(v+1).attr("data-date",r+"/"+(d+1)+"/"+(v+1)).addClass("other")}if(n.data&&e.loadData(a),n.date){var u=n.date;t.find(".lava-calendar-table").find("td[data-date='"+u.getFullYear()+"/"+(u.getMonth()+1)+"/"+u.getDate()+"']").addClass("active")}n.onLoadDateSuccess&&n.onLoadDateSuccess()},loadData:function(a){var e=$(a),t=e.data("calendar").options,n=t.data,l=e.children("table").find("td");l.css({background:"transparent"}),l.prop("class","").removeAttr("data-type").removeAttr("data-blackbox").children().remove();for(var r=0;r<l.length;r++){var d=l.eq(r).attr("data-date");if(d)for(var o=d.split("/")[0],i=d.split("/")[1],c=d.split("/")[2],s=0;s<n.length;s++){var v=n[s].date;if(v.getFullYear()==o&&v.getMonth()+1==i&&v.getDate()==c){"normal"==n[s].type?l.eq(r).addClass("lava-calendar-normal").attr("data-type","normal").css({background:t.normalColor}):"alarm"==n[s].type?l.eq(r).addClass("lava-calendar-alarm").attr("data-type","alarm").css({background:t.alarmColor}):"warn"==n[s].type&&l.eq(r).addClass("lava-calendar-alarm").attr("data-type","warn").css({background:t.warnColor}),n[s].blackbox&&l.eq(r).append("<div class='lava-calendar-blackbox'></div>").attr("data-blackbox",!0),n[s].device&&l.eq(r).append("<div class='lava-calendar-device'></div>"),n[s].server&&l.eq(r).append("<div class='lava-calendar-server'></div>");break}}}},gotoMonthOrYear:function(a,e,t){var n=this,l=$(a),r=l.data("calendar").options;if("month"===e){var d=r.currentDate.getMonth();r.currentDate.setMonth("next"==t?d+1:d-1)}else if("year"===e){var o=r.currentDate.getFullYear();r.currentDate.setYear("next"==t?o+1:o-1)}else if("monthyear"===e){var o=t.split("-")[0],d=t.split("-")[1];r.currentDate.setYear(parseInt(o)),r.currentDate.setMonth(parseInt(d)-1)}if(n.loadDate(a),r.onMonthChange){var i=r.currentDate,c=new Date(i.getFullYear()+"/"+n.round(i.getMonth()+1)+"/"+n.round(i.getDate())+" 00:00:00"),s=new Date(c.getTime());s.setMonth(s.getMonth()+1),s.setTime(s.getTime()-1),r.onMonthChange(c,s)}},resize:function(a){var e=$(a),t=.6*e.width()/6;e.find(".lava-calendar-table").find("td").css({height:t})},round:function(a){return 10>a?"0"+a:a},bindEvent:function(a){var e=this,t=$(a),n=t.data("calendar").options;t.on("selectstart",function(){return!1}),t.find(".lava-calendar-prevyear").on("click",function(){e.gotoMonthOrYear(a,"year","prev")}),t.find(".lava-calendar-nextyear").on("click",function(){e.gotoMonthOrYear(a,"year","next")}),t.find(".lava-calendar-prevyear-inner").on("click",function(){t.find(".lava-calendar-menu-year-input").val(parseInt(t.find(".lava-calendar-menu-year-input").val())-1)}),t.find(".lava-calendar-nextyear-inner").on("click",function(){t.find(".lava-calendar-menu-year-input").val(parseInt(t.find(".lava-calendar-menu-year-input").val())+1)}),t.find(".lava-calendar-prevmonth").on("click",function(){e.gotoMonthOrYear(a,"month","prev")}),t.find(".lava-calendar-nextmonth").on("click",function(){e.gotoMonthOrYear(a,"month","next")}),t.children("table").find("td").on("click dblclick",function(l){t.find("td").children(".lava-calendar-active").remove();var r=$(this),d=r.width()+2,o=r.height()+2;if(r.append("<div class='lava-calendar-active' style='width:"+d+"px;height:"+o+"px;'></div>"),"click"==l.type&&n.onClick&&r.attr("data-date")){var i={date:new Date(r.attr("data-date")),type:r.attr("data-type"),blackbox:r.attr("data-blackbox")};n.date=i.date,n.onClick(i)}if("dblclick"==l.type&&n.onDblclick&&r.attr("data-date")){var i={date:new Date(r.attr("data-date")),type:r.attr("data-type"),blackbox:r.attr("data-blackbox")};n.date=i.date,n.onDblclick(i)}r.hasClass("active")||(t.find(".active").removeClass("active"),r.addClass("active")),r.hasClass("other")&&(n.currentDate=new Date(r.attr("data-date")),e.loadDate(a))}),t.find(".lava-calendar-header span").on("mouseover mouseout click",function(l){var r=$(l.target);"mouseout"==l.type?$(l.target).removeClass("lava-calendar-nav-hover"):"mouseover"==l.type?r.hasClass("lava-calendar-nav-hover")||$(l.target).addClass("lava-calendar-nav-hover"):"click"==l.type&&(t.find(".lava-calendar-menu").is(":visible")?(t.find(".lava-calendar-menu").hide(),e.gotoMonthOrYear(a,"monthyear",t.find(".lava-calendar-text").text())):(t.find(".lava-calendar-menu-year-input").val(t.find(".lava-calendar-text").text().split("-")[0]),t.find(".lava-calendar-menu-month").find("td[data-month='"+(n.currentDate.getMonth()+1)+"']").click(),t.find(".lava-calendar-menu").show())),l.stopPropagation()}),t.find(".lava-calendar-menu-month").find("td").on("click",function(n){var l=$(n.target);t.find(".lava-calendar-selected-month").removeClass("lava-calendar-selected-month"),l.hasClass("lava-calendar-selected-month")||l.addClass("lava-calendar-selected-month"),t.find(".lava-calendar-text").text(t.find(".lava-calendar-menu-year-input").val()?parseInt(t.find(".lava-calendar-menu-year-input").val())+"-"+e.round(l.attr("data-month")):t.find(".lava-calendar-text").text().split("-")[0]+"-"+e.round(l.attr("data-month"))),e.gotoMonthOrYear(a,"monthyear",t.find(".lava-calendar-text").text()),t.find(".lava-calendar-menu").hide(),n.stopPropagation()})},select:function(a,e){var t=this,n=$(a),l=n.data("calendar").options;l.date=e,l.currentDate=new Date(e.getFullYear()+"/"+(e.getMonth()+1)+"/1"),t.loadDate(a),n.find(".active").removeClass("active");var r=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),d=n.find("td[data-date='"+r+"']");d.addClass("active")}};$.fn.lavaCalendar=function(a,e){return"string"==typeof a?$.fn.lavaCalendar.methods[a](this,e):void $.each(this,function(){var e={};$(this).data("calendar"),$.extend(e,$.fn.lavaCalendar.defaults),$(this).data("calendar",{options:e}),$.extend($(this).data("calendar").options,a),$.extend($.fn.lavaCalendar.locales,$(this).data("calendar").options.weekMonth),lavaCalendar.init(this),lavaCalendar.bindEvent(this),a.data&&lavaCalendar.loadData(this)})},$.fn.lavaCalendar.defaults={lang:"zh-CN",alarmColor:"#e26a6a",normalColor:"#26c281",warnColor:"#b1b323",currentDate:new Date,weekMonth:{},showOtherDate:!1,onClick:null,onDblclick:null,onMonthChange:null,onLoadDateSuccess:null},$.fn.lavaCalendar.methods={loadData:function(a,e){$(a).data("calendar").options.data=e,lavaCalendar.loadData(a)},getDate:function(a){return $(a).data("calendar").options.currentDate},getSelected:function(a){return $(a).data("calendar").options.date},select:function(a,e){lavaCalendar.select(a,e)},unselect:function(a){var e=$(a);e.data("calendar").options.date=null,e.find(".active").removeClass("active")}},$.fn.lavaCalendar.locales={"zh-CN":["日","一","二","三","四","五","六","一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],"zh-TW":["日","一","二","三","四","五","六","一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],ar:"ح_ن_ث_ر_خ_ج_س".split("_"),bo:"ཉི་མ་_ཟླ་བ་_མིག་དམར་_ལྷག་པ་_ཕུར་བུ_པ་སངས་_སྤེན་པ་".split("_"),de:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),"en-gb":["Su","Mo","Tu","We","Th","Fr","Sa","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"en-US":["Su","Mo","Tu","We","Th","Fr","Sa","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fr:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),it:"D_L_Ma_Me_G_V_S".split("_"),ja:"日_月_火_水_木_金_土".split("_"),ru:"вс_пн_вт_ср_чт_пт_сб".split("_"),"pt-PT":"7_1_2_3_4_5_6".split("_"),fa:"S_M_T_W_T_F_S".split("_")};