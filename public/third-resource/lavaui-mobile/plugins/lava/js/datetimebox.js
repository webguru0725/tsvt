!function(e){var t={init:function(e){var t=this;t.initDom(e)},initDom:function(t){var a=this,n=e(t),i=n.data("datetimebox").options;n.combo(i);var o=n.combo("panel"),s=e("<div class='datetimebox-container'></div>").appendTo(o),r={showOtherDate:!0,onClick:function(){a.formatDate(n,s,n.data("datetimebox").timespinner,i)},lang:i.lang?i.lang:"zh-CN"};if(s.lavaCalendar(r),n.data("datetimebox").calendar=s,i.showTime){var l=e("<div class='form-group' style='margin:5px;'></div>").appendTo(o),d=e("<input type='text' class='form-control' />").appendTo(l),c={showSeconds:/ss/.test(i.format),onChange:function(){a.formatDate(n,s,d,i)}};d.timespinner(c),n.data("datetimebox").timespinner=d}i.showIcon&&n.after("<span class='datetimebox-icon'></span>"),a.initEvent(n,s,n.data("datetimebox").timespinner,i)},initEvent:function(e,t,a,n){var i=this;e.on("blur",function(){var o=e.val();if(""!=o){a&&o.split("")[1]&&a.timespinner("setValue",o.split(" ")[1]);var s=o.split(" ")[0].replace(/-/g,"/");if(isNaN(new Date(s).getFullYear()))var r=new Date;else var r=new Date(s);t.lavaCalendar("select",r),i.formatDate(e,t,a,n)}}),n.showIcon&&e.next(".datetimebox-icon").on("click",function(t){e.click(),t.stopPropagation()})},formatDate:function(e,t,a,n){var i=this,o=t.lavaCalendar("getSelected");o||(o=new Date,t.lavaCalendar("select",o));var s=o.getFullYear(),r=i.round(o.getMonth()+1),l=i.round(o.getDate()),d=n.format.split(" ")[0].replace("yyyy",s).replace("MM",r).replace("dd",l);if(a&&!a.val()){var c=new Date,m=n.format.split(" ")[1].replace("hh",i.round(c.getHours())).replace("mm",i.round(c.getMinutes())).replace("ss",i.round(c.getSeconds()));a.val(m)}d=a?d+" "+a.val():d,e.val(d)},round:function(e){return 10>e?"0"+e:e},setValue:function(t,a){var n=this,i=e(t),o=i.data("datetimebox"),s=o.calendar,r=o.timespinner,l=o.options;return""==a?(s.lavaCalendar("unselect"),r&&r.val(""),void i.val("")):(r&&a.split("")[1]&&r.timespinner("setValue",a.split(" ")[1]),s.lavaCalendar("select",new Date(a.split(" ")[0].replace(/-/g,"/"))),void n.formatDate(i,s,r,l))}};e.fn.datetimebox=function(a,n){return"string"==typeof a?e.fn.datetimebox.methods[a](this,n):void e.each(this,function(){var n={};e.extend(n,e.fn.combo.defaults),e.extend(n,e.fn.lavaCalendar.defaults),e.extend(n,e.fn.datetimebox.defaults),n.showTime&&e.extend(n,e.fn.timespinner.defaults),e.extend(n,a),e(this).data("datetimebox",{options:n}),t.init(this)})},e.fn.datetimebox.defaults={format:"yyyy-MM-dd hh:mm:ss",showTime:!0,showIcon:!1,panelWidth:250,panelHeight:"auto",showArrow:!1},e.fn.datetimebox.methods={setValue:function(e,a){t.setValue(e,a)}}}(jQuery);