!function(e,t){var a={treeId:1,isIE:void 0,init:function(e){var t=this;t.bindEvent(e),t.checkIsIE()},checkIsIE:function(){var e=this;e.isIE=/msie|edge|trident/.test(t.navigator.userAgent.toLowerCase())?!0:!1},loadLocalData:function(t){var a=this,n=e(t),r=n.data("tree").options;r.data.length>0?(r.loadFilter&&(r.data=r.loadFilter(r.data)),a.loadData(t,r.data)):console.error("本地数据为空")},loadData:function(t,n,r){var o=e(t),l=o.data("tree").options;o.addClass("lavaui-tree"),o.html(""),a.initData(n,l.htmlArray,0,void 0,l),a.initDom(t,t,l.htmlArray,r)},remoteData:function(t){var a=this,n=e(t),r=n.data("tree").options,o=n.data("tree").options.url;e.ajax({url:o,type:r.method,dataType:"json",data:r.queryParams}).done(function(e){e?(r.data=e,r.loadFilter&&(r.data=r.loadFilter(r.data)),a.loadData(t,r.data,function(){if(r.onLoadSuccess){var e=r.data;r.onLoadSuccess(e)}})):console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空")}).fail(function(){r.onLoadError&&r.onLoadError(),console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败")})},initData:function(e,t,a,n,r){for(var o=this,l=0;l<e.length;l++){e[l].treeId="lava_tree_"+o.treeId++,e[l].level=a?a:0,e[l].parentTreeId=n?n:void 0;var d=r.checkbox,s=r.async;if(d){var c="<li id='"+e[l].treeId+"' {0}><a href='javascript:;'><span class='tree-chkbx {2}'></span><span class='{3}'></span><span>"+e[l].text+"</span>{1}</a>{4}</li>",i="";if(s?e[l].closed?(c=c.replace("{0}","class='closed'"),c=c.replace("{1}","<span class='button-open'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):e[l].children&&e[l].children.length>0?(c=c.replace("{0}",""),c=c.replace("{1}","<span class='button-cloed'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}",""),i="icon-file",c=c.replace("{4}","")):e[l].children&&e[l].children.length>0?e[l].closed?(c=c.replace("{0}","class='closed'"),c=c.replace("{1}","<span class='button-open'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}","<span class='button-close'></span>"),i="icon-folder",c=c.replace("{4}","<ul></ul>")):(c=c.replace("{0}",""),c=c.replace("{1}",""),i="icon-file",c=c.replace("{4}","")),c=e[l].iconCls?c.replace("{3}","icon "+e[l].iconCls):c.replace("{3}","node-icon "+i),e[l].checked)e[l].checked=2,c=c.replace("{2}","tree-chk");else if(e[l].children&&e[l].children.length>0){for(var h=[],p=0;p<e[l].children.length;p++)h.push(e[l].children[p].checked?!0:!1);/\/false/.test("/"+h.join("/"))?/\/true/.test("/"+h.join("/"))?(e[l].checked=1,c=c.replace("{2}","tree-halfchk")):(e[l].checked=0,c=c.replace("{2}","tree-nochk")):(e[l].checked=2,c=c.replace("{2}","tree-chk"))}else e[l].checked=0,c=c.replace("{2}","tree-nochk")}else{var i="";if(s)if(e[l].closed){i="icon-folder";var c="<li id='"+e[l].treeId+"' class='closed'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span><span class='button-open'></span></a><ul></ul></li>"}else if(e[l].children&&e[l].children.length>0){i="icon-folder";var c="<li id='"+e[l].treeId+"'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span><span class='button-close'></span></a><ul></ul></li>"}else{i="icon-file";var c="<li id='"+e[l].treeId+"'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span></a></li>"}else if(e[l].children&&e[l].children.length>0)if(e[l].closed){i="icon-folder";var c="<li id='"+e[l].treeId+"' class='closed'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span><span class='button-open'></span></a><ul></ul></li>"}else{i="icon-folder";var c="<li id='"+e[l].treeId+"'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span><span class='button-close'></span></a><ul></ul></li>"}else{i="icon-file";var c="<li id='"+e[l].treeId+"'><a href='javascript:;'><span class='{0}'></span><span>"+e[l].text+"</span></a></li>"}c=e[l].iconCls?c.replace("{0}","icon "+e[l].iconCls):c.replace("{0}","node-icon "+i)}t.push({html:c,parentTreeId:n});var f=a+1;e[l].children&&o.initData(e[l].children,t,f,e[l].treeId,r)}},initDom:function(t,a,n,r){var o=this,l=e(t).data("tree").options.closedChildren;if(0==n.length)return void(r&&r());var d=e(a),s=e(t);s.data("tree").options,n[0].parentTreeId&&(d=e("#"+n[0].parentTreeId).children("ul"));var c=n[0].parentTreeId,i=100;o.isIE&&(i=1e4),i=n.length>i?i:n.length;var h=n.splice(0,i),p=[],f=[];if(t==a)var u=!0;else var u=!d.parent("li").hasClass("closed");for(var v=!1,k=((new Date).getTime(),0);k<h.length;k++)c==h[k].parentTreeId?u?p.push(h[k].html):f.push(h[k]):(u?(d[0].childNodes.length>0?d.append(p.join("")):d[0].innerHTML=p.join(""),v=!0):l[c]=l[c]?l[c].concat(f):f,c=h[k].parentTreeId,d=c?e("#"+c).children("ul"):e(t),u=!d.parent("li").hasClass("closed"),u?(p=[h[k].html],f=[]):(p=[],f=[h[k]]));p.length>0&&(d[0].childNodes.length>0?d.append(p.join("")):d[0].innerHTML=p.join(""),v=!0),f.length>0&&(l[c]=l[c]?l[c].concat(f):f);var g=v?5:0;o.isIE&&v&&(g=3e3),n.length>0?g?setTimeout(function(){o.initDom(t,d,n,r)},g):o.initDom(t,d,n,r):r&&r()},bindEvent:function(t){var a=this,n=e(t),r=n.data("tree").options;n.delegate(".button-open, .button-close, a, .tree-chkbx","click",function(n){var o=e(this);if(o.hasClass("button-open")){a.expandNodes(o.parent("a").parent("li"),t,r);var l=o.parent().prop("id"),d=a.findNode(r.data,l);r.onExpand&&r.onExpand(d),n.stopPropagation()}else if(o.hasClass("button-close")){a.collapseNodes(o);var l=o.parent().prop("id"),d=a.findNode(r.data,l);r.onCollapse&&r.onCollapse(d),n.stopPropagation()}else if("A"==o[0].tagName)o.children(".tree-chkbx").click();else if(o.hasClass("tree-chkbx")){a.checkNodes(t,o);var d=a.findNode(r.data,o.parent().parent().prop("id"));r.onCheck&&r.onCheck(d),n.stopPropagation()}})},expandNodes:function(t,n,r){var o=this,l=e(n),r=l.data("tree").options,d=t,s=d.attr("id"),c=o.findNode(r.data,s),i=c.level,h=c.id;d.hasClass("closed")&&d.removeClass("closed"),d.children("a").children(".button-open")[0].setAttribute("class","button-close"),d.children("a").children(".node-icon").removeClass("icon-folder node-icon").addClass("icon-loading"),d.children("ul")||d.append("<ul></ul>");var p=d.children("ul"),f=null;if(r.async)if(r.closedChildren[s]&&r.closedChildren[s].length>0)f=r.closedChildren[s],d.hasClass("closed")&&d.removeClass("closed"),f&&(o.initDom(n,p,f),d.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open"));else{if(c.children&&c.children.length>0)return void d.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open");e.ajax({url:r.url,type:r.method,dataType:"json",data:{id:h},success:function(e){if(e.length>0){var t=i+1;o.initData(e,r.htmlArray,t,s,r),o.findNode(r.data,s,function(t){t.children=e}),a.initDom(n,p,r.htmlArray)}else console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空");d.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")},error:function(){console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败"),d.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}})}else{if(f=r.closedChildren[s]){if(r.cascadeCheck)if(0===c.checked){var u=JSON.stringify(f);u.replace(/(tree\-chk)|(tree\-halfchk)/g,function(){return"tree-nochk"}),f=JSON.parse(u)}else if(2===c.checked){var u=JSON.stringify(f);u=u.replace(/(tree\-nochk)|(tree\-halfchk)/g,function(){return"tree-chk"}),f=JSON.parse(u)}o.initDom(n,p,f)}d.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}},collapseNodes:function(e){var t=e;t[0].setAttribute("class","button-open"),t.parent("a").children(".node-icon").removeClass("icon-folder_open").addClass("icon-folder"),t.parent("a").parent("li").addClass("closed")},selectNode:function(t,a,n){var r=this,o=a,l=e(t),d=l.data("tree").options;d.selectedNodes||(d.selectedNodes=[]);var s=d.selectedNodes,c=o.parent().prop("id"),i=r.findNode(d.data,c);if(void 0===n||null===n)if(o.hasClass("selectNode")){if(o.removeClass("selectNode"),s.length>0){for(var h=0,p=0;p<s.length;p++)if(c===s[p].treeId){h=p;break}s.splice(h,1)}}else{if(d.multiSelect||(l.find(".selectNode").eq(0).removeClass("selectNode"),s=[]),o.addClass("selectNode"),d.onSelect&&d.onSelect(i),s.length>=0)for(var h=null,p=0;p<s.length;p++)if(c===s[p].treeId){h=p;break}null===h&&s.push(i)}else if(n===!1){if(o.hasClass("selectNode")&&o.removeClass("selectNode"),s.length>0){for(var h=0,p=0;p<s.length;p++)if(c===s[p].treeId){h=p;break}s.splice(h,1)}}else if(n===!0){if(d.multiSelect||(l.find(".selectNode").eq(0).removeClass("selectNode"),s=[]),o.hasClass("selectNode")||(o.addClass("selectNode"),d.onSelect&&d.onSelect(i)),s.length>=0)for(var h=null,p=0;p<s.length;p++)if(c===s[p].treeId){h=p;break}null===h&&s.push(i)}d.selectedNodes=s},checkNodes:function(t,a){var n=this,r=a,o=e(t).data("tree").options,l=(o.data,r.hasClass("tree-chk")),d=r.hasClass("tree-nochk"),s=r.hasClass("tree-halfchk");l?n.setCheckStatus(t,r,0):d?n.setCheckStatus(t,r,2):s&&n.setCheckStatus(t,r,2)},setCheckStatus:function(t,a,n){var r=this,o=e(t),l=o.data("tree").options,d=l.data,s=a,c=s.parent().parent(),i=c.children("ul").find(".tree-chkbx"),h=c.prop("id"),p=r.findNode(d,h),f=!1,u=null;p.children&&p.children.length>0&&(f=!0),p.parentTreeId&&p.parentTreeId.length>0&&(u=p.parentTreeId);var v="";if(0===n?v="tree-nochk":1===n?v="tree-halfchk":2===n&&(v="tree-chk"),s[0].setAttribute("class","tree-chkbx "+v),r.updateCheckStatusData(d,h,n),l.cascadeCheck){if(f&&(0===n||2===n)){for(var k=0,g=i.length;g>k;k++)i[k].setAttribute("class","tree-chkbx "+v);r.updateChildCheckStatusData(d,h,n)}u&&r.cascadeCheck(d,u)}},cascadeCheck:function(t,a){var n=this,r=e("#"+a).children("a").children(".tree-chkbx"),o=n.findNode(t,a),l=o.children,d=o.parentTreeId,s=null,c=/"checked":2/.test(JSON.stringify(l)),i=/"checked":1/.test(JSON.stringify(l)),h=/"checked":0/.test(JSON.stringify(l));c?i?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),s=1):h?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),s=1):(r[0].setAttribute("class","tree-chkbx tree-chk"),s=2):i?(r[0].setAttribute("class","tree-chkbx tree-halfchk"),s=1):(r[0].setAttribute("class","tree-chkbx tree-nochk"),s=0),n.updateCheckStatusData(t,a,s),void 0!==d&&n.cascadeCheck(t,d)},findNode:function(e,t,a){for(var n=this,r=0;r<e.length;r++){if(e[r].treeId==t)return a?a(e[r]):e[r];if(e[r].children&&e[r].children.length>0&&n.findNode(e[r].children,t))return a?a(n.findNode(e[r].children,t)):n.findNode(e[r].children,t)}},findNodeById:function(t,a,n){for(var r=this,o=e(t).data("tree").options.nodesById,l=0;l<a.length;l++)a[l].id==n&&o.push(a[l]),a[l].children&&a[l].children.length>0&&r.findNodeById(t,a[l].children,n)},findNodeByFilter:function(t,a,n){for(var r=this,o=e(t).data("tree").options,l=0;l<a.length;l++)n(a[l])&&o.nodesFilter.push(a[l]),a[l].children&&a[l].children.length>0&&r.findNodeByFilter(t,a[l].children,n)},removeNodeById:function(e,t,a){for(var n=this,r=0;r<t.length;r++){if(t[r].treeId==a){t.splice(r,1);break}t[r].children&&t[r].children.length>0&&n.removeNodeById(e,t[r].children,a)}},tranverseNode:function(t,a){for(var n=this,r=e(t).data("tree").options,o=0;o<a.length;o++)0==a[o].checked?r.uncheckedNodes.push(a[o]):1==a[o].checked?r.indeterminateNodes.push(a[o]):2==a[o].checked&&r.checkedNodes.push(a[o]),a[o].children&&a[o].children.length>0&&n.tranverseNode(t,a[o].children)},updateChildCheckStatusData:function(e,t,a){var n=this;n.findNode(e,t,function(e){if(e&&e.children&&e.children.length>0){var t=JSON.stringify(e.children);t=t.replace(/"checked":[0|1|2]/g,function(){return'"checked":'+a}),e.children=JSON.parse(t)}})},updateCheckStatusData:function(e,t,a){var n=this;n.findNode(e,t,function(e){e&&(e.checked=a)})}};e.fn.tree=function(t,n){return"string"==typeof t?e.fn.tree.methods[t](this,n):void e.each(this,function(){var n={};e.extend(n,e.fn.tree.defaults),e.extend(n,t);var r=e(this).data("tree"),o={htmlArray:[],closedChildren:{}};e.extend(n,o),e(this).data("tree",{options:n}),r||a.init(this),e(this).data("tree").options.url?a.remoteData(this):"data"in e(this).data("tree").options&&e(this).data("tree").options.data.length>0&&a.loadLocalData(this)})},e.fn.tree.defaults={url:"",method:"GET",data:[],checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,async:!1,onSelect:null,multiSelect:!1,onCheck:null,onExpand:null,onCollapse:null,onLoadSuccess:null,onLoadError:null,queryParams:{},loadFilter:null},e.fn.tree.methods={find:function(t,n){e(t).data("tree").options.nodesById=[];var r=e(t).data("tree").options.data;return a.findNodeById(t,r,n),e(t).data("tree").options.nodesById},check:function(t,n){var r=e("#"+n).children("a").children(".tree-chkbx"),o=e(t).data("tree").options;if(a.setCheckStatus(t,r,2),o.onCheck){var l=a.findNode(o.data,n);o.onCheck(l)}},uncheck:function(t,n){var r=e("#"+n).children("a").children(".tree-chkbx");a.setCheckStatus(t,r,0)},select:function(t,n){var r=e("#"+n).children("a");a.selectNode(t,r,!0)},unSelect:function(t,n){var r=e("#"+n).children("a");a.selectNode(t,r,!1)},getChecked:function(t,n){var r=e(t),o=r.data("tree").options,l=o.data;o.checkedNodes=[],o.indeterminateNodes=[],o.uncheckedNodes=[],a.tranverseNode(t,l);var d={};if("object"==typeof n)for(var s=0;s<n.length;s++){var c=n[s];d[c]=o[c+"Nodes"]}else"string"==typeof n?d[n]=o[n+"Nodes"]:n||(d.checked=o.checkedNodes);return d},getSelected:function(t){var a=e(t).data("tree").options;return a.selectedNodes||(a.selectedNodes=[]),a.selectedNodes},getChildren:function(t,n){var r=e(t),o=r.data("tree").options.data,l=a.findNode(o,n);return l.children?l.children:[]},getParent:function(t,n){var r=e(t),o=r.data("tree").options.data,l=a.findNode(o,n),d=l.parentTreeId;if(void 0!==d)var s=a.findNode(o,d);return s?s:{}},reload:function(t,n){var r=e(t).data("tree").options;r.queryParams=n?n:{},r.selectedNodes=[],r.checkedNodes=[],a.remoteData(t)},loadData:function(t,n){e(t).data("tree").options.data=n,a.loadData(t,e(t).data("tree").options.data)},getNodesByFilter:function(t,n){var r=e(t).data("tree").options;return r.nodesFilter=[],a.findNodeByFilter(t,r.data,n),r.nodesFilter},removeNode:function(t,n){e("#"+n).remove();var r=e(t).data("tree").options.data;a.removeNodeById(t,r,n)}}}(jQuery,window);