var planBox={init:function(a){var t=$(a);t.hasClass("plan-box")?t.html(""):t.addClass("plan-box");var e=t.data("planBox").options,l=$("<div class='plan-box-container' style='width:"+e.width+"px;height:"+e.height+"px;'></div>").appendTo(t);e.container=l;var o=e.color,r="<style>";for(var n in o)r+=" .plan-box-item."+n+"{",r+=e.isFill?"background-color:"+o[n]+";}":"border: 2px solid "+o[n]+";}";r+="</style>",$(r).appendTo("body"),planBox.drawRect(a,e.data),planBox.bindEvent(a)},drawRect:function(a,t){var e=$(a),l=e.data("planBox").options,o=l.container;o.html(""),l.data=t;var r=l.width,n=l.height,p=t.length,i=t[0].length,s=l.rowBlank,c=l.colBlank,d="<span class='{class}' style='width:{width}px;height:{height}px;line-height:{height}px;top:{top};left:{left};' data-left='{left}' data-top='{top}' data-type='{type}' data-row='{row}' data-col='{col}'>{text}</span>";l.colNumber&&(p+=1);var f=Math.floor((r-(i-1)*s)/i),x=Math.floor((n-(p-1)*c)/p);d=d.replace("{width}",f).replace(/{height}/g,x);var h=[];if(l.colNumber)for(var m=0;i>m;m++){var v=d.replace(/{top}/g,"0px").replace(/{left}/g,(f+s-1)*m+"px").replace("{type}","").replace("{row}","").replace("{col}","");v=v.replace("{class}","plan-box-header-item").replace("{text}",m),h.push(v)}for(var m=0;m<t.length;m++){var p=t[m];if(l.colNumber)var b=m+1;else var b=m;for(var u=0;u<p.length;u++){var v=d.replace(/{top}/g,(x+c-1)*b+"px").replace(/{left}/g,(f+s-1)*u+"px").replace("{type}",p[u]).replace("{row}",m).replace("{col}",u);v=0==p[u]?v.replace("{class}","plan-box-item normal"):1==p[u]?v.replace("{class}","plan-box-item selected"):v.replace("{class}","plan-box-item alarm"),v=v.replace("{text}",""),h.push(v)}}o.html(h.join(""))},bindEvent:function(a){var t,e=$(a),l=e.data("planBox").options,o=l.container,r=!1,n=0,p=0,i=0,s=0,c=0,d=0,f=0,x=0,h=0,m=0;o.delegate(".plan-box-item","mousedown mousemove mouseup dragstart",function(a){var e=$(a.target);if("mousedown"==a.type)c=a.clientX,d=a.clientY,f=e.offset().left,x=e.offset().top,r=!0,t=parseInt(e.attr("data-type")),n=parseInt(e.attr("data-left")),p=parseInt(e.attr("data-top"));else if("dragstart"==a.type)a.preventDefault();else if("mousemove"==a.type){if(r){o.find(".plan-box-rect").remove(),h=a.clientX,m=a.clientY;var v=h-c,b=m-d,u='<div class="plan-box-rect" style="position:absolute;height:'+b+"px;width:"+v+"px;left:"+(n+2)+"px;top:"+(p+2)+'px;"></div>';$(u).appendTo(o)}}else if(r){r=!1,o.find(".plan-box-rect").remove(),i=parseInt(e.attr("data-left")),s=parseInt(e.attr("data-top"));var g=l.data,w=t;if(n==i&&p==s)w+=1,l.color.alarm?3==w&&(w=0):2==w&&(w=0),0==w?e.attr("class","plan-box-item normal"):1==w?e.attr("class","plan-box-item selected"):e.attr("class","plan-box-item alarm"),e.attr("data-type",w),g[e.attr("data-row")][e.attr("data-col")]=w;else{if(n>i){var y=n;n=i,i=y}if(p>s){var y=p;p=s,s=y}o.find(".plan-box-item").each(function(a,t){var e=$(t),l=parseInt(e.attr("data-left")),o=parseInt(e.attr("data-top"));l>=n&&o>=p&&i>=l&&s>=o&&(0==w?e.attr("class","plan-box-item normal"):1==w?e.attr("class","plan-box-item selected"):e.attr("class","plan-box-item alarm"),e.attr("data-type",w),g[e.attr("data-row")][e.attr("data-col")]=w)})}n=0,p=0,f=0,x=0,i=0,s=0,c=0,d=0}})}};$.fn.planbox=function(a,t){return"string"==typeof a?$.fn.planbox.methods[a](this,t):void $.each(this,function(){var t={};$.extend(t,$.fn.planbox.defaults),$.extend(t,a),$(this).data("planBox",{options:t}),planBox.init(this)})},$.fn.planbox.defaults={width:120,height:120,data:[],isFill:!0,color:{normal:"#efefef",selected:"#0f0",alarm:"#f00"},rowBlank:2,colBlank:3,colNumber:!0},$.fn.planbox.methods={getData:function(a){return $(a).data("planBox").options.data},setData:function(a,t){planBox.drawRect(a,t)}};