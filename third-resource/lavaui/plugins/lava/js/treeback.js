!function(a,c){var h={treeId:1,isIE:void 0,init:function(a){var c=this;c.bindEvent(a),c.checkIsIE()},checkIsIE:function(){var a=this;a.isIE=/msie|edge|trident/.test(c.navigator.userAgent.toLowerCase())?!0:!1},loadLocalData:function(c){var h=this,v=a(c),k=v.data("tree").options;k.data.length>0?(k.loadFilter&&(k.data=k.loadFilter(k.data)),h.loadData(c,k.data)):console.error("本地数据为空")},loadData:function(c,v){var k=a(c),N=k.data("tree").options;k.addClass("lavaui-tree"),k.html(""),h.initData(v,N.htmlArray,0,void 0,N),h.initDom(c,c,N.htmlArray)},remoteData:function(h){var v=this,k=a(h),N=k.data("tree").options,g=k.data("tree").options.url;a.ajax({url:g,type:N.method,dataType:"json",data:N.queryParams}).done(function(a){a?(N.data=a,N.loadFilter&&(N.data=N.loadFilter(N.data)),v.loadData(h,N.data),c.setTimeout(function(){if(N.onLoadSuccess){var a=N.data;N.onLoadSuccess(a)}},200)):console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空")}).fail(function(){N.onLoadError&&N.onLoadError(),console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败")})},initData:function(a,c,h,v,k){for(var N=this,i=0;i<a.length;i++){a[i].treeId="lava_tree_"+N.treeId++,a[i].level=h?h:0,a[i].parentTreeId=v?v:void 0;var g=k.checkbox,C=k.async;if(g){var b="<li id='"+a[i].treeId+"' {0}>{1}<span class='tree-chkbx {2}'></span><a href='javascript:;'><span class='{3}'></span><span>"+a[i].text+"</span></a>{4}</li>",I="";if(C?a[i].closed?(b=b.replace("{0}","class='closed'"),b=b.replace("{1}","<span class='button-open'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):a[i].children&&a[i].children.length>0?(b=b.replace("{0}",""),b=b.replace("{1}","<span class='button-cloed'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}",""),I="icon-file",b=b.replace("{4}","")):a[i].children&&a[i].children.length>0?a[i].closed?(b=b.replace("{0}","class='closed'"),b=b.replace("{1}","<span class='button-open'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}","<span class='button-close'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}",""),I="icon-file",b=b.replace("{4}","")),b=a[i].iconCls?b.replace("{3}","icon "+a[i].iconCls):b.replace("{3}","node-icon "+I),a[i].checked)a[i].checked=2,b=b.replace("{2}","tree-chk");else if(a[i].children&&a[i].children.length>0){for(var y=[],S=0;S<a[i].children.length;S++)y.push(a[i].children[S].checked?!0:!1);/\/false/.test("/"+y.join("/"))?/\/true/.test("/"+y.join("/"))?(a[i].checked=1,b=b.replace("{2}","tree-halfchk")):(a[i].checked=0,b=b.replace("{2}","tree-nochk")):(a[i].checked=2,b=b.replace("{2}","tree-chk"))}else a[i].checked=0,b=b.replace("{2}","tree-nochk")}else{var I="";if(C)if(a[i].closed){I="icon-folder";var b="<li id='"+a[i].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else if(a[i].children&&a[i].children.length>0){I="icon-folder";var b="<li id='"+a[i].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-file";var b="<li id='"+a[i].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a></li>"}else if(a[i].children&&a[i].children.length>0)if(a[i].closed){I="icon-folder";var b="<li id='"+a[i].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-folder";var b="<li id='"+a[i].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-file";var b="<li id='"+a[i].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a></li>"}b=a[i].iconCls?b.replace("{0}","icon "+a[i].iconCls):b.replace("{0}","node-icon "+I)}c.push({html:b,parentTreeId:v});var D=h+1;a[i].children&&N.initData(a[i].children,c,D,a[i].treeId,k)}},initDom:function(c,h,v){var k=this,N=a(c).data("tree").options.closedChildren;if(0!=v.length){{var g=a(h),C=a(c);C.data("tree").options}v[0].parentTreeId&&(g=a("#"+v[0].parentTreeId).children("ul"));var b=v[0].parentTreeId,I=100;k.isIE&&(I=1e4),I=v.length>I?I:v.length;var y=v.splice(0,I),S=[],D=[];if(c==h)var T=!0;else var T=!g.parent("li").hasClass("closed");for(var j=!1,i=((new Date).getTime(),0);i<y.length;i++)b==y[i].parentTreeId?T?S.push(y[i].html):D.push(y[i]):(T?(g[0].childNodes.length>0?g.append(S.join("")):g[0].innerHTML=S.join(""),j=!0):N[b]=N[b]?N[b].concat(D):D,b=y[i].parentTreeId,g=b?a("#"+b).children("ul"):a(c),T=!g.parent("li").hasClass("closed"),T?(S=[y[i].html],D=[]):(S=[],D=[y[i]]));S.length>0&&(g[0].childNodes.length>0?g.append(S.join("")):g[0].innerHTML=S.join(""),j=!0),D.length>0&&(N[b]=N[b]?N[b].concat(D):D);var A=j?5:0;k.isIE&&j&&(A=3e3),v.length>0&&(A?setTimeout(function(){k.initDom(c,g,v)},A):k.initDom(c,g,v))}},bindEvent:function(c){var h=this,v=a(c),k=v.data("tree").options;v.delegate(".button-open, .button-close, a, .tree-chkbx","click",function(){var v=a(this);if(v.hasClass("button-open")){h.expandNodes(v.parent(),c,k);var N=v.parent().prop("id"),g=h.findNode(k.data,N);k.onExpand&&k.onExpand(g)}else if(v.hasClass("button-close")){h.collapseNodes(v);var N=v.parent().prop("id"),g=h.findNode(k.data,N);k.onCollapse&&k.onCollapse(g)}else if("A"==v[0].tagName)h.selectNode(c,v);else if(v.hasClass("tree-chkbx")){h.checkNodes(c,v);var g=h.findNode(k.data,v.parent().prop("id"));k.onCheck&&k.onCheck(g)}})},expandNodes:function(c,v,k){var N=this,g=a(v),k=g.data("tree").options,C=c,b=C.attr("id"),I=N.findNode(k.data,b),y=I.level,S=I.id;C.hasClass("closed")&&C.removeClass("closed"),C.children(".button-open")[0].setAttribute("class","button-close"),C.children("a").children(".node-icon").removeClass("icon-folder node-icon").addClass("icon-loading"),C.children("ul")||C.append("<ul></ul>");var D=C.children("ul"),T=null;if(k.async)if(k.closedChildren[b]&&k.closedChildren[b].length>0)T=k.closedChildren[b],C.hasClass("closed")&&C.removeClass("closed"),T&&(N.initDom(v,D,T),C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open"));else{if(I.children&&I.children.length>0)return void C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open");a.ajax({url:k.url,type:k.method,dataType:"json",data:{id:S},success:function(a){if(a.length>0){var c=y+1;N.initData(a,k.htmlArray,c,b,k),N.findNode(k.data,b,function(c){c.children=a}),h.initDom(v,D,k.htmlArray)}else console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空");C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")},error:function(){console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败"),C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}})}else{if(T=k.closedChildren[b]){if(k.cascadeCheck)if(0===I.checked){var j=JSON.stringify(T);j.replace(/(tree\-chk)|(tree\-halfchk)/g,function(){return"tree-nochk"}),T=JSON.parse(j)}else if(2===I.checked){var j=JSON.stringify(T);j=j.replace(/(tree\-nochk)|(tree\-halfchk)/g,function(){return"tree-chk"}),T=JSON.parse(j)}N.initDom(v,D,T)}C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}},collapseNodes:function(a){var c=a;c[0].setAttribute("class","button-open"),c.siblings("a").children(".node-icon").removeClass("icon-folder_open").addClass("icon-folder"),c.parent("li").addClass("closed")},selectNode:function(c,h,v){var k=this,N=h,g=a(c),C=g.data("tree").options;C.selectedNodes||(C.selectedNodes=[]);var b=C.selectedNodes,I=N.parent().prop("id"),y=k.findNode(C.data,I);if(void 0===v||null===v)if(N.hasClass("selectNode")&&C.multiSelect){if(N.removeClass("selectNode"),b.length>0){for(var S=0,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}b.splice(S,1)}C.onSelect&&C.onSelect(y)}else{if(!N.hasClass("selectNode")){if(C.multiSelect||(g.find(".selectNode").eq(0).removeClass("selectNode"),b=[]),N.addClass("selectNode"),b.length>=0)for(var S=null,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}null===S&&b.push(y)}C.onSelect&&C.onSelect(y)}else if(v===!1){if(N.hasClass("selectNode")&&N.removeClass("selectNode"),b.length>0){for(var S=0,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}b.splice(S,1)}}else if(v===!0){if(C.multiSelect||(g.find(".selectNode").eq(0).removeClass("selectNode"),b=[]),N.hasClass("selectNode")||(N.addClass("selectNode"),C.onSelect&&C.onSelect(y)),b.length>=0)for(var S=null,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}null===S&&b.push(y)}C.selectedNodes=b},checkNodes:function(c,h){var v=this,k=h,N=a(c).data("tree").options,g=(N.data,k.hasClass("tree-chk")),C=k.hasClass("tree-nochk"),b=k.hasClass("tree-halfchk");g?v.setCheckStatus(c,k,0):C?v.setCheckStatus(c,k,2):b&&v.setCheckStatus(c,k,2)},setCheckStatus:function(c,h,v){var k=this,N=a(c),g=N.data("tree").options,C=g.data,b=h,I=b.parent(),y=I.children("ul").find(".tree-chkbx"),S=I.prop("id"),D=k.findNode(C,S),T=!1,j=null;D.children&&D.children.length>0&&(T=!0),D.parentTreeId&&D.parentTreeId.length>0&&(j=D.parentTreeId);var A="";if(0===v?A="tree-nochk":1===v?A="tree-halfchk":2===v&&(A="tree-chk"),b[0].setAttribute("class","tree-chkbx "+A),k.updateCheckStatusData(C,S,v),g.cascadeCheck){if(T&&(0===v||2===v)){for(var i=0,E=y.length;E>i;i++)y[i].setAttribute("class","tree-chkbx "+A);k.updateChildCheckStatusData(C,S,v)}j&&k.cascadeCheck(C,j)}},cascadeCheck:function(c,h){var v=this,k=a("#"+h).children(".tree-chkbx"),N=v.findNode(c,h),g=N.children,C=N.parentTreeId,b=null,I=/"checked":2/.test(JSON.stringify(g)),y=/"checked":1/.test(JSON.stringify(g)),S=/"checked":0/.test(JSON.stringify(g));I?y?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):S?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):(k[0].setAttribute("class","tree-chkbx tree-chk"),b=2):y?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):(k[0].setAttribute("class","tree-chkbx tree-nochk"),b=0),v.updateCheckStatusData(c,h,b),void 0!==C&&v.cascadeCheck(c,C)},findNode:function(a,c,h){for(var v=this,i=0;i<a.length;i++){if(a[i].treeId==c)return h?h(a[i]):a[i];if(a[i].children&&a[i].children.length>0&&v.findNode(a[i].children,c))return h?h(v.findNode(a[i].children,c)):v.findNode(a[i].children,c)}},findNodeById:function(c,h,v){for(var k=this,N=a(c).data("tree").options.nodesById,i=0;i<h.length;i++)h[i].id==v&&N.push(h[i]),h[i].children&&h[i].children.length>0&&k.findNodeById(c,h[i].children,v)},findNodeByFilter:function(c,h,v){for(var k=this,N=a(c).data("tree").options,i=0;i<h.length;i++)v(h[i])&&N.nodesFilter.push(h[i]),h[i].children&&h[i].children.length>0&&k.findNodeByFilter(c,h[i].children,v)},removeNodeById:function(a,c,h){for(var v=this,i=0;i<c.length;i++){if(c[i].treeId==h){c.splice(i,1);break}c[i].children&&c[i].children.length>0&&v.removeNodeById(a,c[i].children,h)}},tranverseNode:function(c,h){for(var v=this,k=a(c).data("tree").options,i=0;i<h.length;i++)0==h[i].checked?k.uncheckedNodes.push(h[i]):1==h[i].checked?k.indeterminateNodes.push(h[i]):2==h[i].checked&&k.checkedNodes.push(h[i]),h[i].children&&h[i].children.length>0&&v.tranverseNode(c,h[i].children)},updateChildCheckStatusData:function(a,c,h){var v=this;v.findNode(a,c,function(a){if(a&&a.children&&a.children.length>0){var c=JSON.stringify(a.children);c=c.replace(/"checked":[0|1|2]/g,function(){return'"checked":'+h}),a.children=JSON.parse(c)}})},updateCheckStatusData:function(a,c,h){var v=this;v.findNode(a,c,function(a){a&&(a.checked=h)})}};a.fn.tree=function(c,v){return"string"==typeof c?a.fn.tree.methods[c](this,v):void a.each(this,function(){var v={};a.extend(v,a.fn.tree.defaults),a.extend(v,c);var k=a(this).data("tree"),N={htmlArray:[],closedChildren:{}};a.extend(v,N),a(this).data("tree",{options:v}),k||h.init(this),a(this).data("tree").options.url?h.remoteData(this):"data"in a(this).data("tree").options&&a(this).data("tree").options.data.length>0&&h.loadLocalData(this)})},a.fn.tree.defaults={url:"",method:"GET",data:[],checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,async:!1,onSelect:null,multiSelect:!1,onCheck:null,onExpand:null,onCollapse:null,onLoadSuccess:null,onLoadError:null,queryParams:{},loadFilter:null},a.fn.tree.methods={find:function(c,v){a(c).data("tree").options.nodesById=[];var k=a(c).data("tree").options.data;return h.findNodeById(c,k,v),a(c).data("tree").options.nodesById},check:function(c,v){var k=a("#"+v).children(".tree-chkbx"),N=a(c).data("tree").options;if(h.setCheckStatus(c,k,2),N.onCheck){var g=h.findNode(N.data,v);N.onCheck(g)}},uncheck:function(c,v){var k=a("#"+v).children(".tree-chkbx");h.setCheckStatus(c,k,0)},select:function(c,v){var k=a("#"+v).children("a");h.selectNode(c,k,!0)},unSelect:function(c,v){var k=a("#"+v).children("a");h.selectNode(c,k,!1)},getChecked:function(c,v){var k=a(c),N=k.data("tree").options,g=N.data;N.checkedNodes=[],N.indeterminateNodes=[],N.uncheckedNodes=[],h.tranverseNode(c,g);var C={};if("object"==typeof v)for(var i=0;i<v.length;i++){var b=v[i];C[b]=N[b+"Nodes"]}else"string"==typeof v?C[v]=N[v+"Nodes"]:v||(C.checked=N.checkedNodes);return C},getSelected:function(c){var h=a(c).data("tree").options;return h.selectedNodes||(h.selectedNodes=[]),h.selectedNodes},getChildren:function(c,v){var k=a(c),N=k.data("tree").options.data,g=h.findNode(N,v);return g.children?g.children:[]},getParent:function(c,v){var k=a(c),N=k.data("tree").options.data,g=h.findNode(N,v);if(g.parentTreeId){var C=h.findNode(N,g.parentTreeId);if(C)return C}return{}},reload:function(c,v){var k=a(c).data("tree").options;k.queryParams=v?v:{},k.selectedNodes=[],k.checkedNodes=[],h.remoteData(c)},loadData:function(c,v){a(c).data("tree").options.data=v,h.loadData(c,a(c).data("tree").options.data)},getNodesByFilter:function(c,v){var k=a(c).data("tree").options;return k.nodesFilter=[],h.findNodeByFilter(c,k.data,v),k.nodesFilter},removeNode:function(c,v){a("#"+v).remove();var k=a(c).data("tree").options.data;h.removeNodeById(c,k,v)}}}(jQuery,window);