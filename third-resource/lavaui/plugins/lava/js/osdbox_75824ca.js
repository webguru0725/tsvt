var osdbox={init:function(t){var o=$(t),e=o.data("osdbox").options;o.hasClass("osdbox")?o.html(""):o.addClass("osdbox");var i=$("<div class='osd-container'></div>").appendTo(o);e.container=i,i.css({width:e.width,height:e.height,position:"relative"}),i.css(e.backgroundImg?{"background-image":url(e.backgroundImg)}:{"background-color":e.backgroundColor}),osdbox.loadData(o,e.data),osdbox.bindEvent(o)},isIE:function(){return navigator.userAgent.toUpperCase().indexOf("TRIEDENT")>=0?!0:!1},loadData:function(t,o){var e=t.data("osdbox").options;e.data=o;var i=e.borderColor,a=e.container,n=e.resolutionRatio.split("*")[0],s=e.resolutionRatio.split("*")[1],d=e.width,r=e.height;a.html("");for(var h="<div class='osd-item' data-index = {index} style='position:absolute;left:{x};top:{y};border:1px solid {borderColor};width:{width};height:{height}'><span>{text}</span></div>",l=[],c=0;c<o.length;c++){var p=parseInt(o[c].x*d/n);o[c].x_real=p;var f=parseInt(o[c].y*r/s);o[c].y_real=f;var g=o[c].text,u=h.replace("{index}",c).replace("{borderColor}",i).replace("{x}",p+"px").replace("{y}",f+"px").replace("{text}",g);u=o[c].width?u.replace("{width}",o[c].width):u.replace("{width}","auto"),u=o[c].height?u.replace("{height}",o[c].height):u.replace("{height}","auto"),l.push(u)}a.html(l.join("")),a.find(".osd-item").each(function(t,o){osdbox.isIE?$(o).css("width",$(o).children().width()+2):$(o).css("width",$(o).children().width()),$(o).offset().left+$(o).width()>=a.offset().left+e.width&&$(o).offset({left:a.offset().left+e.width-$(o).width()-2}),osdbox.isIE?$(o).css("height",$(o).children().height()+2):$(o).css("height",$(o).children().height()),$(o).offset().top+$(o).height()>=a.offset().top+e.height&&$(o).offset({top:a.offset().top+e.height-$(o).height()-2})})},getData:function(t){for(var o=$(t),e=o.data("osdbox").options,i=e.data,a=e.resolutionRatio,n=e.container,s=a.split("*")[0],d=a.split("*")[1],r=n.width(),h=n.height(),l=0;l<i.length;l++){var c=i[l].x_real,p=i[l].y_real;i[l].x=parseInt(s*c/r),i[l].y=parseInt(d*p/h)}return i},bindEvent:function(t){var o,e,i,a,n,s=t.data("osdbox").options,d=s.container,r=!1;d.delegate(".osd-item","mousedown",function(t){var s=$(t.target);s.hasClass("osd-item")||(s=s.parent()),n=s,o=parseInt(s.css("left")),e=parseInt(s.css("top")),i=t.clientX,a=t.clientY,r=!0}).on("mousemove mouseup",function(d){var h=n;s=t.data("osdbox").options;var l=s.data;if(r){clientX=d.clientX,clientY=d.clientY;var c=clientX-i,p=clientY-a;i=clientX,a=clientY,o+=c,1>=o&&(o=1),o>=h.parent().width()-h.width()-3&&(o=h.parent().width()-h.width()-3),e+=p,1>=e&&(e=1),e>=h.parent().height()-h.height()-3&&(e=h.parent().height()-h.height()-3),h.css("left",o+"px"),h.css("top",e+"px"),l[h.attr("data-index")].x_real=o,l[h.attr("data-index")].y_real=e}"mouseup"===d.type&&(o=0,e=0,i=0,a=0,r=!1)}),$("body").on("mouseup",function(){o=0,e=0,i=0,a=0,r=!1})}};$.fn.osdbox=function(t,o){return"string"==typeof t?$.fn.osdbox.methods[t](this,o):void $.each(this,function(){var o={};$.extend(o,$.fn.osdbox.default),$.extend(o,t),$(this).data("osdbox",{options:o}),osdbox.init(this)})},$.fn.osdbox.default={width:100,height:100,backgroundColor:"#27313a",backgroundImg:"",borderColor:"#f00",data:[],resolutionRatio:"1024*768"},$.fn.osdbox.methods={getData:function(t){var o=osdbox.getData(t);return o||[]},setData:function(t,o){var e=$(t);osdbox.loadData(e,o)}};