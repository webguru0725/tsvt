var planBox={init:function(a){var c=$(a);c.hasClass("plan-box")?c.html(""):c.addClass("plan-box");var h=c.data("planBox").options,v=$("<div class='plan-box-container' style='width:"+h.width+"px;height:"+h.height+"px;'></div>").appendTo(c);h.container=v;var b=h.color,g="<style>";for(var w in b)g+=" .plan-box-item."+w+"{",g+=h.isFill?"background-color:"+b[w]+";}":"border: 2px solid "+b[w]+";}";g+="</style>",$(g).appendTo("body"),planBox.drawRect(a,h.data),planBox.bindEvent(a)},drawRect:function(a,c){var h=$(a),v=h.data("planBox").options,b=v.container;b.html(""),v.data=c;var g=v.width,w=v.height,y=c.length,B=c[0].length,I=v.rowBlank,k=v.colBlank,N="<span class='{class}' style='width:{width}px;height:{height}px;line-height:{height}px;top:{top};left:{left};' data-left='{left}' data-top='{top}' data-type='{type}' data-row='{row}' data-col='{col}'>{text}</span>";v.colNumber&&(y+=1);var D=Math.floor((g-(B-1)*I)/B),R=Math.floor((w-(y-1)*k)/y);N=N.replace("{width}",D).replace(/{height}/g,R);var T=[];if(v.colNumber)for(var i=0;B>i;i++){var C=N.replace(/{top}/g,"0px").replace(/{left}/g,(D+I-1)*i+"px").replace("{type}","").replace("{row}","").replace("{col}","");C=C.replace("{class}","plan-box-header-item").replace("{text}",i),T.push(C)}for(var i=0;i<c.length;i++){var y=c[i];if(v.colNumber)var E=i+1;else var E=i;for(var F=0;F<y.length;F++){var C=N.replace(/{top}/g,(R+k-1)*E+"px").replace(/{left}/g,(D+I-1)*F+"px").replace("{type}",y[F]).replace("{row}",i).replace("{col}",F);C=0==y[F]?C.replace("{class}","plan-box-item normal"):1==y[F]?C.replace("{class}","plan-box-item selected"):C.replace("{class}","plan-box-item alarm"),C=C.replace("{text}",""),T.push(C)}}b.html(T.join(""))},bindEvent:function(a){var c,h=$(a),v=h.data("planBox").options,b=v.container,g=!1,w=0,y=0,B=0,I=0,k=0,N=0,D=0,R=0,T=0,C=0;b.delegate(".plan-box-item","mousedown mousemove mouseup dragstart",function(e){var a=$(e.target);if("mousedown"==e.type)k=e.clientX,N=e.clientY,D=a.offset().left,R=a.offset().top,g=!0,c=parseInt(a.attr("data-type")),w=parseInt(a.attr("data-left")),y=parseInt(a.attr("data-top"));else if("dragstart"==e.type)e.preventDefault();else if("mousemove"==e.type){if(g){b.find(".plan-box-rect").remove(),T=e.clientX,C=e.clientY;var h=T-k,E=C-N,F='<div class="plan-box-rect" style="position:absolute;height:'+E+"px;width:"+h+"px;left:"+(w+2)+"px;top:"+(y+2)+'px;"></div>';$(F).appendTo(b)}}else if(g){g=!1,b.find(".plan-box-rect").remove(),B=parseInt(a.attr("data-left")),I=parseInt(a.attr("data-top"));var M=v.data,X=c;if(w==B&&y==I)X+=1,v.color.alarm?3==X&&(X=0):2==X&&(X=0),0==X?a.attr("class","plan-box-item normal"):1==X?a.attr("class","plan-box-item selected"):a.attr("class","plan-box-item alarm"),a.attr("data-type",X),M[a.attr("data-row")][a.attr("data-col")]=X;else{if(w>B){var Y=w;w=B,B=Y}if(y>I){var Y=y;y=I,I=Y}b.find(".plan-box-item").each(function(a,c){var h=$(c),v=parseInt(h.attr("data-left")),b=parseInt(h.attr("data-top"));v>=w&&b>=y&&B>=v&&I>=b&&(0==X?h.attr("class","plan-box-item normal"):1==X?h.attr("class","plan-box-item selected"):h.attr("class","plan-box-item alarm"),h.attr("data-type",X),M[h.attr("data-row")][h.attr("data-col")]=X)})}w=0,y=0,D=0,R=0,B=0,I=0,k=0,N=0}})}};$.fn.planbox=function(a,c){return"string"==typeof a?$.fn.planbox.methods[a](this,c):void $.each(this,function(){var c={};$.extend(c,$.fn.planbox.defaults),$.extend(c,a),$(this).data("planBox",{options:c}),planBox.init(this)})},$.fn.planbox.defaults={width:120,height:120,data:[],isFill:!0,color:{normal:"#efefef",selected:"#0f0",alarm:"#f00"},rowBlank:2,colBlank:3,colNumber:!0},$.fn.planbox.methods={getData:function(a){return $(a).data("planBox").options.data},setData:function(a,c){planBox.drawRect(a,c)}};