!function(a,c){var h={treeId:1,isIE:!1,init:function(a){this.bindEvent(a),this.checkIsIE()},checkIsIE:function(){this.isIE=/msie|edge|trident/.test(c.navigator.userAgent.toLowerCase())?!0:!1},loadLocalData:function(c){var h=a(c),v=h.data("tree").options;v.data.length>0?(v.loadFilter&&(v.data=v.loadFilter(v.data)),this.loadData(c,v.data)):console.error("本地数据为空")},loadData:function(c,v,k){var g=a(c),N=g.data("tree").options;g.addClass("lavaui-tree"),g.html(""),h.initData(v,N.htmlArray,0,void 0,N),h.initDom(c,c,N.htmlArray,k)},remoteData:function(c){var h=this,v=a(c),k=v.data("tree").options,g=v.data("tree").options.url;a.ajax({url:g,type:k.method,dataType:"json",data:k.queryParams}).done(function(a){a?(k.data=a,k.loadFilter&&(k.data=k.loadFilter(k.data)),h.loadData(c,k.data,function(){if(k.onLoadSuccess){var a=k.data;k.onLoadSuccess(a)}})):console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空")}).fail(function(){k.onLoadError&&k.onLoadError(),console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败")})},initData:function(a,c,h,v,k){for(var g=this,N=k.async,C=k.checkbox,i=0;i<a.length;i++){if(a[i].treeId="lava_tree_"+g.treeId++,a[i].level=h?h:0,a[i].parentTreeId=v?v:void 0,C){var b="<li id='"+a[i].treeId+"' {0}>{1}<span class='tree-chkbx {2}'></span><a href='javascript:;'><span class='{3}'></span><span>"+a[i].text+"</span></a>{4}</li>",I="";if(N?a[i].closed?(b=b.replace("{0}","class='closed'"),b=b.replace("{1}","<span class='button-open'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):a[i].children&&a[i].children.length>0?(b=b.replace("{0}",""),b=b.replace("{1}","<span class='button-cloed'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}",""),I="icon-file",b=b.replace("{4}","")):a[i].children&&a[i].children.length>0?a[i].closed?(b=b.replace("{0}","class='closed'"),b=b.replace("{1}","<span class='button-open'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}","<span class='button-close'></span>"),I="icon-folder",b=b.replace("{4}","<ul></ul>")):(b=b.replace("{0}",""),b=b.replace("{1}",""),I="icon-file",b=b.replace("{4}","")),b=a[i].iconCls?b.replace("{3}","icon "+a[i].iconCls):b.replace("{3}","node-icon "+I),a[i].checked)a[i].checked=2,b=b.replace("{2}","tree-chk");else if(a[i].children&&a[i].children.length>0){for(var y=[],S=0;S<a[i].children.length;S++)y.push(a[i].children[S].checked?!0:!1);/\/false/.test("/"+y.join("/"))?/\/true/.test("/"+y.join("/"))?(a[i].checked=1,b=b.replace("{2}","tree-halfchk")):(a[i].checked=0,b=b.replace("{2}","tree-nochk")):(a[i].checked=2,b=b.replace("{2}","tree-chk"))}else a[i].checked=0,b=b.replace("{2}","tree-nochk")}else{var I="";if(N)if(a[i].closed){I="icon-folder";var b="<li id='"+a[i].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else if(a[i].children&&a[i].children.length>0){I="icon-folder";var b="<li id='"+a[i].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-file";var b="<li id='"+a[i].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a></li>"}else if(a[i].children&&a[i].children.length>0)if(a[i].closed){I="icon-folder";var b="<li id='"+a[i].treeId+"' class='closed'><span class='button-open'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-folder";var b="<li id='"+a[i].treeId+"'><span class='button-close'></span><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a><ul></ul></li>"}else{I="icon-file";var b="<li id='"+a[i].treeId+"'><span class='{0}'></span><a href='javascript:;'><span>"+a[i].text+"</span></a></li>"}b=a[i].iconCls?b.replace("{0}","icon "+a[i].iconCls):b.replace("{0}","node-icon "+I)}c.push({html:b,parentTreeId:v});var D=h+1;a[i].children&&g.initData(a[i].children,c,D,a[i].treeId,k)}},initDom:function(c,h,v,k){var g=this,N=a(c).data("tree").options.closedChildren;if(0==v.length)return void(k&&k());{var C=a(h);a(c)}v[0].parentTreeId&&(C=a("#"+v[0].parentTreeId).children("ul"));var b=v[0].parentTreeId,I=100;g.isIE&&(I=1e4),I=v.length>I?I:v.length;var y=v.splice(0,I),S=[],D=[];if(c==h)var j=!0;else var j=!C.parent("li").hasClass("closed");for(var T=!1,i=0;i<y.length;i++)b==y[i].parentTreeId?j?S.push(y[i].html):D.push(y[i]):(j?(C[0].childNodes.length>0?C.append(S.join("")):C[0].innerHTML=S.join(""),T=!0):N[b]=N[b]?N[b].concat(D):D,b=y[i].parentTreeId,C=b?a("#"+b).children("ul"):a(c),j=!C.parent("li").hasClass("closed"),j?(S=[y[i].html],D=[]):(S=[],D=[y[i]]));S.length>0&&(C[0].childNodes.length>0?C.append(S.join("")):C[0].innerHTML=S.join(""),T=!0),D.length>0&&(N[b]=N[b]?N[b].concat(D):D);var A=T?5:0;g.isIE&&T&&(A=3e3),v.length>0?A?setTimeout(function(){g.initDom(c,C,v,k)},A):g.initDom(c,C,v,k):k&&k()},treeParents:function(c,h){var v=this,k=a(h);if(k.tree("getParent",c).treeId){var g=k.tree("getParent",c).treeId;return a("#"+g).hasClass("closed")&&(a("#"+g).removeClass("closed"),a("#"+g).children("span").eq(0).removeClass("button-open").addClass("button-close")),v.treeParents(g,h)}},bindEvent:function(c){var h=this,v=a(c),k=v.data("tree").options;v.delegate(".button-open, .button-close, a, .tree-chkbx","click",function(){var v=a(this);if(v.hasClass("button-open")){h.expandNodes(v.parent(),c,k);var g=v.parent().prop("id"),N=h.findNode(k.data,g);k.onExpand&&k.onExpand(N)}else if(v.hasClass("button-close")){h.collapseNodes(v);var g=v.parent().prop("id"),N=h.findNode(k.data,g);k.onCollapse&&k.onCollapse(N)}else if("A"==v[0].tagName)h.selectNode(c,v);else if(v.hasClass("tree-chkbx")){h.checkNodes(c,v);var N=h.findNode(k.data,v.parent().prop("id"));k.onCheck&&k.onCheck(N)}})},expandNodes:function(c,v,k){var g=this,N=a(v),k=N.data("tree").options,C=c,b=C.attr("id"),I=g.findNode(k.data,b),y=I.level,S=I.id;C.hasClass("closed")&&C.removeClass("closed"),C.children(".button-open")[0].setAttribute("class","button-close"),C.children("a").children(".node-icon").removeClass("icon-folder node-icon").addClass("icon-loading"),C.children("ul")||C.append("<ul></ul>");var D=C.children("ul"),j=null;if(k.async)if(k.closedChildren[b]&&k.closedChildren[b].length>0)j=k.closedChildren[b],C.hasClass("closed")&&C.removeClass("closed"),j&&(g.initDom(v,D,j),C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open"));else{if(I.children&&I.children.length>0)return void C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open");a.ajax({url:k.url,type:k.method,dataType:"json",data:{id:S},success:function(a){if(a=k.loadFilter?k.loadFilter(a):a,a.length>0){var c=y+1;g.initData(a,k.htmlArray,c,b,k),g.findNode(k.data,b,function(c){c.children=a}),h.initDom(v,D,k.htmlArray)}else console.error?console.error("远程获取到的树数据为空"):console.log("远程获取到的树数据为空");C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")},error:function(){console.error?console.error("远程获取树数据失败"):console.log("远程获取树数据失败"),C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}})}else{if(j=k.closedChildren[b]){if(k.cascadeCheck)if(0===I.checked){var T=JSON.stringify(j);T.replace(/(tree\-chk)|(tree\-halfchk)/g,function(){return"tree-nochk"}),j=JSON.parse(T)}else if(2===I.checked){var T=JSON.stringify(j);T=T.replace(/(tree\-nochk)|(tree\-halfchk)/g,function(){return"tree-chk"}),j=JSON.parse(T)}g.initDom(v,D,j)}C.children("a").children(".icon-loading").removeClass("icon-loading").addClass("node-icon icon-folder_open")}},collapseNodes:function(a){var c=a;c[0].setAttribute("class","button-open"),c.siblings("a").children(".node-icon").removeClass("icon-folder_open").addClass("icon-folder"),c.parent("li").addClass("closed")},selectNode:function(c,h,v){var k=this,g=h,N=a(c),C=N.data("tree").options;C.selectedNodes||(C.selectedNodes=[]);var b=C.selectedNodes,I=g.parent().prop("id"),y=k.findNode(C.data,I);if(void 0===v||null===v)if(g.hasClass("selectNode")&&C.multiSelect){if(g.removeClass("selectNode"),b.length>0){for(var S=0,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}b.splice(S,1)}C.onSelect&&C.onSelect(y)}else{if(!g.hasClass("selectNode")){if(C.multiSelect||(N.find(".selectNode").eq(0).removeClass("selectNode"),b=[]),g.addClass("selectNode"),b.length>=0)for(var S=null,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}null===S&&b.push(y)}C.onSelect&&C.onSelect(y)}else if(v===!1){if(g.hasClass("selectNode")&&g.removeClass("selectNode"),b.length>0){for(var S=0,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}b.splice(S,1)}}else if(v===!0){if(C.multiSelect||(N.find(".selectNode").eq(0).removeClass("selectNode"),b=[]),g.hasClass("selectNode")||(g.addClass("selectNode"),C.onSelect&&C.onSelect(y)),b.length>=0)for(var S=null,i=0;i<b.length;i++)if(I===b[i].treeId){S=i;break}null===S&&b.push(y)}C.selectedNodes=b},checkNodes:function(a,c){var h=this,v=c,k=v.hasClass("tree-chk"),g=v.hasClass("tree-nochk"),N=v.hasClass("tree-halfchk");k?h.setCheckStatus(a,v,0):g?h.setCheckStatus(a,v,2):N&&h.setCheckStatus(a,v,2)},setCheckStatus:function(c,h,v){var k=this,g=a(c),N=g.data("tree").options,C=N.data,b=h,I=b.parent(),y=I.children("ul").find(".tree-chkbx"),S=I.prop("id"),D=k.findNode(C,S),j=!1,T=null;D.children&&D.children.length>0&&(j=!0),D.parentTreeId&&D.parentTreeId.length>0&&(T=D.parentTreeId);var A="";if(0===v?A="tree-nochk":1===v?A="tree-halfchk":2===v&&(A="tree-chk"),b[0].setAttribute("class","tree-chkbx "+A),k.updateCheckStatusData(C,S,v),N.cascadeCheck){if(j&&(0===v||2===v)){for(var i=0,E=y.length;E>i;i++)y[i].setAttribute("class","tree-chkbx "+A);k.updateChildCheckStatusData(C,S,v)}T&&k.cascadeCheck(C,T)}},cascadeCheck:function(c,h){var v=this,k=a("#"+h).children(".tree-chkbx"),g=v.findNode(c,h),N=g.children,C=g.parentTreeId,b=null,I=/"checked":2/.test(JSON.stringify(N)),y=/"checked":1/.test(JSON.stringify(N)),S=/"checked":0/.test(JSON.stringify(N));I?y?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):S?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):(k[0].setAttribute("class","tree-chkbx tree-chk"),b=2):y?(k[0].setAttribute("class","tree-chkbx tree-halfchk"),b=1):(k[0].setAttribute("class","tree-chkbx tree-nochk"),b=0),v.updateCheckStatusData(c,h,b),void 0!==C&&v.cascadeCheck(c,C)},findNode:function(a,c,h){for(var v=this,i=0;i<a.length;i++){if(a[i].treeId==c)return h?h(a[i]):a[i];if(a[i].children&&a[i].children.length>0&&v.findNode(a[i].children,c))return h?h(v.findNode(a[i].children,c)):v.findNode(a[i].children,c)}},findNodeById:function(c,h,v){for(var k=this,g=a(c).data("tree").options.nodesById,i=0;i<h.length;i++)h[i].id==v&&g.push(h[i]),h[i].children&&h[i].children.length>0&&k.findNodeById(c,h[i].children,v)},findNodeByFilter:function(c,h,v){for(var k=this,g=a(c).data("tree").options,i=0;i<h.length;i++)v(h[i])&&g.nodesFilter.push(h[i]),h[i].children&&h[i].children.length>0&&k.findNodeByFilter(c,h[i].children,v)},removeNodeById:function(a,c,h){for(var v=this,i=0;i<c.length;i++){if(c[i].treeId==h){c.splice(i,1);break}c[i].children&&c[i].children.length>0&&v.removeNodeById(a,c[i].children,h)}},tranverseNode:function(c,h){for(var v=this,k=a(c).data("tree").options,i=0;i<h.length;i++)0==h[i].checked?k.uncheckedNodes.push(h[i]):1==h[i].checked?k.indeterminateNodes.push(h[i]):2==h[i].checked&&k.checkedNodes.push(h[i]),h[i].children&&h[i].children.length>0&&v.tranverseNode(c,h[i].children)},updateChildCheckStatusData:function(a,c,h){var v=this;v.findNode(a,c,function(a){if(a&&a.children&&a.children.length>0){var c=JSON.stringify(a.children);c=c.replace(/"checked":[0|1|2]/g,function(){return'"checked":'+h}),a.children=JSON.parse(c)}})},updateCheckStatusData:function(a,c,h){var v=this;v.findNode(a,c,function(a){a&&(a.checked=h)})}};a.fn.tree=function(c,v){return"string"==typeof c?a.fn.tree.methods[c](this,v):void a.each(this,function(){var v={};a.extend(v,a.fn.tree.defaults),a.extend(v,c);var k=a(this).data("tree"),g={htmlArray:[],closedChildren:{}};a.extend(v,g),a(this).data("tree",{options:v}),k||h.init(this),a(this).data("tree").options.url?h.remoteData(this):"data"in a(this).data("tree").options&&a(this).data("tree").options.data.length>0&&h.loadLocalData(this)})},a.fn.tree.defaults={url:"",method:"GET",data:[],checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,async:!1,onSelect:null,multiSelect:!1,onCheck:null,onExpand:null,onCollapse:null,onLoadSuccess:null,onLoadError:null,queryParams:{},loadFilter:null},a.fn.tree.methods={find:function(c,v){a(c).data("tree").options.nodesById=[];var k=a(c).data("tree").options.data;return h.findNodeById(c,k,v),a(c).data("tree").options.nodesById},check:function(c,v){var k=a("#"+v).children(".tree-chkbx"),g=a(c).data("tree").options;if(h.setCheckStatus(c,k,2),g.onCheck){var N=h.findNode(g.data,v);g.onCheck(N)}},uncheck:function(c,v){var k=a("#"+v).children(".tree-chkbx");h.setCheckStatus(c,k,0)},select:function(v,k){var g=a("#"+k).children("a");h.selectNode(v,g,!0),h.treeParents(k,v),c.location.origin?c.location.href=c.location.origin+c.location.pathname+c.location.search+"#"+k:(c.location.origin=c.location.protocol+"//"+c.location.hostname+(c.location.port?":"+c.location.port:""),c.location.href=c.location.origin+c.location.pathname+c.location.search+"#"+k)},unSelect:function(c,v){var k=a("#"+v).children("a");h.selectNode(c,k,!1)},getChecked:function(c,v){var k=a(c),g=k.data("tree").options,N=g.data;g.checkedNodes=[],g.indeterminateNodes=[],g.uncheckedNodes=[],h.tranverseNode(c,N);var C={};if("object"==typeof v)for(var i=0;i<v.length;i++){var b=v[i];C[b]=g[b+"Nodes"]}else"string"==typeof v?C[v]=g[v+"Nodes"]:v||(C.checked=g.checkedNodes);return C},getSelected:function(c){var h=a(c).data("tree").options;return h.selectedNodes||(h.selectedNodes=[]),h.selectedNodes},getChildren:function(c,v){var k=a(c),g=k.data("tree").options.data,N=h.findNode(g,v);return N.children?N.children:[]},getParent:function(c,v){var k=a(c),g=k.data("tree").options.data,N=h.findNode(g,v);if(N.parentTreeId){var C=h.findNode(g,N.parentTreeId);if(C)return C}return{}},reload:function(c,v){var k=a(c).data("tree").options;k.queryParams=v?v:{},k.selectedNodes=[],k.checkedNodes=[],h.remoteData(c)},loadData:function(c,v){a(c).data("tree").options.data=v,h.loadData(c,a(c).data("tree").options.data)},getNodesByFilter:function(c,v){var k=a(c).data("tree").options;return k.nodesFilter=[],h.findNodeByFilter(c,k.data,v),k.nodesFilter},removeNode:function(c,v){a("#"+v).remove();var k=a(c).data("tree").options.data;h.removeNodeById(c,k,v)}}}(jQuery,window);